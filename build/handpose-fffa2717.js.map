{"version":3,"file":"handpose-fffa2717.js","sources":["../src/handpose.js","../src/handpose.js?comlink"],"sourcesContent":["// this runs as a web worker\r\nimport {transfer} from 'comlink';\r\nimport normalize from './normalize.js';\r\n\r\nconsole.log('Worker started');\r\n\r\nconst poses = new Map();\r\n\r\nclass HandPose {\r\n\t#matches\r\n\tconstructor () {\r\n\t\tthis.#matches = [];\r\n\t}\r\n\tstatic async loadPose(name, path) {\r\n\t\tconst url = new URL(path, import.meta.url);\r\n\t\tconst buffer = await fetch(url).then(response => response.arrayBuffer());\r\n\t\tconst pose = new Float32Array(buffer);\r\n\t\tposes.set(name, pose);\r\n\t}\r\n\tupdate (headPose, handPose, handedness) {\r\n\r\n\t\tnormalize(handPose);\r\n\r\n\t\tconst distances = [];\r\n\t\tfor (const [name, poseData] of poses) {\r\n\t\t\tconst isRight = Number(handedness === \"right\");\r\n\t\t\tconst poseHandDataSize = poseData[0];\r\n\t\t\tconst poseHandData = new Float32Array(poseData.buffer, (\r\n\t\t\t\t1 + // poseHandDataSize offset\r\n\t\t\t\t(poseHandDataSize * 16) * isRight // offset for right hand\r\n\t\t\t)*4 , poseHandDataSize * 16);\r\n\t\t\tconst poseWeightData = new Float32Array(poseData.buffer, (\r\n\t\t\t\t1 + // poseHandDataSize offset\r\n\t\t\t\t(poseHandDataSize * 16) * 2 + // offset for after hand data\r\n\t\t\t\t(poseHandDataSize * isRight)      // offset for right hand\r\n\t\t\t)*4 , poseHandDataSize);\r\n\r\n\t\t\tconst range = Math.min(poseHandDataSize, handPose.length/16);\r\n\t\t\tlet dist = 0;\r\n\t\t\tfor (let i=0; i<range; i++) {\r\n\t\t\t\tconst o = i*16;\r\n\t\t\t\tdist += Math.pow(\r\n\t\t\t\t\t(poseHandData[o + 12] - handPose[o + 12]) ** 2 +\r\n\t\t\t\t\t(poseHandData[o + 13] - handPose[o + 13]) ** 2 +\r\n\t\t\t\t\t(poseHandData[o + 14] - handPose[o + 14]) ** 2\r\n\t\t\t\t, 0.5);\r\n\t\t\t}\r\n\r\n\t\t\tdistances.push([name, dist]);\r\n\t\t}\r\n\r\n\t\treturn transfer({\r\n\t\t\tusedHandArrayBuffer: handPose,\r\n\t\t\tdistances: distances.sort((a,b)=>a[1]-b[1])\r\n\t\t}, [handPose.buffer]);\r\n\t}\r\n\tgetMatchedPoses () {\r\n\t\treturn this.#matches;\r\n\t}\r\n}\r\n\r\nexport default HandPose;","\n\t\timport * as m from \"C:\\\\Users\\\\Daniel\\\\_Projects\\\\WebXR\\\\handy-work\\\\src\\\\handpose.js\";\n\t\timport {expose} from \"comlink\";\n\n\t\texpose(m);\n\t"],"names":["console","log","poses","Map","expose","[object Object]","this","name","path","url","URL","import","meta","buffer","fetch","then","response","arrayBuffer","pose","Float32Array","set","headPose","handPose","handedness","normalize","distances","poseData","isRight","Number","poseHandDataSize","poseHandData","range","Math","min","length","dist","i","o","pow","push","transfer","usedHandArrayBuffer","sort","a","b"],"mappings":"uDAIAA,QAAQC,IAAI,kBAEZ,MAAMC,EAAQ,IAAIC,ICFhBC,wCDIF,MACCC,SACAA,cACCC,cAAgB,GAEjBD,sBAAsBE,EAAMC,GAC3B,MAAMC,EAAM,IAAIC,IAAIF,EAAMG,OAAOC,KAAKH,KAChCI,QAAeC,MAAML,GAAKM,MAAKC,GAAYA,EAASC,gBACpDC,EAAO,IAAIC,aAAaN,GAC9BX,EAAMkB,IAAIb,EAAMW,GAEjBb,OAAQgB,EAAUC,EAAUC,GAE3BC,EAAUF,GAEV,MAAMG,EAAY,GAClB,IAAK,MAAOlB,EAAMmB,KAAaxB,EAAO,CACrC,MAAMyB,EAAUC,OAAsB,UAAfL,GACjBM,EAAmBH,EAAS,GAC5BI,EAAe,IAAIX,aAAaO,EAASb,OAG7C,GAFD,EACoB,GAAnBgB,EAAyBF,GACF,GAAnBE,GACiB,IAAIV,aAAaO,EAASb,OAI/C,GAHD,EACoB,GAAnBgB,EAAyB,EACzBA,EAAmBF,GACfE,GAEN,MAAME,EAAQC,KAAKC,IAAIJ,EAAkBP,EAASY,OAAO,IACzD,IAAIC,EAAO,EACX,IAAK,IAAIC,EAAE,EAAGA,EAAEL,EAAOK,IAAK,CAC3B,MAAMC,EAAM,GAAFD,EACVD,GAAQH,KAAKM,KACXR,EAAaO,EAAI,IAAMf,EAASe,EAAI,MAAQ,GAC5CP,EAAaO,EAAI,IAAMf,EAASe,EAAI,MAAQ,GAC5CP,EAAaO,EAAI,IAAMf,EAASe,EAAI,MAAQ,EAC5C,IAGHZ,EAAUc,KAAK,CAAChC,EAAM4B,IAGvB,OAAOK,EAAS,CACfC,oBAAqBnB,EACrBG,UAAWA,EAAUiB,MAAK,CAACC,EAAEC,IAAID,EAAE,GAAGC,EAAE,MACtC,CAACtB,EAAST,SAEdR,kBACC,OAAOC"}