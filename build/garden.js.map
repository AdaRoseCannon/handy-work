{"version":3,"file":"garden.js","sources":["../node_modules/three/examples/jsm/controls/OrbitControls.js","../node_modules/@tweenjs/tween.js/dist/tween.esm.js","../src/lib/scene.js","../node_modules/three/examples/jsm/webxr/VRButton.js","../node_modules/three/examples/jsm/loaders/GLTFLoader.js","../node_modules/three/examples/jsm/libs/motion-controllers.module.js","../node_modules/three/examples/jsm/webxr/XRControllerModelFactory.js","../node_modules/three/examples/jsm/webxr/XRHandPrimitiveModel.js","../node_modules/three/examples/jsm/webxr/XRHandMeshModel.js","../node_modules/three/examples/jsm/webxr/XRHandModelFactory.js","../src/lib/controllers/gamepad.js","../src/lib/controllers/locomotion/fade.js","../src/lib/controllers/controllers.js","../src/garden.js"],"sourcesContent":["import {\n\tEventDispatcher,\n\tMOUSE,\n\tQuaternion,\n\tSpherical,\n\tTOUCH,\n\tVector2,\n\tVector3\n} from 'three';\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n//\n//    Orbit - left mouse / touch: one-finger move\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move\n\nconst _changeEvent = { type: 'change' };\nconst _startEvent = { type: 'start' };\nconst _endEvent = { type: 'end' };\n\nclass OrbitControls extends EventDispatcher {\n\n\tconstructor( object, domElement ) {\n\n\t\tsuper();\n\n\t\tif ( domElement === undefined ) console.warn( 'THREE.OrbitControls: The second parameter \"domElement\" is now mandatory.' );\n\t\tif ( domElement === document ) console.error( 'THREE.OrbitControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.' );\n\n\t\tthis.object = object;\n\t\tthis.domElement = domElement;\n\n\t\t// Set to false to disable this control\n\t\tthis.enabled = true;\n\n\t\t// \"target\" sets the location of focus, where the object orbits around\n\t\tthis.target = new Vector3();\n\n\t\t// How far you can dolly in and out ( PerspectiveCamera only )\n\t\tthis.minDistance = 0;\n\t\tthis.maxDistance = Infinity;\n\n\t\t// How far you can zoom in and out ( OrthographicCamera only )\n\t\tthis.minZoom = 0;\n\t\tthis.maxZoom = Infinity;\n\n\t\t// How far you can orbit vertically, upper and lower limits.\n\t\t// Range is 0 to Math.PI radians.\n\t\tthis.minPolarAngle = 0; // radians\n\t\tthis.maxPolarAngle = Math.PI; // radians\n\n\t\t// How far you can orbit horizontally, upper and lower limits.\n\t\t// If set, the interval [ min, max ] must be a sub-interval of [ - 2 PI, 2 PI ], with ( max - min < 2 PI )\n\t\tthis.minAzimuthAngle = - Infinity; // radians\n\t\tthis.maxAzimuthAngle = Infinity; // radians\n\n\t\t// Set to true to enable damping (inertia)\n\t\t// If damping is enabled, you must call controls.update() in your animation loop\n\t\tthis.enableDamping = false;\n\t\tthis.dampingFactor = 0.05;\n\n\t\t// This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\n\t\t// Set to false to disable zooming\n\t\tthis.enableZoom = true;\n\t\tthis.zoomSpeed = 1.0;\n\n\t\t// Set to false to disable rotating\n\t\tthis.enableRotate = true;\n\t\tthis.rotateSpeed = 1.0;\n\n\t\t// Set to false to disable panning\n\t\tthis.enablePan = true;\n\t\tthis.panSpeed = 1.0;\n\t\tthis.screenSpacePanning = true; // if false, pan orthogonal to world-space direction camera.up\n\t\tthis.keyPanSpeed = 7.0;\t// pixels moved per arrow key push\n\n\t\t// Set to true to automatically rotate around the target\n\t\t// If auto-rotate is enabled, you must call controls.update() in your animation loop\n\t\tthis.autoRotate = false;\n\t\tthis.autoRotateSpeed = 2.0; // 30 seconds per orbit when fps is 60\n\n\t\t// The four arrow keys\n\t\tthis.keys = { LEFT: 'ArrowLeft', UP: 'ArrowUp', RIGHT: 'ArrowRight', BOTTOM: 'ArrowDown' };\n\n\t\t// Mouse buttons\n\t\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.DOLLY, RIGHT: MOUSE.PAN };\n\n\t\t// Touch fingers\n\t\tthis.touches = { ONE: TOUCH.ROTATE, TWO: TOUCH.DOLLY_PAN };\n\n\t\t// for reset\n\t\tthis.target0 = this.target.clone();\n\t\tthis.position0 = this.object.position.clone();\n\t\tthis.zoom0 = this.object.zoom;\n\n\t\t// the target DOM element for key events\n\t\tthis._domElementKeyEvents = null;\n\n\t\t//\n\t\t// public methods\n\t\t//\n\n\t\tthis.getPolarAngle = function () {\n\n\t\t\treturn spherical.phi;\n\n\t\t};\n\n\t\tthis.getAzimuthalAngle = function () {\n\n\t\t\treturn spherical.theta;\n\n\t\t};\n\n\t\tthis.listenToKeyEvents = function ( domElement ) {\n\n\t\t\tdomElement.addEventListener( 'keydown', onKeyDown );\n\t\t\tthis._domElementKeyEvents = domElement;\n\n\t\t};\n\n\t\tthis.saveState = function () {\n\n\t\t\tscope.target0.copy( scope.target );\n\t\t\tscope.position0.copy( scope.object.position );\n\t\t\tscope.zoom0 = scope.object.zoom;\n\n\t\t};\n\n\t\tthis.reset = function () {\n\n\t\t\tscope.target.copy( scope.target0 );\n\t\t\tscope.object.position.copy( scope.position0 );\n\t\t\tscope.object.zoom = scope.zoom0;\n\n\t\t\tscope.object.updateProjectionMatrix();\n\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t\tscope.update();\n\n\t\t\tstate = STATE.NONE;\n\n\t\t};\n\n\t\t// this method is exposed, but perhaps it would be better if we can make it private...\n\t\tthis.update = function () {\n\n\t\t\tconst offset = new Vector3();\n\n\t\t\t// so camera.up is the orbit axis\n\t\t\tconst quat = new Quaternion().setFromUnitVectors( object.up, new Vector3( 0, 1, 0 ) );\n\t\t\tconst quatInverse = quat.clone().invert();\n\n\t\t\tconst lastPosition = new Vector3();\n\t\t\tconst lastQuaternion = new Quaternion();\n\n\t\t\tconst twoPI = 2 * Math.PI;\n\n\t\t\treturn function update() {\n\n\t\t\t\tconst position = scope.object.position;\n\n\t\t\t\toffset.copy( position ).sub( scope.target );\n\n\t\t\t\t// rotate offset to \"y-axis-is-up\" space\n\t\t\t\toffset.applyQuaternion( quat );\n\n\t\t\t\t// angle from z-axis around y-axis\n\t\t\t\tspherical.setFromVector3( offset );\n\n\t\t\t\tif ( scope.autoRotate && state === STATE.NONE ) {\n\n\t\t\t\t\trotateLeft( getAutoRotationAngle() );\n\n\t\t\t\t}\n\n\t\t\t\tif ( scope.enableDamping ) {\n\n\t\t\t\t\tspherical.theta += sphericalDelta.theta * scope.dampingFactor;\n\t\t\t\t\tspherical.phi += sphericalDelta.phi * scope.dampingFactor;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tspherical.theta += sphericalDelta.theta;\n\t\t\t\t\tspherical.phi += sphericalDelta.phi;\n\n\t\t\t\t}\n\n\t\t\t\t// restrict theta to be between desired limits\n\n\t\t\t\tlet min = scope.minAzimuthAngle;\n\t\t\t\tlet max = scope.maxAzimuthAngle;\n\n\t\t\t\tif ( isFinite( min ) && isFinite( max ) ) {\n\n\t\t\t\t\tif ( min < - Math.PI ) min += twoPI; else if ( min > Math.PI ) min -= twoPI;\n\n\t\t\t\t\tif ( max < - Math.PI ) max += twoPI; else if ( max > Math.PI ) max -= twoPI;\n\n\t\t\t\t\tif ( min <= max ) {\n\n\t\t\t\t\t\tspherical.theta = Math.max( min, Math.min( max, spherical.theta ) );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tspherical.theta = ( spherical.theta > ( min + max ) / 2 ) ?\n\t\t\t\t\t\t\tMath.max( min, spherical.theta ) :\n\t\t\t\t\t\t\tMath.min( max, spherical.theta );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// restrict phi to be between desired limits\n\t\t\t\tspherical.phi = Math.max( scope.minPolarAngle, Math.min( scope.maxPolarAngle, spherical.phi ) );\n\n\t\t\t\tspherical.makeSafe();\n\n\n\t\t\t\tspherical.radius *= scale;\n\n\t\t\t\t// restrict radius to be between desired limits\n\t\t\t\tspherical.radius = Math.max( scope.minDistance, Math.min( scope.maxDistance, spherical.radius ) );\n\n\t\t\t\t// move target to panned location\n\n\t\t\t\tif ( scope.enableDamping === true ) {\n\n\t\t\t\t\tscope.target.addScaledVector( panOffset, scope.dampingFactor );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tscope.target.add( panOffset );\n\n\t\t\t\t}\n\n\t\t\t\toffset.setFromSpherical( spherical );\n\n\t\t\t\t// rotate offset back to \"camera-up-vector-is-up\" space\n\t\t\t\toffset.applyQuaternion( quatInverse );\n\n\t\t\t\tposition.copy( scope.target ).add( offset );\n\n\t\t\t\tscope.object.lookAt( scope.target );\n\n\t\t\t\tif ( scope.enableDamping === true ) {\n\n\t\t\t\t\tsphericalDelta.theta *= ( 1 - scope.dampingFactor );\n\t\t\t\t\tsphericalDelta.phi *= ( 1 - scope.dampingFactor );\n\n\t\t\t\t\tpanOffset.multiplyScalar( 1 - scope.dampingFactor );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tsphericalDelta.set( 0, 0, 0 );\n\n\t\t\t\t\tpanOffset.set( 0, 0, 0 );\n\n\t\t\t\t}\n\n\t\t\t\tscale = 1;\n\n\t\t\t\t// update condition is:\n\t\t\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\n\t\t\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n\t\t\t\tif ( zoomChanged ||\n\t\t\t\t\tlastPosition.distanceToSquared( scope.object.position ) > EPS ||\n\t\t\t\t\t8 * ( 1 - lastQuaternion.dot( scope.object.quaternion ) ) > EPS ) {\n\n\t\t\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t\t\t\tlastPosition.copy( scope.object.position );\n\t\t\t\t\tlastQuaternion.copy( scope.object.quaternion );\n\t\t\t\t\tzoomChanged = false;\n\n\t\t\t\t\treturn true;\n\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\n\t\t\t};\n\n\t\t}();\n\n\t\tthis.dispose = function () {\n\n\t\t\tscope.domElement.removeEventListener( 'contextmenu', onContextMenu );\n\n\t\t\tscope.domElement.removeEventListener( 'pointerdown', onPointerDown );\n\t\t\tscope.domElement.removeEventListener( 'wheel', onMouseWheel );\n\n\t\t\tscope.domElement.removeEventListener( 'touchstart', onTouchStart );\n\t\t\tscope.domElement.removeEventListener( 'touchend', onTouchEnd );\n\t\t\tscope.domElement.removeEventListener( 'touchmove', onTouchMove );\n\n\t\t\tscope.domElement.ownerDocument.removeEventListener( 'pointermove', onPointerMove );\n\t\t\tscope.domElement.ownerDocument.removeEventListener( 'pointerup', onPointerUp );\n\n\n\t\t\tif ( scope._domElementKeyEvents !== null ) {\n\n\t\t\t\tscope._domElementKeyEvents.removeEventListener( 'keydown', onKeyDown );\n\n\t\t\t}\n\n\t\t\t//scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\n\n\t\t};\n\n\t\t//\n\t\t// internals\n\t\t//\n\n\t\tconst scope = this;\n\n\t\tconst STATE = {\n\t\t\tNONE: - 1,\n\t\t\tROTATE: 0,\n\t\t\tDOLLY: 1,\n\t\t\tPAN: 2,\n\t\t\tTOUCH_ROTATE: 3,\n\t\t\tTOUCH_PAN: 4,\n\t\t\tTOUCH_DOLLY_PAN: 5,\n\t\t\tTOUCH_DOLLY_ROTATE: 6\n\t\t};\n\n\t\tlet state = STATE.NONE;\n\n\t\tconst EPS = 0.000001;\n\n\t\t// current position in spherical coordinates\n\t\tconst spherical = new Spherical();\n\t\tconst sphericalDelta = new Spherical();\n\n\t\tlet scale = 1;\n\t\tconst panOffset = new Vector3();\n\t\tlet zoomChanged = false;\n\n\t\tconst rotateStart = new Vector2();\n\t\tconst rotateEnd = new Vector2();\n\t\tconst rotateDelta = new Vector2();\n\n\t\tconst panStart = new Vector2();\n\t\tconst panEnd = new Vector2();\n\t\tconst panDelta = new Vector2();\n\n\t\tconst dollyStart = new Vector2();\n\t\tconst dollyEnd = new Vector2();\n\t\tconst dollyDelta = new Vector2();\n\n\t\tfunction getAutoRotationAngle() {\n\n\t\t\treturn 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\n\n\t\t}\n\n\t\tfunction getZoomScale() {\n\n\t\t\treturn Math.pow( 0.95, scope.zoomSpeed );\n\n\t\t}\n\n\t\tfunction rotateLeft( angle ) {\n\n\t\t\tsphericalDelta.theta -= angle;\n\n\t\t}\n\n\t\tfunction rotateUp( angle ) {\n\n\t\t\tsphericalDelta.phi -= angle;\n\n\t\t}\n\n\t\tconst panLeft = function () {\n\n\t\t\tconst v = new Vector3();\n\n\t\t\treturn function panLeft( distance, objectMatrix ) {\n\n\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix\n\t\t\t\tv.multiplyScalar( - distance );\n\n\t\t\t\tpanOffset.add( v );\n\n\t\t\t};\n\n\t\t}();\n\n\t\tconst panUp = function () {\n\n\t\t\tconst v = new Vector3();\n\n\t\t\treturn function panUp( distance, objectMatrix ) {\n\n\t\t\t\tif ( scope.screenSpacePanning === true ) {\n\n\t\t\t\t\tv.setFromMatrixColumn( objectMatrix, 1 );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 );\n\t\t\t\t\tv.crossVectors( scope.object.up, v );\n\n\t\t\t\t}\n\n\t\t\t\tv.multiplyScalar( distance );\n\n\t\t\t\tpanOffset.add( v );\n\n\t\t\t};\n\n\t\t}();\n\n\t\t// deltaX and deltaY are in pixels; right and down are positive\n\t\tconst pan = function () {\n\n\t\t\tconst offset = new Vector3();\n\n\t\t\treturn function pan( deltaX, deltaY ) {\n\n\t\t\t\tconst element = scope.domElement;\n\n\t\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\t\t// perspective\n\t\t\t\t\tconst position = scope.object.position;\n\t\t\t\t\toffset.copy( position ).sub( scope.target );\n\t\t\t\t\tlet targetDistance = offset.length();\n\n\t\t\t\t\t// half of the fov is center to top of screen\n\t\t\t\t\ttargetDistance *= Math.tan( ( scope.object.fov / 2 ) * Math.PI / 180.0 );\n\n\t\t\t\t\t// we use only clientHeight here so aspect ratio does not distort speed\n\t\t\t\t\tpanLeft( 2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix );\n\t\t\t\t\tpanUp( 2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix );\n\n\t\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\t\t// orthographic\n\t\t\t\t\tpanLeft( deltaX * ( scope.object.right - scope.object.left ) / scope.object.zoom / element.clientWidth, scope.object.matrix );\n\t\t\t\t\tpanUp( deltaY * ( scope.object.top - scope.object.bottom ) / scope.object.zoom / element.clientHeight, scope.object.matrix );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// camera neither orthographic nor perspective\n\t\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );\n\t\t\t\t\tscope.enablePan = false;\n\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t}();\n\n\t\tfunction dollyOut( dollyScale ) {\n\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\tscale /= dollyScale;\n\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom * dollyScale ) );\n\t\t\t\tscope.object.updateProjectionMatrix();\n\t\t\t\tzoomChanged = true;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\t\tscope.enableZoom = false;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction dollyIn( dollyScale ) {\n\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\n\n\t\t\t\tscale *= dollyScale;\n\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\n\n\t\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom / dollyScale ) );\n\t\t\t\tscope.object.updateProjectionMatrix();\n\t\t\t\tzoomChanged = true;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\t\tscope.enableZoom = false;\n\n\t\t\t}\n\n\t\t}\n\n\t\t//\n\t\t// event callbacks - update the object state\n\t\t//\n\n\t\tfunction handleMouseDownRotate( event ) {\n\n\t\t\trotateStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tfunction handleMouseDownDolly( event ) {\n\n\t\t\tdollyStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tfunction handleMouseDownPan( event ) {\n\n\t\t\tpanStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tfunction handleMouseMoveRotate( event ) {\n\n\t\t\trotateEnd.set( event.clientX, event.clientY );\n\n\t\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\n\n\t\t\tconst element = scope.domElement;\n\n\t\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\n\n\t\t\trotateStart.copy( rotateEnd );\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleMouseMoveDolly( event ) {\n\n\t\t\tdollyEnd.set( event.clientX, event.clientY );\n\n\t\t\tdollyDelta.subVectors( dollyEnd, dollyStart );\n\n\t\t\tif ( dollyDelta.y > 0 ) {\n\n\t\t\t\tdollyOut( getZoomScale() );\n\n\t\t\t} else if ( dollyDelta.y < 0 ) {\n\n\t\t\t\tdollyIn( getZoomScale() );\n\n\t\t\t}\n\n\t\t\tdollyStart.copy( dollyEnd );\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleMouseMovePan( event ) {\n\n\t\t\tpanEnd.set( event.clientX, event.clientY );\n\n\t\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\n\n\t\t\tpan( panDelta.x, panDelta.y );\n\n\t\t\tpanStart.copy( panEnd );\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleMouseUp( /*event*/ ) {\n\n\t\t\t// no-op\n\n\t\t}\n\n\t\tfunction handleMouseWheel( event ) {\n\n\t\t\tif ( event.deltaY < 0 ) {\n\n\t\t\t\tdollyIn( getZoomScale() );\n\n\t\t\t} else if ( event.deltaY > 0 ) {\n\n\t\t\t\tdollyOut( getZoomScale() );\n\n\t\t\t}\n\n\t\t\tscope.update();\n\n\t\t}\n\n\t\tfunction handleKeyDown( event ) {\n\n\t\t\tlet needsUpdate = false;\n\n\t\t\tswitch ( event.code ) {\n\n\t\t\t\tcase scope.keys.UP:\n\t\t\t\t\tpan( 0, scope.keyPanSpeed );\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.keys.BOTTOM:\n\t\t\t\t\tpan( 0, - scope.keyPanSpeed );\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.keys.LEFT:\n\t\t\t\t\tpan( scope.keyPanSpeed, 0 );\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase scope.keys.RIGHT:\n\t\t\t\t\tpan( - scope.keyPanSpeed, 0 );\n\t\t\t\t\tneedsUpdate = true;\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tif ( needsUpdate ) {\n\n\t\t\t\t// prevent the browser from scrolling on cursor keys\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\tscope.update();\n\n\t\t\t}\n\n\n\t\t}\n\n\t\tfunction handleTouchStartRotate( event ) {\n\n\t\t\tif ( event.touches.length == 1 ) {\n\n\t\t\t\trotateStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\n\t\t\t\tconst y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\n\n\t\t\t\trotateStart.set( x, y );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction handleTouchStartPan( event ) {\n\n\t\t\tif ( event.touches.length == 1 ) {\n\n\t\t\t\tpanStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\n\t\t\t\tconst y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\n\n\t\t\t\tpanStart.set( x, y );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction handleTouchStartDolly( event ) {\n\n\t\t\tconst dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n\t\t\tconst dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\n\t\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\tdollyStart.set( 0, distance );\n\n\t\t}\n\n\t\tfunction handleTouchStartDollyPan( event ) {\n\n\t\t\tif ( scope.enableZoom ) handleTouchStartDolly( event );\n\n\t\t\tif ( scope.enablePan ) handleTouchStartPan( event );\n\n\t\t}\n\n\t\tfunction handleTouchStartDollyRotate( event ) {\n\n\t\t\tif ( scope.enableZoom ) handleTouchStartDolly( event );\n\n\t\t\tif ( scope.enableRotate ) handleTouchStartRotate( event );\n\n\t\t}\n\n\t\tfunction handleTouchMoveRotate( event ) {\n\n\t\t\tif ( event.touches.length == 1 ) {\n\n\t\t\t\trotateEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\n\t\t\t\tconst y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\n\n\t\t\t\trotateEnd.set( x, y );\n\n\t\t\t}\n\n\t\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\n\n\t\t\tconst element = scope.domElement;\n\n\t\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\n\n\t\t\trotateStart.copy( rotateEnd );\n\n\t\t}\n\n\t\tfunction handleTouchMovePan( event ) {\n\n\t\t\tif ( event.touches.length == 1 ) {\n\n\t\t\t\tpanEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n\t\t\t} else {\n\n\t\t\t\tconst x = 0.5 * ( event.touches[ 0 ].pageX + event.touches[ 1 ].pageX );\n\t\t\t\tconst y = 0.5 * ( event.touches[ 0 ].pageY + event.touches[ 1 ].pageY );\n\n\t\t\t\tpanEnd.set( x, y );\n\n\t\t\t}\n\n\t\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\n\n\t\t\tpan( panDelta.x, panDelta.y );\n\n\t\t\tpanStart.copy( panEnd );\n\n\t\t}\n\n\t\tfunction handleTouchMoveDolly( event ) {\n\n\t\t\tconst dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n\t\t\tconst dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\n\t\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\tdollyEnd.set( 0, distance );\n\n\t\t\tdollyDelta.set( 0, Math.pow( dollyEnd.y / dollyStart.y, scope.zoomSpeed ) );\n\n\t\t\tdollyOut( dollyDelta.y );\n\n\t\t\tdollyStart.copy( dollyEnd );\n\n\t\t}\n\n\t\tfunction handleTouchMoveDollyPan( event ) {\n\n\t\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\n\n\t\t\tif ( scope.enablePan ) handleTouchMovePan( event );\n\n\t\t}\n\n\t\tfunction handleTouchMoveDollyRotate( event ) {\n\n\t\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\n\n\t\t\tif ( scope.enableRotate ) handleTouchMoveRotate( event );\n\n\t\t}\n\n\t\tfunction handleTouchEnd( /*event*/ ) {\n\n\t\t\t// no-op\n\n\t\t}\n\n\t\t//\n\t\t// event handlers - FSM: listen for events and reset state\n\t\t//\n\n\t\tfunction onPointerDown( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tswitch ( event.pointerType ) {\n\n\t\t\t\tcase 'mouse':\n\t\t\t\tcase 'pen':\n\t\t\t\t\tonMouseDown( event );\n\t\t\t\t\tbreak;\n\n\t\t\t\t// TODO touch\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerMove( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tswitch ( event.pointerType ) {\n\n\t\t\t\tcase 'mouse':\n\t\t\t\tcase 'pen':\n\t\t\t\t\tonMouseMove( event );\n\t\t\t\t\tbreak;\n\n\t\t\t\t// TODO touch\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerUp( event ) {\n\n\t\t\tswitch ( event.pointerType ) {\n\n\t\t\t\tcase 'mouse':\n\t\t\t\tcase 'pen':\n\t\t\t\t\tonMouseUp( event );\n\t\t\t\t\tbreak;\n\n\t\t\t\t// TODO touch\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onMouseDown( event ) {\n\n\t\t\t// Prevent the browser from scrolling.\n\t\t\tevent.preventDefault();\n\n\t\t\t// Manually set the focus since calling preventDefault above\n\t\t\t// prevents the browser from setting it automatically.\n\n\t\t\tscope.domElement.focus ? scope.domElement.focus() : window.focus();\n\n\t\t\tlet mouseAction;\n\n\t\t\tswitch ( event.button ) {\n\n\t\t\t\tcase 0:\n\n\t\t\t\t\tmouseAction = scope.mouseButtons.LEFT;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 1:\n\n\t\t\t\t\tmouseAction = scope.mouseButtons.MIDDLE;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\n\t\t\t\t\tmouseAction = scope.mouseButtons.RIGHT;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tmouseAction = - 1;\n\n\t\t\t}\n\n\t\t\tswitch ( mouseAction ) {\n\n\t\t\t\tcase MOUSE.DOLLY:\n\n\t\t\t\t\tif ( scope.enableZoom === false ) return;\n\n\t\t\t\t\thandleMouseDownDolly( event );\n\n\t\t\t\t\tstate = STATE.DOLLY;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MOUSE.ROTATE:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\thandleMouseDownPan( event );\n\n\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\thandleMouseDownRotate( event );\n\n\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MOUSE.PAN:\n\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\thandleMouseDownRotate( event );\n\n\t\t\t\t\t\tstate = STATE.ROTATE;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\thandleMouseDownPan( event );\n\n\t\t\t\t\t\tstate = STATE.PAN;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t}\n\n\t\t\tif ( state !== STATE.NONE ) {\n\n\t\t\t\tscope.domElement.ownerDocument.addEventListener( 'pointermove', onPointerMove );\n\t\t\t\tscope.domElement.ownerDocument.addEventListener( 'pointerup', onPointerUp );\n\n\t\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onMouseMove( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tevent.preventDefault();\n\n\t\t\tswitch ( state ) {\n\n\t\t\t\tcase STATE.ROTATE:\n\n\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\thandleMouseMoveRotate( event );\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.DOLLY:\n\n\t\t\t\t\tif ( scope.enableZoom === false ) return;\n\n\t\t\t\t\thandleMouseMoveDolly( event );\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.PAN:\n\n\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\thandleMouseMovePan( event );\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onMouseUp( event ) {\n\n\t\t\tscope.domElement.ownerDocument.removeEventListener( 'pointermove', onPointerMove );\n\t\t\tscope.domElement.ownerDocument.removeEventListener( 'pointerup', onPointerUp );\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\thandleMouseUp( event );\n\n\t\t\tscope.dispatchEvent( _endEvent );\n\n\t\t\tstate = STATE.NONE;\n\n\t\t}\n\n\t\tfunction onMouseWheel( event ) {\n\n\t\t\tif ( scope.enabled === false || scope.enableZoom === false || ( state !== STATE.NONE && state !== STATE.ROTATE ) ) return;\n\n\t\t\tevent.preventDefault();\n\n\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t\thandleMouseWheel( event );\n\n\t\t\tscope.dispatchEvent( _endEvent );\n\n\t\t}\n\n\t\tfunction onKeyDown( event ) {\n\n\t\t\tif ( scope.enabled === false || scope.enablePan === false ) return;\n\n\t\t\thandleKeyDown( event );\n\n\t\t}\n\n\t\tfunction onTouchStart( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tevent.preventDefault(); // prevent scrolling\n\n\t\t\tswitch ( event.touches.length ) {\n\n\t\t\t\tcase 1:\n\n\t\t\t\t\tswitch ( scope.touches.ONE ) {\n\n\t\t\t\t\t\tcase TOUCH.ROTATE:\n\n\t\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartRotate( event );\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_ROTATE;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase TOUCH.PAN:\n\n\t\t\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartPan( event );\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_PAN;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\n\t\t\t\t\tswitch ( scope.touches.TWO ) {\n\n\t\t\t\t\t\tcase TOUCH.DOLLY_PAN:\n\n\t\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartDollyPan( event );\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_PAN;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase TOUCH.DOLLY_ROTATE:\n\n\t\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\n\n\t\t\t\t\t\t\thandleTouchStartDollyRotate( event );\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_ROTATE;\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t}\n\n\t\t\tif ( state !== STATE.NONE ) {\n\n\t\t\t\tscope.dispatchEvent( _startEvent );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onTouchMove( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tevent.preventDefault(); // prevent scrolling\n\n\t\t\tswitch ( state ) {\n\n\t\t\t\tcase STATE.TOUCH_ROTATE:\n\n\t\t\t\t\tif ( scope.enableRotate === false ) return;\n\n\t\t\t\t\thandleTouchMoveRotate( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.TOUCH_PAN:\n\n\t\t\t\t\tif ( scope.enablePan === false ) return;\n\n\t\t\t\t\thandleTouchMovePan( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.TOUCH_DOLLY_PAN:\n\n\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\n\n\t\t\t\t\thandleTouchMoveDollyPan( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase STATE.TOUCH_DOLLY_ROTATE:\n\n\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\n\n\t\t\t\t\thandleTouchMoveDollyRotate( event );\n\n\t\t\t\t\tscope.update();\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tstate = STATE.NONE;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onTouchEnd( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\thandleTouchEnd( event );\n\n\t\t\tscope.dispatchEvent( _endEvent );\n\n\t\t\tstate = STATE.NONE;\n\n\t\t}\n\n\t\tfunction onContextMenu( event ) {\n\n\t\t\tif ( scope.enabled === false ) return;\n\n\t\t\tevent.preventDefault();\n\n\t\t}\n\n\t\t//\n\n\t\tscope.domElement.addEventListener( 'contextmenu', onContextMenu );\n\n\t\tscope.domElement.addEventListener( 'pointerdown', onPointerDown );\n\t\tscope.domElement.addEventListener( 'wheel', onMouseWheel, { passive: false } );\n\n\t\tscope.domElement.addEventListener( 'touchstart', onTouchStart, { passive: false } );\n\t\tscope.domElement.addEventListener( 'touchend', onTouchEnd );\n\t\tscope.domElement.addEventListener( 'touchmove', onTouchMove, { passive: false } );\n\n\t\t// force an update at start\n\n\t\tthis.update();\n\n\t}\n\n}\n\n\n// This set of controls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n// This is very similar to OrbitControls, another set of touch behavior\n//\n//    Orbit - right mouse, or left mouse + ctrl/meta/shiftKey / touch: two-finger rotate\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - left mouse, or arrow keys / touch: one-finger move\n\nclass MapControls extends OrbitControls {\n\n\tconstructor( object, domElement ) {\n\n\t\tsuper( object, domElement );\n\n\t\tthis.screenSpacePanning = false; // pan orthogonal to world-space direction camera.up\n\n\t\tthis.mouseButtons.LEFT = MOUSE.PAN;\n\t\tthis.mouseButtons.RIGHT = MOUSE.ROTATE;\n\n\t\tthis.touches.ONE = TOUCH.PAN;\n\t\tthis.touches.TWO = TOUCH.DOLLY_ROTATE;\n\n\t}\n\n}\n\nexport { OrbitControls, MapControls };\n","/**\n * The Ease class provides a collection of easing functions for use with tween.js.\n */\nvar Easing = {\n    Linear: {\n        None: function (amount) {\n            return amount;\n        },\n    },\n    Quadratic: {\n        In: function (amount) {\n            return amount * amount;\n        },\n        Out: function (amount) {\n            return amount * (2 - amount);\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return 0.5 * amount * amount;\n            }\n            return -0.5 * (--amount * (amount - 2) - 1);\n        },\n    },\n    Cubic: {\n        In: function (amount) {\n            return amount * amount * amount;\n        },\n        Out: function (amount) {\n            return --amount * amount * amount + 1;\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return 0.5 * amount * amount * amount;\n            }\n            return 0.5 * ((amount -= 2) * amount * amount + 2);\n        },\n    },\n    Quartic: {\n        In: function (amount) {\n            return amount * amount * amount * amount;\n        },\n        Out: function (amount) {\n            return 1 - --amount * amount * amount * amount;\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return 0.5 * amount * amount * amount * amount;\n            }\n            return -0.5 * ((amount -= 2) * amount * amount * amount - 2);\n        },\n    },\n    Quintic: {\n        In: function (amount) {\n            return amount * amount * amount * amount * amount;\n        },\n        Out: function (amount) {\n            return --amount * amount * amount * amount * amount + 1;\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return 0.5 * amount * amount * amount * amount * amount;\n            }\n            return 0.5 * ((amount -= 2) * amount * amount * amount * amount + 2);\n        },\n    },\n    Sinusoidal: {\n        In: function (amount) {\n            return 1 - Math.cos((amount * Math.PI) / 2);\n        },\n        Out: function (amount) {\n            return Math.sin((amount * Math.PI) / 2);\n        },\n        InOut: function (amount) {\n            return 0.5 * (1 - Math.cos(Math.PI * amount));\n        },\n    },\n    Exponential: {\n        In: function (amount) {\n            return amount === 0 ? 0 : Math.pow(1024, amount - 1);\n        },\n        Out: function (amount) {\n            return amount === 1 ? 1 : 1 - Math.pow(2, -10 * amount);\n        },\n        InOut: function (amount) {\n            if (amount === 0) {\n                return 0;\n            }\n            if (amount === 1) {\n                return 1;\n            }\n            if ((amount *= 2) < 1) {\n                return 0.5 * Math.pow(1024, amount - 1);\n            }\n            return 0.5 * (-Math.pow(2, -10 * (amount - 1)) + 2);\n        },\n    },\n    Circular: {\n        In: function (amount) {\n            return 1 - Math.sqrt(1 - amount * amount);\n        },\n        Out: function (amount) {\n            return Math.sqrt(1 - --amount * amount);\n        },\n        InOut: function (amount) {\n            if ((amount *= 2) < 1) {\n                return -0.5 * (Math.sqrt(1 - amount * amount) - 1);\n            }\n            return 0.5 * (Math.sqrt(1 - (amount -= 2) * amount) + 1);\n        },\n    },\n    Elastic: {\n        In: function (amount) {\n            if (amount === 0) {\n                return 0;\n            }\n            if (amount === 1) {\n                return 1;\n            }\n            return -Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\n        },\n        Out: function (amount) {\n            if (amount === 0) {\n                return 0;\n            }\n            if (amount === 1) {\n                return 1;\n            }\n            return Math.pow(2, -10 * amount) * Math.sin((amount - 0.1) * 5 * Math.PI) + 1;\n        },\n        InOut: function (amount) {\n            if (amount === 0) {\n                return 0;\n            }\n            if (amount === 1) {\n                return 1;\n            }\n            amount *= 2;\n            if (amount < 1) {\n                return -0.5 * Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\n            }\n            return 0.5 * Math.pow(2, -10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI) + 1;\n        },\n    },\n    Back: {\n        In: function (amount) {\n            var s = 1.70158;\n            return amount * amount * ((s + 1) * amount - s);\n        },\n        Out: function (amount) {\n            var s = 1.70158;\n            return --amount * amount * ((s + 1) * amount + s) + 1;\n        },\n        InOut: function (amount) {\n            var s = 1.70158 * 1.525;\n            if ((amount *= 2) < 1) {\n                return 0.5 * (amount * amount * ((s + 1) * amount - s));\n            }\n            return 0.5 * ((amount -= 2) * amount * ((s + 1) * amount + s) + 2);\n        },\n    },\n    Bounce: {\n        In: function (amount) {\n            return 1 - Easing.Bounce.Out(1 - amount);\n        },\n        Out: function (amount) {\n            if (amount < 1 / 2.75) {\n                return 7.5625 * amount * amount;\n            }\n            else if (amount < 2 / 2.75) {\n                return 7.5625 * (amount -= 1.5 / 2.75) * amount + 0.75;\n            }\n            else if (amount < 2.5 / 2.75) {\n                return 7.5625 * (amount -= 2.25 / 2.75) * amount + 0.9375;\n            }\n            else {\n                return 7.5625 * (amount -= 2.625 / 2.75) * amount + 0.984375;\n            }\n        },\n        InOut: function (amount) {\n            if (amount < 0.5) {\n                return Easing.Bounce.In(amount * 2) * 0.5;\n            }\n            return Easing.Bounce.Out(amount * 2 - 1) * 0.5 + 0.5;\n        },\n    },\n};\n\nvar now;\n// Include a performance.now polyfill.\n// In node.js, use process.hrtime.\n// eslint-disable-next-line\n// @ts-ignore\nif (typeof self === 'undefined' && typeof process !== 'undefined' && process.hrtime) {\n    now = function () {\n        // eslint-disable-next-line\n        // @ts-ignore\n        var time = process.hrtime();\n        // Convert [seconds, nanoseconds] to milliseconds.\n        return time[0] * 1000 + time[1] / 1000000;\n    };\n}\n// In a browser, use self.performance.now if it is available.\nelse if (typeof self !== 'undefined' && self.performance !== undefined && self.performance.now !== undefined) {\n    // This must be bound, because directly assigning this function\n    // leads to an invocation exception in Chrome.\n    now = self.performance.now.bind(self.performance);\n}\n// Use Date.now if it is available.\nelse if (Date.now !== undefined) {\n    now = Date.now;\n}\n// Otherwise, use 'new Date().getTime()'.\nelse {\n    now = function () {\n        return new Date().getTime();\n    };\n}\nvar now$1 = now;\n\n/**\n * Controlling groups of tweens\n *\n * Using the TWEEN singleton to manage your tweens can cause issues in large apps with many components.\n * In these cases, you may want to create your own smaller groups of tween\n */\nvar Group = /** @class */ (function () {\n    function Group() {\n        this._tweens = {};\n        this._tweensAddedDuringUpdate = {};\n    }\n    Group.prototype.getAll = function () {\n        var _this = this;\n        return Object.keys(this._tweens).map(function (tweenId) {\n            return _this._tweens[tweenId];\n        });\n    };\n    Group.prototype.removeAll = function () {\n        this._tweens = {};\n    };\n    Group.prototype.add = function (tween) {\n        this._tweens[tween.getId()] = tween;\n        this._tweensAddedDuringUpdate[tween.getId()] = tween;\n    };\n    Group.prototype.remove = function (tween) {\n        delete this._tweens[tween.getId()];\n        delete this._tweensAddedDuringUpdate[tween.getId()];\n    };\n    Group.prototype.update = function (time, preserve) {\n        if (time === void 0) { time = now$1(); }\n        if (preserve === void 0) { preserve = false; }\n        var tweenIds = Object.keys(this._tweens);\n        if (tweenIds.length === 0) {\n            return false;\n        }\n        // Tweens are updated in \"batches\". If you add a new tween during an\n        // update, then the new tween will be updated in the next batch.\n        // If you remove a tween during an update, it may or may not be updated.\n        // However, if the removed tween was added during the current batch,\n        // then it will not be updated.\n        while (tweenIds.length > 0) {\n            this._tweensAddedDuringUpdate = {};\n            for (var i = 0; i < tweenIds.length; i++) {\n                var tween = this._tweens[tweenIds[i]];\n                var autoStart = !preserve;\n                if (tween && tween.update(time, autoStart) === false && !preserve) {\n                    delete this._tweens[tweenIds[i]];\n                }\n            }\n            tweenIds = Object.keys(this._tweensAddedDuringUpdate);\n        }\n        return true;\n    };\n    return Group;\n}());\n\n/**\n *\n */\nvar Interpolation = {\n    Linear: function (v, k) {\n        var m = v.length - 1;\n        var f = m * k;\n        var i = Math.floor(f);\n        var fn = Interpolation.Utils.Linear;\n        if (k < 0) {\n            return fn(v[0], v[1], f);\n        }\n        if (k > 1) {\n            return fn(v[m], v[m - 1], m - f);\n        }\n        return fn(v[i], v[i + 1 > m ? m : i + 1], f - i);\n    },\n    Bezier: function (v, k) {\n        var b = 0;\n        var n = v.length - 1;\n        var pw = Math.pow;\n        var bn = Interpolation.Utils.Bernstein;\n        for (var i = 0; i <= n; i++) {\n            b += pw(1 - k, n - i) * pw(k, i) * v[i] * bn(n, i);\n        }\n        return b;\n    },\n    CatmullRom: function (v, k) {\n        var m = v.length - 1;\n        var f = m * k;\n        var i = Math.floor(f);\n        var fn = Interpolation.Utils.CatmullRom;\n        if (v[0] === v[m]) {\n            if (k < 0) {\n                i = Math.floor((f = m * (1 + k)));\n            }\n            return fn(v[(i - 1 + m) % m], v[i], v[(i + 1) % m], v[(i + 2) % m], f - i);\n        }\n        else {\n            if (k < 0) {\n                return v[0] - (fn(v[0], v[0], v[1], v[1], -f) - v[0]);\n            }\n            if (k > 1) {\n                return v[m] - (fn(v[m], v[m], v[m - 1], v[m - 1], f - m) - v[m]);\n            }\n            return fn(v[i ? i - 1 : 0], v[i], v[m < i + 1 ? m : i + 1], v[m < i + 2 ? m : i + 2], f - i);\n        }\n    },\n    Utils: {\n        Linear: function (p0, p1, t) {\n            return (p1 - p0) * t + p0;\n        },\n        Bernstein: function (n, i) {\n            var fc = Interpolation.Utils.Factorial;\n            return fc(n) / fc(i) / fc(n - i);\n        },\n        Factorial: (function () {\n            var a = [1];\n            return function (n) {\n                var s = 1;\n                if (a[n]) {\n                    return a[n];\n                }\n                for (var i = n; i > 1; i--) {\n                    s *= i;\n                }\n                a[n] = s;\n                return s;\n            };\n        })(),\n        CatmullRom: function (p0, p1, p2, p3, t) {\n            var v0 = (p2 - p0) * 0.5;\n            var v1 = (p3 - p1) * 0.5;\n            var t2 = t * t;\n            var t3 = t * t2;\n            return (2 * p1 - 2 * p2 + v0 + v1) * t3 + (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;\n        },\n    },\n};\n\n/**\n * Utils\n */\nvar Sequence = /** @class */ (function () {\n    function Sequence() {\n    }\n    Sequence.nextId = function () {\n        return Sequence._nextId++;\n    };\n    Sequence._nextId = 0;\n    return Sequence;\n}());\n\nvar mainGroup = new Group();\n\n/**\n * Tween.js - Licensed under the MIT license\n * https://github.com/tweenjs/tween.js\n * ----------------------------------------------\n *\n * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\n * Thank you all, you're awesome!\n */\nvar Tween = /** @class */ (function () {\n    function Tween(_object, _group) {\n        if (_group === void 0) { _group = mainGroup; }\n        this._object = _object;\n        this._group = _group;\n        this._isPaused = false;\n        this._pauseStart = 0;\n        this._valuesStart = {};\n        this._valuesEnd = {};\n        this._valuesStartRepeat = {};\n        this._duration = 1000;\n        this._initialRepeat = 0;\n        this._repeat = 0;\n        this._yoyo = false;\n        this._isPlaying = false;\n        this._reversed = false;\n        this._delayTime = 0;\n        this._startTime = 0;\n        this._easingFunction = Easing.Linear.None;\n        this._interpolationFunction = Interpolation.Linear;\n        this._chainedTweens = [];\n        this._onStartCallbackFired = false;\n        this._id = Sequence.nextId();\n        this._isChainStopped = false;\n        this._goToEnd = false;\n    }\n    Tween.prototype.getId = function () {\n        return this._id;\n    };\n    Tween.prototype.isPlaying = function () {\n        return this._isPlaying;\n    };\n    Tween.prototype.isPaused = function () {\n        return this._isPaused;\n    };\n    Tween.prototype.to = function (properties, duration) {\n        // TODO? restore this, then update the 07_dynamic_to example to set fox\n        // tween's to on each update. That way the behavior is opt-in (there's\n        // currently no opt-out).\n        // for (const prop in properties) this._valuesEnd[prop] = properties[prop]\n        this._valuesEnd = Object.create(properties);\n        if (duration !== undefined) {\n            this._duration = duration;\n        }\n        return this;\n    };\n    Tween.prototype.duration = function (d) {\n        this._duration = d;\n        return this;\n    };\n    Tween.prototype.start = function (time) {\n        if (this._isPlaying) {\n            return this;\n        }\n        // eslint-disable-next-line\n        this._group && this._group.add(this);\n        this._repeat = this._initialRepeat;\n        if (this._reversed) {\n            // If we were reversed (f.e. using the yoyo feature) then we need to\n            // flip the tween direction back to forward.\n            this._reversed = false;\n            for (var property in this._valuesStartRepeat) {\n                this._swapEndStartRepeatValues(property);\n                this._valuesStart[property] = this._valuesStartRepeat[property];\n            }\n        }\n        this._isPlaying = true;\n        this._isPaused = false;\n        this._onStartCallbackFired = false;\n        this._isChainStopped = false;\n        this._startTime = time !== undefined ? (typeof time === 'string' ? now$1() + parseFloat(time) : time) : now$1();\n        this._startTime += this._delayTime;\n        this._setupProperties(this._object, this._valuesStart, this._valuesEnd, this._valuesStartRepeat);\n        return this;\n    };\n    Tween.prototype._setupProperties = function (_object, _valuesStart, _valuesEnd, _valuesStartRepeat) {\n        for (var property in _valuesEnd) {\n            var startValue = _object[property];\n            var startValueIsArray = Array.isArray(startValue);\n            var propType = startValueIsArray ? 'array' : typeof startValue;\n            var isInterpolationList = !startValueIsArray && Array.isArray(_valuesEnd[property]);\n            // If `to()` specifies a property that doesn't exist in the source object,\n            // we should not set that property in the object\n            if (propType === 'undefined' || propType === 'function') {\n                continue;\n            }\n            // Check if an Array was provided as property value\n            if (isInterpolationList) {\n                var endValues = _valuesEnd[property];\n                if (endValues.length === 0) {\n                    continue;\n                }\n                // handle an array of relative values\n                endValues = endValues.map(this._handleRelativeValue.bind(this, startValue));\n                // Create a local copy of the Array with the start value at the front\n                _valuesEnd[property] = [startValue].concat(endValues);\n            }\n            // handle the deepness of the values\n            if ((propType === 'object' || startValueIsArray) && startValue && !isInterpolationList) {\n                _valuesStart[property] = startValueIsArray ? [] : {};\n                // eslint-disable-next-line\n                for (var prop in startValue) {\n                    // eslint-disable-next-line\n                    // @ts-ignore FIXME?\n                    _valuesStart[property][prop] = startValue[prop];\n                }\n                _valuesStartRepeat[property] = startValueIsArray ? [] : {}; // TODO? repeat nested values? And yoyo? And array values?\n                // eslint-disable-next-line\n                // @ts-ignore FIXME?\n                this._setupProperties(startValue, _valuesStart[property], _valuesEnd[property], _valuesStartRepeat[property]);\n            }\n            else {\n                // Save the starting value, but only once.\n                if (typeof _valuesStart[property] === 'undefined') {\n                    _valuesStart[property] = startValue;\n                }\n                if (!startValueIsArray) {\n                    // eslint-disable-next-line\n                    // @ts-ignore FIXME?\n                    _valuesStart[property] *= 1.0; // Ensures we're using numbers, not strings\n                }\n                if (isInterpolationList) {\n                    // eslint-disable-next-line\n                    // @ts-ignore FIXME?\n                    _valuesStartRepeat[property] = _valuesEnd[property].slice().reverse();\n                }\n                else {\n                    _valuesStartRepeat[property] = _valuesStart[property] || 0;\n                }\n            }\n        }\n    };\n    Tween.prototype.stop = function () {\n        if (!this._isChainStopped) {\n            this._isChainStopped = true;\n            this.stopChainedTweens();\n        }\n        if (!this._isPlaying) {\n            return this;\n        }\n        // eslint-disable-next-line\n        this._group && this._group.remove(this);\n        this._isPlaying = false;\n        this._isPaused = false;\n        if (this._onStopCallback) {\n            this._onStopCallback(this._object);\n        }\n        return this;\n    };\n    Tween.prototype.end = function () {\n        this._goToEnd = true;\n        this.update(Infinity);\n        return this;\n    };\n    Tween.prototype.pause = function (time) {\n        if (time === void 0) { time = now$1(); }\n        if (this._isPaused || !this._isPlaying) {\n            return this;\n        }\n        this._isPaused = true;\n        this._pauseStart = time;\n        // eslint-disable-next-line\n        this._group && this._group.remove(this);\n        return this;\n    };\n    Tween.prototype.resume = function (time) {\n        if (time === void 0) { time = now$1(); }\n        if (!this._isPaused || !this._isPlaying) {\n            return this;\n        }\n        this._isPaused = false;\n        this._startTime += time - this._pauseStart;\n        this._pauseStart = 0;\n        // eslint-disable-next-line\n        this._group && this._group.add(this);\n        return this;\n    };\n    Tween.prototype.stopChainedTweens = function () {\n        for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\n            this._chainedTweens[i].stop();\n        }\n        return this;\n    };\n    Tween.prototype.group = function (group) {\n        this._group = group;\n        return this;\n    };\n    Tween.prototype.delay = function (amount) {\n        this._delayTime = amount;\n        return this;\n    };\n    Tween.prototype.repeat = function (times) {\n        this._initialRepeat = times;\n        this._repeat = times;\n        return this;\n    };\n    Tween.prototype.repeatDelay = function (amount) {\n        this._repeatDelayTime = amount;\n        return this;\n    };\n    Tween.prototype.yoyo = function (yoyo) {\n        this._yoyo = yoyo;\n        return this;\n    };\n    Tween.prototype.easing = function (easingFunction) {\n        this._easingFunction = easingFunction;\n        return this;\n    };\n    Tween.prototype.interpolation = function (interpolationFunction) {\n        this._interpolationFunction = interpolationFunction;\n        return this;\n    };\n    Tween.prototype.chain = function () {\n        var tweens = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            tweens[_i] = arguments[_i];\n        }\n        this._chainedTweens = tweens;\n        return this;\n    };\n    Tween.prototype.onStart = function (callback) {\n        this._onStartCallback = callback;\n        return this;\n    };\n    Tween.prototype.onUpdate = function (callback) {\n        this._onUpdateCallback = callback;\n        return this;\n    };\n    Tween.prototype.onRepeat = function (callback) {\n        this._onRepeatCallback = callback;\n        return this;\n    };\n    Tween.prototype.onComplete = function (callback) {\n        this._onCompleteCallback = callback;\n        return this;\n    };\n    Tween.prototype.onStop = function (callback) {\n        this._onStopCallback = callback;\n        return this;\n    };\n    /**\n     * @returns true if the tween is still playing after the update, false\n     * otherwise (calling update on a paused tween still returns true because\n     * it is still playing, just paused).\n     */\n    Tween.prototype.update = function (time, autoStart) {\n        if (time === void 0) { time = now$1(); }\n        if (autoStart === void 0) { autoStart = true; }\n        if (this._isPaused)\n            return true;\n        var property;\n        var elapsed;\n        var endTime = this._startTime + this._duration;\n        if (!this._goToEnd && !this._isPlaying) {\n            if (time > endTime)\n                return false;\n            if (autoStart)\n                this.start(time);\n        }\n        this._goToEnd = false;\n        if (time < this._startTime) {\n            return true;\n        }\n        if (this._onStartCallbackFired === false) {\n            if (this._onStartCallback) {\n                this._onStartCallback(this._object);\n            }\n            this._onStartCallbackFired = true;\n        }\n        elapsed = (time - this._startTime) / this._duration;\n        elapsed = this._duration === 0 || elapsed > 1 ? 1 : elapsed;\n        var value = this._easingFunction(elapsed);\n        // properties transformations\n        this._updateProperties(this._object, this._valuesStart, this._valuesEnd, value);\n        if (this._onUpdateCallback) {\n            this._onUpdateCallback(this._object, elapsed);\n        }\n        if (elapsed === 1) {\n            if (this._repeat > 0) {\n                if (isFinite(this._repeat)) {\n                    this._repeat--;\n                }\n                // Reassign starting values, restart by making startTime = now\n                for (property in this._valuesStartRepeat) {\n                    if (!this._yoyo && typeof this._valuesEnd[property] === 'string') {\n                        this._valuesStartRepeat[property] =\n                            // eslint-disable-next-line\n                            // @ts-ignore FIXME?\n                            this._valuesStartRepeat[property] + parseFloat(this._valuesEnd[property]);\n                    }\n                    if (this._yoyo) {\n                        this._swapEndStartRepeatValues(property);\n                    }\n                    this._valuesStart[property] = this._valuesStartRepeat[property];\n                }\n                if (this._yoyo) {\n                    this._reversed = !this._reversed;\n                }\n                if (this._repeatDelayTime !== undefined) {\n                    this._startTime = time + this._repeatDelayTime;\n                }\n                else {\n                    this._startTime = time + this._delayTime;\n                }\n                if (this._onRepeatCallback) {\n                    this._onRepeatCallback(this._object);\n                }\n                return true;\n            }\n            else {\n                if (this._onCompleteCallback) {\n                    this._onCompleteCallback(this._object);\n                }\n                for (var i = 0, numChainedTweens = this._chainedTweens.length; i < numChainedTweens; i++) {\n                    // Make the chained tweens start exactly at the time they should,\n                    // even if the `update()` method was called way past the duration of the tween\n                    this._chainedTweens[i].start(this._startTime + this._duration);\n                }\n                this._isPlaying = false;\n                return false;\n            }\n        }\n        return true;\n    };\n    Tween.prototype._updateProperties = function (_object, _valuesStart, _valuesEnd, value) {\n        for (var property in _valuesEnd) {\n            // Don't update properties that do not exist in the source object\n            if (_valuesStart[property] === undefined) {\n                continue;\n            }\n            var start = _valuesStart[property] || 0;\n            var end = _valuesEnd[property];\n            var startIsArray = Array.isArray(_object[property]);\n            var endIsArray = Array.isArray(end);\n            var isInterpolationList = !startIsArray && endIsArray;\n            if (isInterpolationList) {\n                _object[property] = this._interpolationFunction(end, value);\n            }\n            else if (typeof end === 'object' && end) {\n                // eslint-disable-next-line\n                // @ts-ignore FIXME?\n                this._updateProperties(_object[property], start, end, value);\n            }\n            else {\n                // Parses relative end values with start as base (e.g.: +10, -3)\n                end = this._handleRelativeValue(start, end);\n                // Protect against non numeric properties.\n                if (typeof end === 'number') {\n                    // eslint-disable-next-line\n                    // @ts-ignore FIXME?\n                    _object[property] = start + (end - start) * value;\n                }\n            }\n        }\n    };\n    Tween.prototype._handleRelativeValue = function (start, end) {\n        if (typeof end !== 'string') {\n            return end;\n        }\n        if (end.charAt(0) === '+' || end.charAt(0) === '-') {\n            return start + parseFloat(end);\n        }\n        else {\n            return parseFloat(end);\n        }\n    };\n    Tween.prototype._swapEndStartRepeatValues = function (property) {\n        var tmp = this._valuesStartRepeat[property];\n        var endValue = this._valuesEnd[property];\n        if (typeof endValue === 'string') {\n            this._valuesStartRepeat[property] = this._valuesStartRepeat[property] + parseFloat(endValue);\n        }\n        else {\n            this._valuesStartRepeat[property] = this._valuesEnd[property];\n        }\n        this._valuesEnd[property] = tmp;\n    };\n    return Tween;\n}());\n\nvar VERSION = '18.6.4';\n\n/**\n * Tween.js - Licensed under the MIT license\n * https://github.com/tweenjs/tween.js\n * ----------------------------------------------\n *\n * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\n * Thank you all, you're awesome!\n */\nvar nextId = Sequence.nextId;\n/**\n * Controlling groups of tweens\n *\n * Using the TWEEN singleton to manage your tweens can cause issues in large apps with many components.\n * In these cases, you may want to create your own smaller groups of tweens.\n */\nvar TWEEN = mainGroup;\n// This is the best way to export things in a way that's compatible with both ES\n// Modules and CommonJS, without build hacks, and so as not to break the\n// existing API.\n// https://github.com/rollup/rollup/issues/1961#issuecomment-423037881\nvar getAll = TWEEN.getAll.bind(TWEEN);\nvar removeAll = TWEEN.removeAll.bind(TWEEN);\nvar add = TWEEN.add.bind(TWEEN);\nvar remove = TWEEN.remove.bind(TWEEN);\nvar update = TWEEN.update.bind(TWEEN);\nvar exports = {\n    Easing: Easing,\n    Group: Group,\n    Interpolation: Interpolation,\n    now: now$1,\n    Sequence: Sequence,\n    nextId: nextId,\n    Tween: Tween,\n    VERSION: VERSION,\n    getAll: getAll,\n    removeAll: removeAll,\n    add: add,\n    remove: remove,\n    update: update,\n};\n\nexport default exports;\nexport { Easing, Group, Interpolation, Sequence, Tween, VERSION, add, getAll, nextId, now$1 as now, remove, removeAll, update };\n","import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport {\n    WebGLRenderer,\n    Scene,\n    PerspectiveCamera,\n    AmbientLight,\n    DirectionalLight,\n    SphereGeometry,\n    BackSide,\n    Mesh,\n    MeshBasicMaterial,\n    Vector3,\n    MeshLambertMaterial,\n    PlaneGeometry,\n    TextureLoader,\n    Group,\n    RepeatWrapping\n} from 'three';\nimport { VRButton } from 'three/examples/jsm/webxr/VRButton.js';\nimport TWEEN from '@tweenjs/tween.js/dist/tween.esm.js';\n\n// import WebXRPolyfill from 'webxr-polyfill';\n// new WebXRPolyfill();\n\nconst sceneRadius = 500;\n\nconst cameraGroup = new Group();\n\nconst canvas = document.querySelector('canvas');\nconst renderer = new WebGLRenderer({ canvas: canvas, antialias: true });\nrenderer.xr.enabled = true;\nrenderer.logarithmicDepthBuffer = true;\nrenderer.setPixelRatio(window.devicePixelRatio);\n\nconst scene = new Scene();\nscene.name = \"xrGarden\";\nwindow.scene = scene;\nconst camera = new PerspectiveCamera();\ncamera.far = 1000;\ncameraGroup.add(camera);\nscene.add(cameraGroup);\n\nconst controls = new OrbitControls(camera, renderer.domElement);\ncontrols.maxPolarAngle = Math.PI * 0.5;\ncontrols.target = new Vector3(0, 1, -5);\ncamera.position.set(0, 1.6, 0);\ncontrols.update();\n\nfunction onWindowResize() {\n    const w = window.innerWidth;\n    const h = window.innerHeight;\n    camera.aspect = window.innerWidth / window.innerHeight;\n    camera.updateProjectionMatrix();\n    renderer.setSize(w, h);\n}\nwindow.addEventListener('resize', onWindowResize, false);\nonWindowResize();\n\nconst light = new DirectionalLight(0xffaa33);\nlight.position.set(-sceneRadius, sceneRadius, sceneRadius);\nlight.intensity = 1.0;\nscene.add(light);\n// Add the sun\nlight.add(\n    new Mesh(new SphereGeometry(sceneRadius/10, 32, 32), new MeshBasicMaterial({\n        color: 0xffaa33\n    }))\n);\n\nconst light2 = new AmbientLight(0x003973);\nlight2.intensity = 1.0;\nscene.add(light2);\n\nconst skyGeometry = new SphereGeometry(sceneRadius, 50, 50, 0, 2 * Math.PI);\nconst skyMaterial = new MeshBasicMaterial({\n    side: BackSide,\n    depthWrite: false\n});\n\n// Nice sky with a bit of dithering to reduce banding.\nskyMaterial.onBeforeCompile = function (shader) {\n    shader.vertexShader = shader.vertexShader.replace('#include <common>', '#include <common>\\n#define USE_UV');\n    shader.fragmentShader = shader.fragmentShader.replace('#include <common>', `\n    #include <common>\n    #define USE_UV\n    float random (vec2 st) {\n        return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);\n    }\n    `);\n    shader.fragmentShader = shader.fragmentShader.replace('#include <map_fragment>', `\n        vec4 col1;\n        vec4 col2;\n        float mixAmount;\n        if (vUv.y > 0.5) {\n            col1 = vec4( 249, 229, 180, 1 ) / 255.0;\n            col2 = vec4( 0, 57, 115, 1 ) / 255.0;\n            float newY = (vUv.y - 0.5) * 2.0;\n            mixAmount = sqrt(newY)*2.0;\n        } else {\n            col1 = vec4(0.6,0.6,0.6,1.0);\n        }\n        vec4 random4 = vec4((random(vUv)-0.5) * (1.4 / 255.0));\n        diffuseColor *= mix(col1, col2, mixAmount) + random4;\n    `);\n};\nconst skySphere = new Mesh(skyGeometry, skyMaterial);\nskySphere.name = 'skySphere';\nscene.add(skySphere);\n\nconst floorTexture = new TextureLoader().load('https://cdn.glitch.com/3423c223-e1e5-450d-8cfa-2f5215104916%2Fmemphis-mini.png?v=1579618577700');\nfloorTexture.repeat.multiplyScalar(sceneRadius);\nfloorTexture.wrapS = floorTexture.wrapT = RepeatWrapping;\nconst floor = new Mesh(\n    new PlaneGeometry(sceneRadius*2,sceneRadius*2,50,50),\n    new MeshLambertMaterial({\n        map: floorTexture\n    })\n);\nfloor.rotation.x = -Math.PI / 2;\nfloor.name = 'floor';\nscene.add(floor);\n\ndocument.body.appendChild( VRButton.createButton( renderer ) );\n\nconst rafCallbacks = new Set();\nrenderer.setAnimationLoop(function (time) {\n    TWEEN.update(time);\n    rafCallbacks.forEach(cb => cb(time));\n    renderer.render(scene, camera);\n});\n\nexport {\n    renderer,\n    scene,\n    rafCallbacks,\n    cameraGroup,\n    camera\n};","class VRButton {\n\n\tstatic createButton( renderer, options ) {\n\n\t\tif ( options ) {\n\n\t\t\tconsole.error( 'THREE.VRButton: The \"options\" parameter has been removed. Please set the reference space type via renderer.xr.setReferenceSpaceType() instead.' );\n\n\t\t}\n\n\t\tconst button = document.createElement( 'button' );\n\n\t\tfunction showEnterVR( /*device*/ ) {\n\n\t\t\tlet currentSession = null;\n\n\t\t\tasync function onSessionStarted( session ) {\n\n\t\t\t\tsession.addEventListener( 'end', onSessionEnded );\n\n\t\t\t\tawait renderer.xr.setSession( session );\n\t\t\t\tbutton.textContent = 'EXIT VR';\n\n\t\t\t\tcurrentSession = session;\n\n\t\t\t}\n\n\t\t\tfunction onSessionEnded( /*event*/ ) {\n\n\t\t\t\tcurrentSession.removeEventListener( 'end', onSessionEnded );\n\n\t\t\t\tbutton.textContent = 'ENTER VR';\n\n\t\t\t\tcurrentSession = null;\n\n\t\t\t}\n\n\t\t\t//\n\n\t\t\tbutton.style.display = '';\n\n\t\t\tbutton.style.cursor = 'pointer';\n\t\t\tbutton.style.left = 'calc(50% - 50px)';\n\t\t\tbutton.style.width = '100px';\n\n\t\t\tbutton.textContent = 'ENTER VR';\n\n\t\t\tbutton.onmouseenter = function () {\n\n\t\t\t\tbutton.style.opacity = '1.0';\n\n\t\t\t};\n\n\t\t\tbutton.onmouseleave = function () {\n\n\t\t\t\tbutton.style.opacity = '0.5';\n\n\t\t\t};\n\n\t\t\tbutton.onclick = function () {\n\n\t\t\t\tif ( currentSession === null ) {\n\n\t\t\t\t\t// WebXR's requestReferenceSpace only works if the corresponding feature\n\t\t\t\t\t// was requested at session creation time. For simplicity, just ask for\n\t\t\t\t\t// the interesting ones as optional features, but be aware that the\n\t\t\t\t\t// requestReferenceSpace call will fail if it turns out to be unavailable.\n\t\t\t\t\t// ('local' is always available for immersive sessions and doesn't need to\n\t\t\t\t\t// be requested separately.)\n\n\t\t\t\t\tconst sessionInit = { optionalFeatures: [ 'local-floor', 'bounded-floor', 'hand-tracking' ] };\n\t\t\t\t\tnavigator.xr.requestSession( 'immersive-vr', sessionInit ).then( onSessionStarted );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tcurrentSession.end();\n\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t}\n\n\t\tfunction disableButton() {\n\n\t\t\tbutton.style.display = '';\n\n\t\t\tbutton.style.cursor = 'auto';\n\t\t\tbutton.style.left = 'calc(50% - 75px)';\n\t\t\tbutton.style.width = '150px';\n\n\t\t\tbutton.onmouseenter = null;\n\t\t\tbutton.onmouseleave = null;\n\n\t\t\tbutton.onclick = null;\n\n\t\t}\n\n\t\tfunction showWebXRNotFound() {\n\n\t\t\tdisableButton();\n\n\t\t\tbutton.textContent = 'VR NOT SUPPORTED';\n\n\t\t}\n\n\t\tfunction stylizeElement( element ) {\n\n\t\t\telement.style.position = 'absolute';\n\t\t\telement.style.bottom = '20px';\n\t\t\telement.style.padding = '12px 6px';\n\t\t\telement.style.border = '1px solid #fff';\n\t\t\telement.style.borderRadius = '4px';\n\t\t\telement.style.background = 'rgba(0,0,0,0.1)';\n\t\t\telement.style.color = '#fff';\n\t\t\telement.style.font = 'normal 13px sans-serif';\n\t\t\telement.style.textAlign = 'center';\n\t\t\telement.style.opacity = '0.5';\n\t\t\telement.style.outline = 'none';\n\t\t\telement.style.zIndex = '999';\n\n\t\t}\n\n\t\tif ( 'xr' in navigator ) {\n\n\t\t\tbutton.id = 'VRButton';\n\t\t\tbutton.style.display = 'none';\n\n\t\t\tstylizeElement( button );\n\n\t\t\tnavigator.xr.isSessionSupported( 'immersive-vr' ).then( function ( supported ) {\n\n\t\t\t\tsupported ? showEnterVR() : showWebXRNotFound();\n\n\t\t\t} );\n\n\t\t\treturn button;\n\n\t\t} else {\n\n\t\t\tconst message = document.createElement( 'a' );\n\n\t\t\tif ( window.isSecureContext === false ) {\n\n\t\t\t\tmessage.href = document.location.href.replace( /^http:/, 'https:' );\n\t\t\t\tmessage.innerHTML = 'WEBXR NEEDS HTTPS'; // TODO Improve message\n\n\t\t\t} else {\n\n\t\t\t\tmessage.href = 'https://immersiveweb.dev/';\n\t\t\t\tmessage.innerHTML = 'WEBXR NOT AVAILABLE';\n\n\t\t\t}\n\n\t\t\tmessage.style.left = 'calc(50% - 90px)';\n\t\t\tmessage.style.width = '180px';\n\t\t\tmessage.style.textDecoration = 'none';\n\n\t\t\tstylizeElement( message );\n\n\t\t\treturn message;\n\n\t\t}\n\n\t}\n\n}\n\nexport { VRButton };\n","import {\n\tAnimationClip,\n\tBone,\n\tBox3,\n\tBufferAttribute,\n\tBufferGeometry,\n\tCanvasTexture,\n\tClampToEdgeWrapping,\n\tColor,\n\tDirectionalLight,\n\tDoubleSide,\n\tFileLoader,\n\tFrontSide,\n\tGroup,\n\tImageBitmapLoader,\n\tInterleavedBuffer,\n\tInterleavedBufferAttribute,\n\tInterpolant,\n\tInterpolateDiscrete,\n\tInterpolateLinear,\n\tLine,\n\tLineBasicMaterial,\n\tLineLoop,\n\tLineSegments,\n\tLinearFilter,\n\tLinearMipmapLinearFilter,\n\tLinearMipmapNearestFilter,\n\tLoader,\n\tLoaderUtils,\n\tMaterial,\n\tMathUtils,\n\tMatrix4,\n\tMesh,\n\tMeshBasicMaterial,\n\tMeshPhysicalMaterial,\n\tMeshStandardMaterial,\n\tMirroredRepeatWrapping,\n\tNearestFilter,\n\tNearestMipmapLinearFilter,\n\tNearestMipmapNearestFilter,\n\tNumberKeyframeTrack,\n\tObject3D,\n\tOrthographicCamera,\n\tPerspectiveCamera,\n\tPointLight,\n\tPoints,\n\tPointsMaterial,\n\tPropertyBinding,\n\tQuaternionKeyframeTrack,\n\tRGBFormat,\n\tRepeatWrapping,\n\tSkeleton,\n\tSkinnedMesh,\n\tSphere,\n\tSpotLight,\n\tTangentSpaceNormalMap,\n\tTextureLoader,\n\tTriangleFanDrawMode,\n\tTriangleStripDrawMode,\n\tVector2,\n\tVector3,\n\tVectorKeyframeTrack,\n\tsRGBEncoding\n} from 'three';\n\nclass GLTFLoader extends Loader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\tthis.dracoLoader = null;\n\t\tthis.ktx2Loader = null;\n\t\tthis.meshoptDecoder = null;\n\n\t\tthis.pluginCallbacks = [];\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsClearcoatExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureBasisUExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureWebPExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsTransmissionExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFLightsExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMeshoptCompression( parser );\n\n\t\t} );\n\n\t}\n\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst scope = this;\n\n\t\tlet resourcePath;\n\n\t\tif ( this.resourcePath !== '' ) {\n\n\t\t\tresourcePath = this.resourcePath;\n\n\t\t} else if ( this.path !== '' ) {\n\n\t\t\tresourcePath = this.path;\n\n\t\t} else {\n\n\t\t\tresourcePath = LoaderUtils.extractUrlBase( url );\n\n\t\t}\n\n\t\t// Tells the LoadingManager to track an extra item, which resolves after\n\t\t// the model is fully loaded. This means the count of items loaded will\n\t\t// be incorrect, but ensures manager.onLoad() does not fire early.\n\t\tthis.manager.itemStart( url );\n\n\t\tconst _onError = function ( e ) {\n\n\t\t\tif ( onError ) {\n\n\t\t\t\tonError( e );\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( e );\n\n\t\t\t}\n\n\t\t\tscope.manager.itemError( url );\n\t\t\tscope.manager.itemEnd( url );\n\n\t\t};\n\n\t\tconst loader = new FileLoader( this.manager );\n\n\t\tloader.setPath( this.path );\n\t\tloader.setResponseType( 'arraybuffer' );\n\t\tloader.setRequestHeader( this.requestHeader );\n\t\tloader.setWithCredentials( this.withCredentials );\n\n\t\tloader.load( url, function ( data ) {\n\n\t\t\ttry {\n\n\t\t\t\tscope.parse( data, resourcePath, function ( gltf ) {\n\n\t\t\t\t\tonLoad( gltf );\n\n\t\t\t\t\tscope.manager.itemEnd( url );\n\n\t\t\t\t}, _onError );\n\n\t\t\t} catch ( e ) {\n\n\t\t\t\t_onError( e );\n\n\t\t\t}\n\n\t\t}, onProgress, _onError );\n\n\t}\n\n\tsetDRACOLoader( dracoLoader ) {\n\n\t\tthis.dracoLoader = dracoLoader;\n\t\treturn this;\n\n\t}\n\n\tsetDDSLoader() {\n\n\t\tthrow new Error(\n\n\t\t\t'THREE.GLTFLoader: \"MSFT_texture_dds\" no longer supported. Please update to \"KHR_texture_basisu\".'\n\n\t\t);\n\n\t}\n\n\tsetKTX2Loader( ktx2Loader ) {\n\n\t\tthis.ktx2Loader = ktx2Loader;\n\t\treturn this;\n\n\t}\n\n\tsetMeshoptDecoder( meshoptDecoder ) {\n\n\t\tthis.meshoptDecoder = meshoptDecoder;\n\t\treturn this;\n\n\t}\n\n\tregister( callback ) {\n\n\t\tif ( this.pluginCallbacks.indexOf( callback ) === - 1 ) {\n\n\t\t\tthis.pluginCallbacks.push( callback );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\tunregister( callback ) {\n\n\t\tif ( this.pluginCallbacks.indexOf( callback ) !== - 1 ) {\n\n\t\t\tthis.pluginCallbacks.splice( this.pluginCallbacks.indexOf( callback ), 1 );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\tparse( data, path, onLoad, onError ) {\n\n\t\tlet content;\n\t\tconst extensions = {};\n\t\tconst plugins = {};\n\n\t\tif ( typeof data === 'string' ) {\n\n\t\t\tcontent = data;\n\n\t\t} else {\n\n\t\t\tconst magic = LoaderUtils.decodeText( new Uint8Array( data, 0, 4 ) );\n\n\t\t\tif ( magic === BINARY_EXTENSION_HEADER_MAGIC ) {\n\n\t\t\t\ttry {\n\n\t\t\t\t\textensions[ EXTENSIONS.KHR_BINARY_GLTF ] = new GLTFBinaryExtension( data );\n\n\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\tif ( onError ) onError( error );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t\tcontent = extensions[ EXTENSIONS.KHR_BINARY_GLTF ].content;\n\n\t\t\t} else {\n\n\t\t\t\tcontent = LoaderUtils.decodeText( new Uint8Array( data ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst json = JSON.parse( content );\n\n\t\tif ( json.asset === undefined || json.asset.version[ 0 ] < 2 ) {\n\n\t\t\tif ( onError ) onError( new Error( 'THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.' ) );\n\t\t\treturn;\n\n\t\t}\n\n\t\tconst parser = new GLTFParser( json, {\n\n\t\t\tpath: path || this.resourcePath || '',\n\t\t\tcrossOrigin: this.crossOrigin,\n\t\t\trequestHeader: this.requestHeader,\n\t\t\tmanager: this.manager,\n\t\t\tktx2Loader: this.ktx2Loader,\n\t\t\tmeshoptDecoder: this.meshoptDecoder\n\n\t\t} );\n\n\t\tparser.fileLoader.setRequestHeader( this.requestHeader );\n\n\t\tfor ( let i = 0; i < this.pluginCallbacks.length; i ++ ) {\n\n\t\t\tconst plugin = this.pluginCallbacks[ i ]( parser );\n\t\t\tplugins[ plugin.name ] = plugin;\n\n\t\t\t// Workaround to avoid determining as unknown extension\n\t\t\t// in addUnknownExtensionsToUserData().\n\t\t\t// Remove this workaround if we move all the existing\n\t\t\t// extension handlers to plugin system\n\t\t\textensions[ plugin.name ] = true;\n\n\t\t}\n\n\t\tif ( json.extensionsUsed ) {\n\n\t\t\tfor ( let i = 0; i < json.extensionsUsed.length; ++ i ) {\n\n\t\t\t\tconst extensionName = json.extensionsUsed[ i ];\n\t\t\t\tconst extensionsRequired = json.extensionsRequired || [];\n\n\t\t\t\tswitch ( extensionName ) {\n\n\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_UNLIT:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMaterialsUnlitExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMaterialsPbrSpecularGlossinessExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFDracoMeshCompressionExtension( json, this.dracoLoader );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_TEXTURE_TRANSFORM:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFTextureTransformExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_MESH_QUANTIZATION:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMeshQuantizationExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tif ( extensionsRequired.indexOf( extensionName ) >= 0 && plugins[ extensionName ] === undefined ) {\n\n\t\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Unknown extension \"' + extensionName + '\".' );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tparser.setExtensions( extensions );\n\t\tparser.setPlugins( plugins );\n\t\tparser.parse( onLoad, onError );\n\n\t}\n\n}\n\n/* GLTFREGISTRY */\n\nfunction GLTFRegistry() {\n\n\tlet objects = {};\n\n\treturn\t{\n\n\t\tget: function ( key ) {\n\n\t\t\treturn objects[ key ];\n\n\t\t},\n\n\t\tadd: function ( key, object ) {\n\n\t\t\tobjects[ key ] = object;\n\n\t\t},\n\n\t\tremove: function ( key ) {\n\n\t\t\tdelete objects[ key ];\n\n\t\t},\n\n\t\tremoveAll: function () {\n\n\t\t\tobjects = {};\n\n\t\t}\n\n\t};\n\n}\n\n/*********************************/\n/********** EXTENSIONS ***********/\n/*********************************/\n\nconst EXTENSIONS = {\n\tKHR_BINARY_GLTF: 'KHR_binary_glTF',\n\tKHR_DRACO_MESH_COMPRESSION: 'KHR_draco_mesh_compression',\n\tKHR_LIGHTS_PUNCTUAL: 'KHR_lights_punctual',\n\tKHR_MATERIALS_CLEARCOAT: 'KHR_materials_clearcoat',\n\tKHR_MATERIALS_PBR_SPECULAR_GLOSSINESS: 'KHR_materials_pbrSpecularGlossiness',\n\tKHR_MATERIALS_TRANSMISSION: 'KHR_materials_transmission',\n\tKHR_MATERIALS_UNLIT: 'KHR_materials_unlit',\n\tKHR_TEXTURE_BASISU: 'KHR_texture_basisu',\n\tKHR_TEXTURE_TRANSFORM: 'KHR_texture_transform',\n\tKHR_MESH_QUANTIZATION: 'KHR_mesh_quantization',\n\tEXT_TEXTURE_WEBP: 'EXT_texture_webp',\n\tEXT_MESHOPT_COMPRESSION: 'EXT_meshopt_compression'\n};\n\n/**\n * Punctual Lights Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual\n */\nclass GLTFLightsExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_LIGHTS_PUNCTUAL;\n\n\t\t// Object3D instance caches\n\t\tthis.cache = { refs: {}, uses: {} };\n\n\t}\n\n\t_markDefs() {\n\n\t\tconst parser = this.parser;\n\t\tconst nodeDefs = this.parser.json.nodes || [];\n\n\t\tfor ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\n\n\t\t\tconst nodeDef = nodeDefs[ nodeIndex ];\n\n\t\t\tif ( nodeDef.extensions\n\t\t\t\t\t&& nodeDef.extensions[ this.name ]\n\t\t\t\t\t&& nodeDef.extensions[ this.name ].light !== undefined ) {\n\n\t\t\t\tparser._addNodeRef( this.cache, nodeDef.extensions[ this.name ].light );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t_loadLight( lightIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst cacheKey = 'light:' + lightIndex;\n\t\tlet dependency = parser.cache.get( cacheKey );\n\n\t\tif ( dependency ) return dependency;\n\n\t\tconst json = parser.json;\n\t\tconst extensions = ( json.extensions && json.extensions[ this.name ] ) || {};\n\t\tconst lightDefs = extensions.lights || [];\n\t\tconst lightDef = lightDefs[ lightIndex ];\n\t\tlet lightNode;\n\n\t\tconst color = new Color( 0xffffff );\n\n\t\tif ( lightDef.color !== undefined ) color.fromArray( lightDef.color );\n\n\t\tconst range = lightDef.range !== undefined ? lightDef.range : 0;\n\n\t\tswitch ( lightDef.type ) {\n\n\t\t\tcase 'directional':\n\t\t\t\tlightNode = new DirectionalLight( color );\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\n\t\t\t\tlightNode.add( lightNode.target );\n\t\t\t\tbreak;\n\n\t\t\tcase 'point':\n\t\t\t\tlightNode = new PointLight( color );\n\t\t\t\tlightNode.distance = range;\n\t\t\t\tbreak;\n\n\t\t\tcase 'spot':\n\t\t\t\tlightNode = new SpotLight( color );\n\t\t\t\tlightNode.distance = range;\n\t\t\t\t// Handle spotlight properties.\n\t\t\t\tlightDef.spot = lightDef.spot || {};\n\t\t\t\tlightDef.spot.innerConeAngle = lightDef.spot.innerConeAngle !== undefined ? lightDef.spot.innerConeAngle : 0;\n\t\t\t\tlightDef.spot.outerConeAngle = lightDef.spot.outerConeAngle !== undefined ? lightDef.spot.outerConeAngle : Math.PI / 4.0;\n\t\t\t\tlightNode.angle = lightDef.spot.outerConeAngle;\n\t\t\t\tlightNode.penumbra = 1.0 - lightDef.spot.innerConeAngle / lightDef.spot.outerConeAngle;\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\n\t\t\t\tlightNode.add( lightNode.target );\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Unexpected light type: ' + lightDef.type );\n\n\t\t}\n\n\t\t// Some lights (e.g. spot) default to a position other than the origin. Reset the position\n\t\t// here, because node-level parsing will only override position if explicitly specified.\n\t\tlightNode.position.set( 0, 0, 0 );\n\n\t\tlightNode.decay = 2;\n\n\t\tif ( lightDef.intensity !== undefined ) lightNode.intensity = lightDef.intensity;\n\n\t\tlightNode.name = parser.createUniqueName( lightDef.name || ( 'light_' + lightIndex ) );\n\n\t\tdependency = Promise.resolve( lightNode );\n\n\t\tparser.cache.add( cacheKey, dependency );\n\n\t\treturn dependency;\n\n\t}\n\n\tcreateNodeAttachment( nodeIndex ) {\n\n\t\tconst self = this;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\t\tconst lightDef = ( nodeDef.extensions && nodeDef.extensions[ this.name ] ) || {};\n\t\tconst lightIndex = lightDef.light;\n\n\t\tif ( lightIndex === undefined ) return null;\n\n\t\treturn this._loadLight( lightIndex ).then( function ( light ) {\n\n\t\t\treturn parser._getNodeRef( self.cache, lightIndex, light );\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * Unlit Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_unlit\n */\nclass GLTFMaterialsUnlitExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_UNLIT;\n\n\t}\n\n\tgetMaterialType() {\n\n\t\treturn MeshBasicMaterial;\n\n\t}\n\n\textendParams( materialParams, materialDef, parser ) {\n\n\t\tconst pending = [];\n\n\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\n\t\tmaterialParams.opacity = 1.0;\n\n\t\tconst metallicRoughness = materialDef.pbrMetallicRoughness;\n\n\t\tif ( metallicRoughness ) {\n\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\n\n\t\t\t\tconst array = metallicRoughness.baseColorFactor;\n\n\t\t\t\tmaterialParams.color.fromArray( array );\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\n\n\t\t\t}\n\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Clearcoat Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_clearcoat\n */\nclass GLTFMaterialsClearcoatExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_CLEARCOAT;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.clearcoatFactor !== undefined ) {\n\n\t\t\tmaterialParams.clearcoat = extension.clearcoatFactor;\n\n\t\t}\n\n\t\tif ( extension.clearcoatTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatMap', extension.clearcoatTexture ) );\n\n\t\t}\n\n\t\tif ( extension.clearcoatRoughnessFactor !== undefined ) {\n\n\t\t\tmaterialParams.clearcoatRoughness = extension.clearcoatRoughnessFactor;\n\n\t\t}\n\n\t\tif ( extension.clearcoatRoughnessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatRoughnessMap', extension.clearcoatRoughnessTexture ) );\n\n\t\t}\n\n\t\tif ( extension.clearcoatNormalTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatNormalMap', extension.clearcoatNormalTexture ) );\n\n\t\t\tif ( extension.clearcoatNormalTexture.scale !== undefined ) {\n\n\t\t\t\tconst scale = extension.clearcoatNormalTexture.scale;\n\n\t\t\t\t// https://github.com/mrdoob/three.js/issues/11438#issuecomment-507003995\n\t\t\t\tmaterialParams.clearcoatNormalScale = new Vector2( scale, - scale );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Transmission Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_transmission\n * Draft: https://github.com/KhronosGroup/glTF/pull/1698\n */\nclass GLTFMaterialsTransmissionExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_TRANSMISSION;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.transmissionFactor !== undefined ) {\n\n\t\t\tmaterialParams.transmission = extension.transmissionFactor;\n\n\t\t}\n\n\t\tif ( extension.transmissionTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'transmissionMap', extension.transmissionTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * BasisU Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_basisu\n */\nclass GLTFTextureBasisUExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_BASISU;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ this.name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ this.name ];\n\t\tconst source = json.images[ extension.source ];\n\t\tconst loader = parser.options.ktx2Loader;\n\n\t\tif ( ! loader ) {\n\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\n\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures' );\n\n\t\t\t} else {\n\n\t\t\t\t// Assumes that the extension is optional and that a fallback texture is present\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn parser.loadTextureImage( textureIndex, source, loader );\n\n\t}\n\n}\n\n/**\n * WebP Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_webp\n */\nclass GLTFTextureWebPExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.EXT_TEXTURE_WEBP;\n\t\tthis.isSupported = null;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst name = this.name;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ name ];\n\t\tconst source = json.images[ extension.source ];\n\n\t\tlet loader = parser.textureLoader;\n\t\tif ( source.uri ) {\n\n\t\t\tconst handler = parser.options.manager.getHandler( source.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn this.detectSupport().then( function ( isSupported ) {\n\n\t\t\tif ( isSupported ) return parser.loadTextureImage( textureIndex, source, loader );\n\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( name ) >= 0 ) {\n\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: WebP required by asset but unsupported.' );\n\n\t\t\t}\n\n\t\t\t// Fall back to PNG or JPEG.\n\t\t\treturn parser.loadTexture( textureIndex );\n\n\t\t} );\n\n\t}\n\n\tdetectSupport() {\n\n\t\tif ( ! this.isSupported ) {\n\n\t\t\tthis.isSupported = new Promise( function ( resolve ) {\n\n\t\t\t\tconst image = new Image();\n\n\t\t\t\t// Lossy test image. Support for lossy images doesn't guarantee support for all\n\t\t\t\t// WebP images, unfortunately.\n\t\t\t\timage.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';\n\n\t\t\t\timage.onload = image.onerror = function () {\n\n\t\t\t\t\tresolve( image.height === 1 );\n\n\t\t\t\t};\n\n\t\t\t} );\n\n\t\t}\n\n\t\treturn this.isSupported;\n\n\t}\n\n}\n\n/**\n * meshopt BufferView Compression Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_meshopt_compression\n */\nclass GLTFMeshoptCompression {\n\n\tconstructor( parser ) {\n\n\t\tthis.name = EXTENSIONS.EXT_MESHOPT_COMPRESSION;\n\t\tthis.parser = parser;\n\n\t}\n\n\tloadBufferView( index ) {\n\n\t\tconst json = this.parser.json;\n\t\tconst bufferView = json.bufferViews[ index ];\n\n\t\tif ( bufferView.extensions && bufferView.extensions[ this.name ] ) {\n\n\t\t\tconst extensionDef = bufferView.extensions[ this.name ];\n\n\t\t\tconst buffer = this.parser.getDependency( 'buffer', extensionDef.buffer );\n\t\t\tconst decoder = this.parser.options.meshoptDecoder;\n\n\t\t\tif ( ! decoder || ! decoder.supported ) {\n\n\t\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\n\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files' );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Assumes that the extension is optional and that fallback buffer data is present\n\t\t\t\t\treturn null;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn Promise.all( [ buffer, decoder.ready ] ).then( function ( res ) {\n\n\t\t\t\tconst byteOffset = extensionDef.byteOffset || 0;\n\t\t\t\tconst byteLength = extensionDef.byteLength || 0;\n\n\t\t\t\tconst count = extensionDef.count;\n\t\t\t\tconst stride = extensionDef.byteStride;\n\n\t\t\t\tconst result = new ArrayBuffer( count * stride );\n\t\t\t\tconst source = new Uint8Array( res[ 0 ], byteOffset, byteLength );\n\n\t\t\t\tdecoder.decodeGltfBuffer( new Uint8Array( result ), count, stride, source, extensionDef.mode, extensionDef.filter );\n\t\t\t\treturn result;\n\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t}\n\n}\n\n/* BINARY EXTENSION */\nconst BINARY_EXTENSION_HEADER_MAGIC = 'glTF';\nconst BINARY_EXTENSION_HEADER_LENGTH = 12;\nconst BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4E4F534A, BIN: 0x004E4942 };\n\nclass GLTFBinaryExtension {\n\n\tconstructor( data ) {\n\n\t\tthis.name = EXTENSIONS.KHR_BINARY_GLTF;\n\t\tthis.content = null;\n\t\tthis.body = null;\n\n\t\tconst headerView = new DataView( data, 0, BINARY_EXTENSION_HEADER_LENGTH );\n\n\t\tthis.header = {\n\t\t\tmagic: LoaderUtils.decodeText( new Uint8Array( data.slice( 0, 4 ) ) ),\n\t\t\tversion: headerView.getUint32( 4, true ),\n\t\t\tlength: headerView.getUint32( 8, true )\n\t\t};\n\n\t\tif ( this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported glTF-Binary header.' );\n\n\t\t} else if ( this.header.version < 2.0 ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Legacy binary file detected.' );\n\n\t\t}\n\n\t\tconst chunkContentsLength = this.header.length - BINARY_EXTENSION_HEADER_LENGTH;\n\t\tconst chunkView = new DataView( data, BINARY_EXTENSION_HEADER_LENGTH );\n\t\tlet chunkIndex = 0;\n\n\t\twhile ( chunkIndex < chunkContentsLength ) {\n\n\t\t\tconst chunkLength = chunkView.getUint32( chunkIndex, true );\n\t\t\tchunkIndex += 4;\n\n\t\t\tconst chunkType = chunkView.getUint32( chunkIndex, true );\n\t\t\tchunkIndex += 4;\n\n\t\t\tif ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON ) {\n\n\t\t\t\tconst contentArray = new Uint8Array( data, BINARY_EXTENSION_HEADER_LENGTH + chunkIndex, chunkLength );\n\t\t\t\tthis.content = LoaderUtils.decodeText( contentArray );\n\n\t\t\t} else if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN ) {\n\n\t\t\t\tconst byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;\n\t\t\t\tthis.body = data.slice( byteOffset, byteOffset + chunkLength );\n\n\t\t\t}\n\n\t\t\t// Clients must ignore chunks with unknown types.\n\n\t\t\tchunkIndex += chunkLength;\n\n\t\t}\n\n\t\tif ( this.content === null ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: JSON content not found.' );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * DRACO Mesh Compression Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_draco_mesh_compression\n */\nclass GLTFDracoMeshCompressionExtension {\n\n\tconstructor( json, dracoLoader ) {\n\n\t\tif ( ! dracoLoader ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: No DRACOLoader instance provided.' );\n\n\t\t}\n\n\t\tthis.name = EXTENSIONS.KHR_DRACO_MESH_COMPRESSION;\n\t\tthis.json = json;\n\t\tthis.dracoLoader = dracoLoader;\n\t\tthis.dracoLoader.preload();\n\n\t}\n\n\tdecodePrimitive( primitive, parser ) {\n\n\t\tconst json = this.json;\n\t\tconst dracoLoader = this.dracoLoader;\n\t\tconst bufferViewIndex = primitive.extensions[ this.name ].bufferView;\n\t\tconst gltfAttributeMap = primitive.extensions[ this.name ].attributes;\n\t\tconst threeAttributeMap = {};\n\t\tconst attributeNormalizedMap = {};\n\t\tconst attributeTypeMap = {};\n\n\t\tfor ( const attributeName in gltfAttributeMap ) {\n\n\t\t\tconst threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\n\n\t\t\tthreeAttributeMap[ threeAttributeName ] = gltfAttributeMap[ attributeName ];\n\n\t\t}\n\n\t\tfor ( const attributeName in primitive.attributes ) {\n\n\t\t\tconst threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\n\n\t\t\tif ( gltfAttributeMap[ attributeName ] !== undefined ) {\n\n\t\t\t\tconst accessorDef = json.accessors[ primitive.attributes[ attributeName ] ];\n\t\t\t\tconst componentType = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\n\t\t\t\tattributeTypeMap[ threeAttributeName ] = componentType;\n\t\t\t\tattributeNormalizedMap[ threeAttributeName ] = accessorDef.normalized === true;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn parser.getDependency( 'bufferView', bufferViewIndex ).then( function ( bufferView ) {\n\n\t\t\treturn new Promise( function ( resolve ) {\n\n\t\t\t\tdracoLoader.decodeDracoFile( bufferView, function ( geometry ) {\n\n\t\t\t\t\tfor ( const attributeName in geometry.attributes ) {\n\n\t\t\t\t\t\tconst attribute = geometry.attributes[ attributeName ];\n\t\t\t\t\t\tconst normalized = attributeNormalizedMap[ attributeName ];\n\n\t\t\t\t\t\tif ( normalized !== undefined ) attribute.normalized = normalized;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve( geometry );\n\n\t\t\t\t}, threeAttributeMap, attributeTypeMap );\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * Texture Transform Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_transform\n */\nclass GLTFTextureTransformExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_TRANSFORM;\n\n\t}\n\n\textendTexture( texture, transform ) {\n\n\t\tif ( transform.texCoord !== undefined ) {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Custom UV sets in \"' + this.name + '\" extension not yet supported.' );\n\n\t\t}\n\n\t\tif ( transform.offset === undefined && transform.rotation === undefined && transform.scale === undefined ) {\n\n\t\t\t// See https://github.com/mrdoob/three.js/issues/21819.\n\t\t\treturn texture;\n\n\t\t}\n\n\t\ttexture = texture.clone();\n\n\t\tif ( transform.offset !== undefined ) {\n\n\t\t\ttexture.offset.fromArray( transform.offset );\n\n\t\t}\n\n\t\tif ( transform.rotation !== undefined ) {\n\n\t\t\ttexture.rotation = transform.rotation;\n\n\t\t}\n\n\t\tif ( transform.scale !== undefined ) {\n\n\t\t\ttexture.repeat.fromArray( transform.scale );\n\n\t\t}\n\n\t\ttexture.needsUpdate = true;\n\n\t\treturn texture;\n\n\t}\n\n}\n\n/**\n * Specular-Glossiness Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_pbrSpecularGlossiness\n */\n\n/**\n * A sub class of StandardMaterial with some of the functionality\n * changed via the `onBeforeCompile` callback\n * @pailhead\n */\nclass GLTFMeshStandardSGMaterial extends MeshStandardMaterial {\n\n\tconstructor( params ) {\n\n\t\tsuper();\n\n\t\tthis.isGLTFSpecularGlossinessMaterial = true;\n\n\t\t//various chunks that need replacing\n\t\tconst specularMapParsFragmentChunk = [\n\t\t\t'#ifdef USE_SPECULARMAP',\n\t\t\t'\tuniform sampler2D specularMap;',\n\t\t\t'#endif'\n\t\t].join( '\\n' );\n\n\t\tconst glossinessMapParsFragmentChunk = [\n\t\t\t'#ifdef USE_GLOSSINESSMAP',\n\t\t\t'\tuniform sampler2D glossinessMap;',\n\t\t\t'#endif'\n\t\t].join( '\\n' );\n\n\t\tconst specularMapFragmentChunk = [\n\t\t\t'vec3 specularFactor = specular;',\n\t\t\t'#ifdef USE_SPECULARMAP',\n\t\t\t'\tvec4 texelSpecular = texture2D( specularMap, vUv );',\n\t\t\t'\ttexelSpecular = sRGBToLinear( texelSpecular );',\n\t\t\t'\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture',\n\t\t\t'\tspecularFactor *= texelSpecular.rgb;',\n\t\t\t'#endif'\n\t\t].join( '\\n' );\n\n\t\tconst glossinessMapFragmentChunk = [\n\t\t\t'float glossinessFactor = glossiness;',\n\t\t\t'#ifdef USE_GLOSSINESSMAP',\n\t\t\t'\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );',\n\t\t\t'\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture',\n\t\t\t'\tglossinessFactor *= texelGlossiness.a;',\n\t\t\t'#endif'\n\t\t].join( '\\n' );\n\n\t\tconst lightPhysicalFragmentChunk = [\n\t\t\t'PhysicalMaterial material;',\n\t\t\t'material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );',\n\t\t\t'vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );',\n\t\t\t'float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );',\n\t\t\t'material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.',\n\t\t\t'material.specularRoughness += geometryRoughness;',\n\t\t\t'material.specularRoughness = min( material.specularRoughness, 1.0 );',\n\t\t\t'material.specularColor = specularFactor;',\n\t\t].join( '\\n' );\n\n\t\tconst uniforms = {\n\t\t\tspecular: { value: new Color().setHex( 0xffffff ) },\n\t\t\tglossiness: { value: 1 },\n\t\t\tspecularMap: { value: null },\n\t\t\tglossinessMap: { value: null }\n\t\t};\n\n\t\tthis._extraUniforms = uniforms;\n\n\t\tthis.onBeforeCompile = function ( shader ) {\n\n\t\t\tfor ( const uniformName in uniforms ) {\n\n\t\t\t\tshader.uniforms[ uniformName ] = uniforms[ uniformName ];\n\n\t\t\t}\n\n\t\t\tshader.fragmentShader = shader.fragmentShader\n\t\t\t\t.replace( 'uniform float roughness;', 'uniform vec3 specular;' )\n\t\t\t\t.replace( 'uniform float metalness;', 'uniform float glossiness;' )\n\t\t\t\t.replace( '#include <roughnessmap_pars_fragment>', specularMapParsFragmentChunk )\n\t\t\t\t.replace( '#include <metalnessmap_pars_fragment>', glossinessMapParsFragmentChunk )\n\t\t\t\t.replace( '#include <roughnessmap_fragment>', specularMapFragmentChunk )\n\t\t\t\t.replace( '#include <metalnessmap_fragment>', glossinessMapFragmentChunk )\n\t\t\t\t.replace( '#include <lights_physical_fragment>', lightPhysicalFragmentChunk );\n\n\t\t};\n\n\t\tObject.defineProperties( this, {\n\n\t\t\tspecular: {\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn uniforms.specular.value;\n\n\t\t\t\t},\n\t\t\t\tset: function ( v ) {\n\n\t\t\t\t\tuniforms.specular.value = v;\n\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tspecularMap: {\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn uniforms.specularMap.value;\n\n\t\t\t\t},\n\t\t\t\tset: function ( v ) {\n\n\t\t\t\t\tuniforms.specularMap.value = v;\n\n\t\t\t\t\tif ( v ) {\n\n\t\t\t\t\t\tthis.defines.USE_SPECULARMAP = ''; // USE_UV is set by the renderer for specular maps\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tdelete this.defines.USE_SPECULARMAP;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tglossiness: {\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn uniforms.glossiness.value;\n\n\t\t\t\t},\n\t\t\t\tset: function ( v ) {\n\n\t\t\t\t\tuniforms.glossiness.value = v;\n\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tglossinessMap: {\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn uniforms.glossinessMap.value;\n\n\t\t\t\t},\n\t\t\t\tset: function ( v ) {\n\n\t\t\t\t\tuniforms.glossinessMap.value = v;\n\n\t\t\t\t\tif ( v ) {\n\n\t\t\t\t\t\tthis.defines.USE_GLOSSINESSMAP = '';\n\t\t\t\t\t\tthis.defines.USE_UV = '';\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tdelete this.defines.USE_GLOSSINESSMAP;\n\t\t\t\t\t\tdelete this.defines.USE_UV;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t} );\n\n\t\tdelete this.metalness;\n\t\tdelete this.roughness;\n\t\tdelete this.metalnessMap;\n\t\tdelete this.roughnessMap;\n\n\t\tthis.setValues( params );\n\n\t}\n\n\tcopy( source ) {\n\n\t\tsuper.copy( source );\n\n\t\tthis.specularMap = source.specularMap;\n\t\tthis.specular.copy( source.specular );\n\t\tthis.glossinessMap = source.glossinessMap;\n\t\tthis.glossiness = source.glossiness;\n\t\tdelete this.metalness;\n\t\tdelete this.roughness;\n\t\tdelete this.metalnessMap;\n\t\tdelete this.roughnessMap;\n\t\treturn this;\n\n\t}\n\n}\n\n\nclass GLTFMaterialsPbrSpecularGlossinessExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;\n\n\t\tthis.specularGlossinessParams = [\n\t\t\t'color',\n\t\t\t'map',\n\t\t\t'lightMap',\n\t\t\t'lightMapIntensity',\n\t\t\t'aoMap',\n\t\t\t'aoMapIntensity',\n\t\t\t'emissive',\n\t\t\t'emissiveIntensity',\n\t\t\t'emissiveMap',\n\t\t\t'bumpMap',\n\t\t\t'bumpScale',\n\t\t\t'normalMap',\n\t\t\t'normalMapType',\n\t\t\t'displacementMap',\n\t\t\t'displacementScale',\n\t\t\t'displacementBias',\n\t\t\t'specularMap',\n\t\t\t'specular',\n\t\t\t'glossinessMap',\n\t\t\t'glossiness',\n\t\t\t'alphaMap',\n\t\t\t'envMap',\n\t\t\t'envMapIntensity',\n\t\t\t'refractionRatio',\n\t\t];\n\n\t}\n\n\tgetMaterialType() {\n\n\t\treturn GLTFMeshStandardSGMaterial;\n\n\t}\n\n\textendParams( materialParams, materialDef, parser ) {\n\n\t\tconst pbrSpecularGlossiness = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\n\t\tmaterialParams.opacity = 1.0;\n\n\t\tconst pending = [];\n\n\t\tif ( Array.isArray( pbrSpecularGlossiness.diffuseFactor ) ) {\n\n\t\t\tconst array = pbrSpecularGlossiness.diffuseFactor;\n\n\t\t\tmaterialParams.color.fromArray( array );\n\t\t\tmaterialParams.opacity = array[ 3 ];\n\n\t\t}\n\n\t\tif ( pbrSpecularGlossiness.diffuseTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'map', pbrSpecularGlossiness.diffuseTexture ) );\n\n\t\t}\n\n\t\tmaterialParams.emissive = new Color( 0.0, 0.0, 0.0 );\n\t\tmaterialParams.glossiness = pbrSpecularGlossiness.glossinessFactor !== undefined ? pbrSpecularGlossiness.glossinessFactor : 1.0;\n\t\tmaterialParams.specular = new Color( 1.0, 1.0, 1.0 );\n\n\t\tif ( Array.isArray( pbrSpecularGlossiness.specularFactor ) ) {\n\n\t\t\tmaterialParams.specular.fromArray( pbrSpecularGlossiness.specularFactor );\n\n\t\t}\n\n\t\tif ( pbrSpecularGlossiness.specularGlossinessTexture !== undefined ) {\n\n\t\t\tconst specGlossMapDef = pbrSpecularGlossiness.specularGlossinessTexture;\n\t\t\tpending.push( parser.assignTexture( materialParams, 'glossinessMap', specGlossMapDef ) );\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularMap', specGlossMapDef ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n\tcreateMaterial( materialParams ) {\n\n\t\tconst material = new GLTFMeshStandardSGMaterial( materialParams );\n\t\tmaterial.fog = true;\n\n\t\tmaterial.color = materialParams.color;\n\n\t\tmaterial.map = materialParams.map === undefined ? null : materialParams.map;\n\n\t\tmaterial.lightMap = null;\n\t\tmaterial.lightMapIntensity = 1.0;\n\n\t\tmaterial.aoMap = materialParams.aoMap === undefined ? null : materialParams.aoMap;\n\t\tmaterial.aoMapIntensity = 1.0;\n\n\t\tmaterial.emissive = materialParams.emissive;\n\t\tmaterial.emissiveIntensity = 1.0;\n\t\tmaterial.emissiveMap = materialParams.emissiveMap === undefined ? null : materialParams.emissiveMap;\n\n\t\tmaterial.bumpMap = materialParams.bumpMap === undefined ? null : materialParams.bumpMap;\n\t\tmaterial.bumpScale = 1;\n\n\t\tmaterial.normalMap = materialParams.normalMap === undefined ? null : materialParams.normalMap;\n\t\tmaterial.normalMapType = TangentSpaceNormalMap;\n\n\t\tif ( materialParams.normalScale ) material.normalScale = materialParams.normalScale;\n\n\t\tmaterial.displacementMap = null;\n\t\tmaterial.displacementScale = 1;\n\t\tmaterial.displacementBias = 0;\n\n\t\tmaterial.specularMap = materialParams.specularMap === undefined ? null : materialParams.specularMap;\n\t\tmaterial.specular = materialParams.specular;\n\n\t\tmaterial.glossinessMap = materialParams.glossinessMap === undefined ? null : materialParams.glossinessMap;\n\t\tmaterial.glossiness = materialParams.glossiness;\n\n\t\tmaterial.alphaMap = null;\n\n\t\tmaterial.envMap = materialParams.envMap === undefined ? null : materialParams.envMap;\n\t\tmaterial.envMapIntensity = 1.0;\n\n\t\tmaterial.refractionRatio = 0.98;\n\n\t\treturn material;\n\n\t}\n\n}\n\n/**\n * Mesh Quantization Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization\n */\nclass GLTFMeshQuantizationExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_MESH_QUANTIZATION;\n\n\t}\n\n}\n\n/*********************************/\n/********** INTERPOLATION ********/\n/*********************************/\n\n// Spline Interpolation\n// Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation\nclass GLTFCubicSplineInterpolant extends Interpolant {\n\n\tconstructor( parameterPositions, sampleValues, sampleSize, resultBuffer ) {\n\n\t\tsuper( parameterPositions, sampleValues, sampleSize, resultBuffer );\n\n\t}\n\n\tcopySampleValue_( index ) {\n\n\t\t// Copies a sample value to the result buffer. See description of glTF\n\t\t// CUBICSPLINE values layout in interpolate_() function below.\n\n\t\tconst result = this.resultBuffer,\n\t\t\tvalues = this.sampleValues,\n\t\t\tvalueSize = this.valueSize,\n\t\t\toffset = index * valueSize * 3 + valueSize;\n\n\t\tfor ( let i = 0; i !== valueSize; i ++ ) {\n\n\t\t\tresult[ i ] = values[ offset + i ];\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n}\n\nGLTFCubicSplineInterpolant.prototype.beforeStart_ = GLTFCubicSplineInterpolant.prototype.copySampleValue_;\n\nGLTFCubicSplineInterpolant.prototype.afterEnd_ = GLTFCubicSplineInterpolant.prototype.copySampleValue_;\n\nGLTFCubicSplineInterpolant.prototype.interpolate_ = function ( i1, t0, t, t1 ) {\n\n\tconst result = this.resultBuffer;\n\tconst values = this.sampleValues;\n\tconst stride = this.valueSize;\n\n\tconst stride2 = stride * 2;\n\tconst stride3 = stride * 3;\n\n\tconst td = t1 - t0;\n\n\tconst p = ( t - t0 ) / td;\n\tconst pp = p * p;\n\tconst ppp = pp * p;\n\n\tconst offset1 = i1 * stride3;\n\tconst offset0 = offset1 - stride3;\n\n\tconst s2 = - 2 * ppp + 3 * pp;\n\tconst s3 = ppp - pp;\n\tconst s0 = 1 - s2;\n\tconst s1 = s3 - pp + p;\n\n\t// Layout of keyframe output values for CUBICSPLINE animations:\n\t//   [ inTangent_1, splineVertex_1, outTangent_1, inTangent_2, splineVertex_2, ... ]\n\tfor ( let i = 0; i !== stride; i ++ ) {\n\n\t\tconst p0 = values[ offset0 + i + stride ]; // splineVertex_k\n\t\tconst m0 = values[ offset0 + i + stride2 ] * td; // outTangent_k * (t_k+1 - t_k)\n\t\tconst p1 = values[ offset1 + i + stride ]; // splineVertex_k+1\n\t\tconst m1 = values[ offset1 + i ] * td; // inTangent_k+1 * (t_k+1 - t_k)\n\n\t\tresult[ i ] = s0 * p0 + s1 * m0 + s2 * p1 + s3 * m1;\n\n\t}\n\n\treturn result;\n\n};\n\n/*********************************/\n/********** INTERNALS ************/\n/*********************************/\n\n/* CONSTANTS */\n\nconst WEBGL_CONSTANTS = {\n\tFLOAT: 5126,\n\t//FLOAT_MAT2: 35674,\n\tFLOAT_MAT3: 35675,\n\tFLOAT_MAT4: 35676,\n\tFLOAT_VEC2: 35664,\n\tFLOAT_VEC3: 35665,\n\tFLOAT_VEC4: 35666,\n\tLINEAR: 9729,\n\tREPEAT: 10497,\n\tSAMPLER_2D: 35678,\n\tPOINTS: 0,\n\tLINES: 1,\n\tLINE_LOOP: 2,\n\tLINE_STRIP: 3,\n\tTRIANGLES: 4,\n\tTRIANGLE_STRIP: 5,\n\tTRIANGLE_FAN: 6,\n\tUNSIGNED_BYTE: 5121,\n\tUNSIGNED_SHORT: 5123\n};\n\nconst WEBGL_COMPONENT_TYPES = {\n\t5120: Int8Array,\n\t5121: Uint8Array,\n\t5122: Int16Array,\n\t5123: Uint16Array,\n\t5125: Uint32Array,\n\t5126: Float32Array\n};\n\nconst WEBGL_FILTERS = {\n\t9728: NearestFilter,\n\t9729: LinearFilter,\n\t9984: NearestMipmapNearestFilter,\n\t9985: LinearMipmapNearestFilter,\n\t9986: NearestMipmapLinearFilter,\n\t9987: LinearMipmapLinearFilter\n};\n\nconst WEBGL_WRAPPINGS = {\n\t33071: ClampToEdgeWrapping,\n\t33648: MirroredRepeatWrapping,\n\t10497: RepeatWrapping\n};\n\nconst WEBGL_TYPE_SIZES = {\n\t'SCALAR': 1,\n\t'VEC2': 2,\n\t'VEC3': 3,\n\t'VEC4': 4,\n\t'MAT2': 4,\n\t'MAT3': 9,\n\t'MAT4': 16\n};\n\nconst ATTRIBUTES = {\n\tPOSITION: 'position',\n\tNORMAL: 'normal',\n\tTANGENT: 'tangent',\n\tTEXCOORD_0: 'uv',\n\tTEXCOORD_1: 'uv2',\n\tCOLOR_0: 'color',\n\tWEIGHTS_0: 'skinWeight',\n\tJOINTS_0: 'skinIndex',\n};\n\nconst PATH_PROPERTIES = {\n\tscale: 'scale',\n\ttranslation: 'position',\n\trotation: 'quaternion',\n\tweights: 'morphTargetInfluences'\n};\n\nconst INTERPOLATION = {\n\tCUBICSPLINE: undefined, // We use a custom interpolant (GLTFCubicSplineInterpolation) for CUBICSPLINE tracks. Each\n\t\t                        // keyframe track will be initialized with a default interpolation type, then modified.\n\tLINEAR: InterpolateLinear,\n\tSTEP: InterpolateDiscrete\n};\n\nconst ALPHA_MODES = {\n\tOPAQUE: 'OPAQUE',\n\tMASK: 'MASK',\n\tBLEND: 'BLEND'\n};\n\n/* UTILITY FUNCTIONS */\n\nfunction resolveURL( url, path ) {\n\n\t// Invalid URL\n\tif ( typeof url !== 'string' || url === '' ) return '';\n\n\t// Host Relative URL\n\tif ( /^https?:\\/\\//i.test( path ) && /^\\//.test( url ) ) {\n\n\t\tpath = path.replace( /(^https?:\\/\\/[^\\/]+).*/i, '$1' );\n\n\t}\n\n\t// Absolute URL http://,https://,//\n\tif ( /^(https?:)?\\/\\//i.test( url ) ) return url;\n\n\t// Data URI\n\tif ( /^data:.*,.*$/i.test( url ) ) return url;\n\n\t// Blob URL\n\tif ( /^blob:.*$/i.test( url ) ) return url;\n\n\t// Relative URL\n\treturn path + url;\n\n}\n\n/**\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material\n */\nfunction createDefaultMaterial( cache ) {\n\n\tif ( cache[ 'DefaultMaterial' ] === undefined ) {\n\n\t\tcache[ 'DefaultMaterial' ] = new MeshStandardMaterial( {\n\t\t\tcolor: 0xFFFFFF,\n\t\t\temissive: 0x000000,\n\t\t\tmetalness: 1,\n\t\t\troughness: 1,\n\t\t\ttransparent: false,\n\t\t\tdepthTest: true,\n\t\t\tside: FrontSide\n\t\t} );\n\n\t}\n\n\treturn cache[ 'DefaultMaterial' ];\n\n}\n\nfunction addUnknownExtensionsToUserData( knownExtensions, object, objectDef ) {\n\n\t// Add unknown glTF extensions to an object's userData.\n\n\tfor ( const name in objectDef.extensions ) {\n\n\t\tif ( knownExtensions[ name ] === undefined ) {\n\n\t\t\tobject.userData.gltfExtensions = object.userData.gltfExtensions || {};\n\t\t\tobject.userData.gltfExtensions[ name ] = objectDef.extensions[ name ];\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * @param {Object3D|Material|BufferGeometry} object\n * @param {GLTF.definition} gltfDef\n */\nfunction assignExtrasToUserData( object, gltfDef ) {\n\n\tif ( gltfDef.extras !== undefined ) {\n\n\t\tif ( typeof gltfDef.extras === 'object' ) {\n\n\t\t\tObject.assign( object.userData, gltfDef.extras );\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Ignoring primitive type .extras, ' + gltfDef.extras );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets\n *\n * @param {BufferGeometry} geometry\n * @param {Array<GLTF.Target>} targets\n * @param {GLTFParser} parser\n * @return {Promise<BufferGeometry>}\n */\nfunction addMorphTargets( geometry, targets, parser ) {\n\n\tlet hasMorphPosition = false;\n\tlet hasMorphNormal = false;\n\n\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\tconst target = targets[ i ];\n\n\t\tif ( target.POSITION !== undefined ) hasMorphPosition = true;\n\t\tif ( target.NORMAL !== undefined ) hasMorphNormal = true;\n\n\t\tif ( hasMorphPosition && hasMorphNormal ) break;\n\n\t}\n\n\tif ( ! hasMorphPosition && ! hasMorphNormal ) return Promise.resolve( geometry );\n\n\tconst pendingPositionAccessors = [];\n\tconst pendingNormalAccessors = [];\n\n\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\tconst target = targets[ i ];\n\n\t\tif ( hasMorphPosition ) {\n\n\t\t\tconst pendingAccessor = target.POSITION !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.POSITION )\n\t\t\t\t: geometry.attributes.position;\n\n\t\t\tpendingPositionAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t\tif ( hasMorphNormal ) {\n\n\t\t\tconst pendingAccessor = target.NORMAL !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.NORMAL )\n\t\t\t\t: geometry.attributes.normal;\n\n\t\t\tpendingNormalAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t}\n\n\treturn Promise.all( [\n\t\tPromise.all( pendingPositionAccessors ),\n\t\tPromise.all( pendingNormalAccessors )\n\t] ).then( function ( accessors ) {\n\n\t\tconst morphPositions = accessors[ 0 ];\n\t\tconst morphNormals = accessors[ 1 ];\n\n\t\tif ( hasMorphPosition ) geometry.morphAttributes.position = morphPositions;\n\t\tif ( hasMorphNormal ) geometry.morphAttributes.normal = morphNormals;\n\t\tgeometry.morphTargetsRelative = true;\n\n\t\treturn geometry;\n\n\t} );\n\n}\n\n/**\n * @param {Mesh} mesh\n * @param {GLTF.Mesh} meshDef\n */\nfunction updateMorphTargets( mesh, meshDef ) {\n\n\tmesh.updateMorphTargets();\n\n\tif ( meshDef.weights !== undefined ) {\n\n\t\tfor ( let i = 0, il = meshDef.weights.length; i < il; i ++ ) {\n\n\t\t\tmesh.morphTargetInfluences[ i ] = meshDef.weights[ i ];\n\n\t\t}\n\n\t}\n\n\t// .extras has user-defined data, so check that .extras.targetNames is an array.\n\tif ( meshDef.extras && Array.isArray( meshDef.extras.targetNames ) ) {\n\n\t\tconst targetNames = meshDef.extras.targetNames;\n\n\t\tif ( mesh.morphTargetInfluences.length === targetNames.length ) {\n\n\t\t\tmesh.morphTargetDictionary = {};\n\n\t\t\tfor ( let i = 0, il = targetNames.length; i < il; i ++ ) {\n\n\t\t\t\tmesh.morphTargetDictionary[ targetNames[ i ] ] = i;\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.' );\n\n\t\t}\n\n\t}\n\n}\n\nfunction createPrimitiveKey( primitiveDef ) {\n\n\tconst dracoExtension = primitiveDef.extensions && primitiveDef.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ];\n\tlet geometryKey;\n\n\tif ( dracoExtension ) {\n\n\t\tgeometryKey = 'draco:' + dracoExtension.bufferView\n\t\t\t\t+ ':' + dracoExtension.indices\n\t\t\t\t+ ':' + createAttributesKey( dracoExtension.attributes );\n\n\t} else {\n\n\t\tgeometryKey = primitiveDef.indices + ':' + createAttributesKey( primitiveDef.attributes ) + ':' + primitiveDef.mode;\n\n\t}\n\n\treturn geometryKey;\n\n}\n\nfunction createAttributesKey( attributes ) {\n\n\tlet attributesKey = '';\n\n\tconst keys = Object.keys( attributes ).sort();\n\n\tfor ( let i = 0, il = keys.length; i < il; i ++ ) {\n\n\t\tattributesKey += keys[ i ] + ':' + attributes[ keys[ i ] ] + ';';\n\n\t}\n\n\treturn attributesKey;\n\n}\n\nfunction getNormalizedComponentScale( constructor ) {\n\n\t// Reference:\n\t// https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization#encoding-quantized-data\n\n\tswitch ( constructor ) {\n\n\t\tcase Int8Array:\n\t\t\treturn 1 / 127;\n\n\t\tcase Uint8Array:\n\t\t\treturn 1 / 255;\n\n\t\tcase Int16Array:\n\t\t\treturn 1 / 32767;\n\n\t\tcase Uint16Array:\n\t\t\treturn 1 / 65535;\n\n\t\tdefault:\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported normalized accessor component type.' );\n\n\t}\n\n}\n\n/* GLTF PARSER */\n\nclass GLTFParser {\n\n\tconstructor( json = {}, options = {} ) {\n\n\t\tthis.json = json;\n\t\tthis.extensions = {};\n\t\tthis.plugins = {};\n\t\tthis.options = options;\n\n\t\t// loader object cache\n\t\tthis.cache = new GLTFRegistry();\n\n\t\t// associations between Three.js objects and glTF elements\n\t\tthis.associations = new Map();\n\n\t\t// BufferGeometry caching\n\t\tthis.primitiveCache = {};\n\n\t\t// Object3D instance caches\n\t\tthis.meshCache = { refs: {}, uses: {} };\n\t\tthis.cameraCache = { refs: {}, uses: {} };\n\t\tthis.lightCache = { refs: {}, uses: {} };\n\n\t\tthis.textureCache = {};\n\n\t\t// Track node names, to ensure no duplicates\n\t\tthis.nodeNamesUsed = {};\n\n\t\t// Use an ImageBitmapLoader if imageBitmaps are supported. Moves much of the\n\t\t// expensive work of uploading a texture to the GPU off the main thread.\n\t\tif ( typeof createImageBitmap !== 'undefined' && /Firefox/.test( navigator.userAgent ) === false ) {\n\n\t\t\tthis.textureLoader = new ImageBitmapLoader( this.options.manager );\n\n\t\t} else {\n\n\t\t\tthis.textureLoader = new TextureLoader( this.options.manager );\n\n\t\t}\n\n\t\tthis.textureLoader.setCrossOrigin( this.options.crossOrigin );\n\t\tthis.textureLoader.setRequestHeader( this.options.requestHeader );\n\n\t\tthis.fileLoader = new FileLoader( this.options.manager );\n\t\tthis.fileLoader.setResponseType( 'arraybuffer' );\n\n\t\tif ( this.options.crossOrigin === 'use-credentials' ) {\n\n\t\t\tthis.fileLoader.setWithCredentials( true );\n\n\t\t}\n\n\t}\n\n\tsetExtensions( extensions ) {\n\n\t\tthis.extensions = extensions;\n\n\t}\n\n\tsetPlugins( plugins ) {\n\n\t\tthis.plugins = plugins;\n\n\t}\n\n\tparse( onLoad, onError ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\n\t\t// Clear the loader cache\n\t\tthis.cache.removeAll();\n\n\t\t// Mark the special nodes/meshes in json for efficient parse\n\t\tthis._invokeAll( function ( ext ) {\n\n\t\t\treturn ext._markDefs && ext._markDefs();\n\n\t\t} );\n\n\t\tPromise.all( this._invokeAll( function ( ext ) {\n\n\t\t\treturn ext.beforeRoot && ext.beforeRoot();\n\n\t\t} ) ).then( function () {\n\n\t\t\treturn Promise.all( [\n\n\t\t\t\tparser.getDependencies( 'scene' ),\n\t\t\t\tparser.getDependencies( 'animation' ),\n\t\t\t\tparser.getDependencies( 'camera' ),\n\n\t\t\t] );\n\n\t\t} ).then( function ( dependencies ) {\n\n\t\t\tconst result = {\n\t\t\t\tscene: dependencies[ 0 ][ json.scene || 0 ],\n\t\t\t\tscenes: dependencies[ 0 ],\n\t\t\t\tanimations: dependencies[ 1 ],\n\t\t\t\tcameras: dependencies[ 2 ],\n\t\t\t\tasset: json.asset,\n\t\t\t\tparser: parser,\n\t\t\t\tuserData: {}\n\t\t\t};\n\n\t\t\taddUnknownExtensionsToUserData( extensions, result, json );\n\n\t\t\tassignExtrasToUserData( result, json );\n\n\t\t\tPromise.all( parser._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.afterRoot && ext.afterRoot( result );\n\n\t\t\t} ) ).then( function () {\n\n\t\t\t\tonLoad( result );\n\n\t\t\t} );\n\n\t\t} ).catch( onError );\n\n\t}\n\n\t/**\n\t * Marks the special nodes/meshes in json for efficient parse.\n\t */\n\t_markDefs() {\n\n\t\tconst nodeDefs = this.json.nodes || [];\n\t\tconst skinDefs = this.json.skins || [];\n\t\tconst meshDefs = this.json.meshes || [];\n\n\t\t// Nothing in the node definition indicates whether it is a Bone or an\n\t\t// Object3D. Use the skins' joint references to mark bones.\n\t\tfor ( let skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex ++ ) {\n\n\t\t\tconst joints = skinDefs[ skinIndex ].joints;\n\n\t\t\tfor ( let i = 0, il = joints.length; i < il; i ++ ) {\n\n\t\t\t\tnodeDefs[ joints[ i ] ].isBone = true;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Iterate over all nodes, marking references to shared resources,\n\t\t// as well as skeleton joints.\n\t\tfor ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\n\n\t\t\tconst nodeDef = nodeDefs[ nodeIndex ];\n\n\t\t\tif ( nodeDef.mesh !== undefined ) {\n\n\t\t\t\tthis._addNodeRef( this.meshCache, nodeDef.mesh );\n\n\t\t\t\t// Nothing in the mesh definition indicates whether it is\n\t\t\t\t// a SkinnedMesh or Mesh. Use the node's mesh reference\n\t\t\t\t// to mark SkinnedMesh if node has skin.\n\t\t\t\tif ( nodeDef.skin !== undefined ) {\n\n\t\t\t\t\tmeshDefs[ nodeDef.mesh ].isSkinnedMesh = true;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.camera !== undefined ) {\n\n\t\t\t\tthis._addNodeRef( this.cameraCache, nodeDef.camera );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Counts references to shared node / Object3D resources. These resources\n\t * can be reused, or \"instantiated\", at multiple nodes in the scene\n\t * hierarchy. Mesh, Camera, and Light instances are instantiated and must\n\t * be marked. Non-scenegraph resources (like Materials, Geometries, and\n\t * Textures) can be reused directly and are not marked here.\n\t *\n\t * Example: CesiumMilkTruck sample model reuses \"Wheel\" meshes.\n\t */\n\t_addNodeRef( cache, index ) {\n\n\t\tif ( index === undefined ) return;\n\n\t\tif ( cache.refs[ index ] === undefined ) {\n\n\t\t\tcache.refs[ index ] = cache.uses[ index ] = 0;\n\n\t\t}\n\n\t\tcache.refs[ index ] ++;\n\n\t}\n\n\t/** Returns a reference to a shared resource, cloning it if necessary. */\n\t_getNodeRef( cache, index, object ) {\n\n\t\tif ( cache.refs[ index ] <= 1 ) return object;\n\n\t\tconst ref = object.clone();\n\n\t\tref.name += '_instance_' + ( cache.uses[ index ] ++ );\n\n\t\treturn ref;\n\n\t}\n\n\t_invokeOne( func ) {\n\n\t\tconst extensions = Object.values( this.plugins );\n\t\textensions.push( this );\n\n\t\tfor ( let i = 0; i < extensions.length; i ++ ) {\n\n\t\t\tconst result = func( extensions[ i ] );\n\n\t\t\tif ( result ) return result;\n\n\t\t}\n\n\t\treturn null;\n\n\t}\n\n\t_invokeAll( func ) {\n\n\t\tconst extensions = Object.values( this.plugins );\n\t\textensions.unshift( this );\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0; i < extensions.length; i ++ ) {\n\n\t\t\tconst result = func( extensions[ i ] );\n\n\t\t\tif ( result ) pending.push( result );\n\n\t\t}\n\n\t\treturn pending;\n\n\t}\n\n\t/**\n\t * Requests the specified dependency asynchronously, with caching.\n\t * @param {string} type\n\t * @param {number} index\n\t * @return {Promise<Object3D|Material|THREE.Texture|AnimationClip|ArrayBuffer|Object>}\n\t */\n\tgetDependency( type, index ) {\n\n\t\tconst cacheKey = type + ':' + index;\n\t\tlet dependency = this.cache.get( cacheKey );\n\n\t\tif ( ! dependency ) {\n\n\t\t\tswitch ( type ) {\n\n\t\t\t\tcase 'scene':\n\t\t\t\t\tdependency = this.loadScene( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'node':\n\t\t\t\t\tdependency = this.loadNode( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'mesh':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadMesh && ext.loadMesh( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'accessor':\n\t\t\t\t\tdependency = this.loadAccessor( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'bufferView':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadBufferView && ext.loadBufferView( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'buffer':\n\t\t\t\t\tdependency = this.loadBuffer( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'material':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadMaterial && ext.loadMaterial( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'texture':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadTexture && ext.loadTexture( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'skin':\n\t\t\t\t\tdependency = this.loadSkin( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'animation':\n\t\t\t\t\tdependency = this.loadAnimation( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'camera':\n\t\t\t\t\tdependency = this.loadCamera( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error( 'Unknown type: ' + type );\n\n\t\t\t}\n\n\t\t\tthis.cache.add( cacheKey, dependency );\n\n\t\t}\n\n\t\treturn dependency;\n\n\t}\n\n\t/**\n\t * Requests all dependencies of the specified type asynchronously, with caching.\n\t * @param {string} type\n\t * @return {Promise<Array<Object>>}\n\t */\n\tgetDependencies( type ) {\n\n\t\tlet dependencies = this.cache.get( type );\n\n\t\tif ( ! dependencies ) {\n\n\t\t\tconst parser = this;\n\t\t\tconst defs = this.json[ type + ( type === 'mesh' ? 'es' : 's' ) ] || [];\n\n\t\t\tdependencies = Promise.all( defs.map( function ( def, index ) {\n\n\t\t\t\treturn parser.getDependency( type, index );\n\n\t\t\t} ) );\n\n\t\t\tthis.cache.add( type, dependencies );\n\n\t\t}\n\n\t\treturn dependencies;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n\t * @param {number} bufferIndex\n\t * @return {Promise<ArrayBuffer>}\n\t */\n\tloadBuffer( bufferIndex ) {\n\n\t\tconst bufferDef = this.json.buffers[ bufferIndex ];\n\t\tconst loader = this.fileLoader;\n\n\t\tif ( bufferDef.type && bufferDef.type !== 'arraybuffer' ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.' );\n\n\t\t}\n\n\t\t// If present, GLB container is required to be the first buffer.\n\t\tif ( bufferDef.uri === undefined && bufferIndex === 0 ) {\n\n\t\t\treturn Promise.resolve( this.extensions[ EXTENSIONS.KHR_BINARY_GLTF ].body );\n\n\t\t}\n\n\t\tconst options = this.options;\n\n\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\tloader.load( resolveURL( bufferDef.uri, options.path ), resolve, undefined, function () {\n\n\t\t\t\treject( new Error( 'THREE.GLTFLoader: Failed to load buffer \"' + bufferDef.uri + '\".' ) );\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n\t * @param {number} bufferViewIndex\n\t * @return {Promise<ArrayBuffer>}\n\t */\n\tloadBufferView( bufferViewIndex ) {\n\n\t\tconst bufferViewDef = this.json.bufferViews[ bufferViewIndex ];\n\n\t\treturn this.getDependency( 'buffer', bufferViewDef.buffer ).then( function ( buffer ) {\n\n\t\t\tconst byteLength = bufferViewDef.byteLength || 0;\n\t\t\tconst byteOffset = bufferViewDef.byteOffset || 0;\n\t\t\treturn buffer.slice( byteOffset, byteOffset + byteLength );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors\n\t * @param {number} accessorIndex\n\t * @return {Promise<BufferAttribute|InterleavedBufferAttribute>}\n\t */\n\tloadAccessor( accessorIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\n\t\tconst accessorDef = this.json.accessors[ accessorIndex ];\n\n\t\tif ( accessorDef.bufferView === undefined && accessorDef.sparse === undefined ) {\n\n\t\t\t// Ignore empty accessors, which may be used to declare runtime\n\t\t\t// information about attributes coming from another source (e.g. Draco\n\t\t\t// compression extension).\n\t\t\treturn Promise.resolve( null );\n\n\t\t}\n\n\t\tconst pendingBufferViews = [];\n\n\t\tif ( accessorDef.bufferView !== undefined ) {\n\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.bufferView ) );\n\n\t\t} else {\n\n\t\t\tpendingBufferViews.push( null );\n\n\t\t}\n\n\t\tif ( accessorDef.sparse !== undefined ) {\n\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.indices.bufferView ) );\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.values.bufferView ) );\n\n\t\t}\n\n\t\treturn Promise.all( pendingBufferViews ).then( function ( bufferViews ) {\n\n\t\t\tconst bufferView = bufferViews[ 0 ];\n\n\t\t\tconst itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\n\t\t\tconst TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\n\t\t\t// For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\n\t\t\tconst elementBytes = TypedArray.BYTES_PER_ELEMENT;\n\t\t\tconst itemBytes = elementBytes * itemSize;\n\t\t\tconst byteOffset = accessorDef.byteOffset || 0;\n\t\t\tconst byteStride = accessorDef.bufferView !== undefined ? json.bufferViews[ accessorDef.bufferView ].byteStride : undefined;\n\t\t\tconst normalized = accessorDef.normalized === true;\n\t\t\tlet array, bufferAttribute;\n\n\t\t\t// The buffer is not interleaved if the stride is the item size in bytes.\n\t\t\tif ( byteStride && byteStride !== itemBytes ) {\n\n\t\t\t\t// Each \"slice\" of the buffer, as defined by 'count' elements of 'byteStride' bytes, gets its own InterleavedBuffer\n\t\t\t\t// This makes sure that IBA.count reflects accessor.count properly\n\t\t\t\tconst ibSlice = Math.floor( byteOffset / byteStride );\n\t\t\t\tconst ibCacheKey = 'InterleavedBuffer:' + accessorDef.bufferView + ':' + accessorDef.componentType + ':' + ibSlice + ':' + accessorDef.count;\n\t\t\t\tlet ib = parser.cache.get( ibCacheKey );\n\n\t\t\t\tif ( ! ib ) {\n\n\t\t\t\t\tarray = new TypedArray( bufferView, ibSlice * byteStride, accessorDef.count * byteStride / elementBytes );\n\n\t\t\t\t\t// Integer parameters to IB/IBA are in array elements, not bytes.\n\t\t\t\t\tib = new InterleavedBuffer( array, byteStride / elementBytes );\n\n\t\t\t\t\tparser.cache.add( ibCacheKey, ib );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute = new InterleavedBufferAttribute( ib, itemSize, ( byteOffset % byteStride ) / elementBytes, normalized );\n\n\t\t\t} else {\n\n\t\t\t\tif ( bufferView === null ) {\n\n\t\t\t\t\tarray = new TypedArray( accessorDef.count * itemSize );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tarray = new TypedArray( bufferView, byteOffset, accessorDef.count * itemSize );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute = new BufferAttribute( array, itemSize, normalized );\n\n\t\t\t}\n\n\t\t\t// https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors\n\t\t\tif ( accessorDef.sparse !== undefined ) {\n\n\t\t\t\tconst itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;\n\t\t\t\tconst TypedArrayIndices = WEBGL_COMPONENT_TYPES[ accessorDef.sparse.indices.componentType ];\n\n\t\t\t\tconst byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;\n\t\t\t\tconst byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;\n\n\t\t\t\tconst sparseIndices = new TypedArrayIndices( bufferViews[ 1 ], byteOffsetIndices, accessorDef.sparse.count * itemSizeIndices );\n\t\t\t\tconst sparseValues = new TypedArray( bufferViews[ 2 ], byteOffsetValues, accessorDef.sparse.count * itemSize );\n\n\t\t\t\tif ( bufferView !== null ) {\n\n\t\t\t\t\t// Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.\n\t\t\t\t\tbufferAttribute = new BufferAttribute( bufferAttribute.array.slice(), bufferAttribute.itemSize, bufferAttribute.normalized );\n\n\t\t\t\t}\n\n\t\t\t\tfor ( let i = 0, il = sparseIndices.length; i < il; i ++ ) {\n\n\t\t\t\t\tconst index = sparseIndices[ i ];\n\n\t\t\t\t\tbufferAttribute.setX( index, sparseValues[ i * itemSize ] );\n\t\t\t\t\tif ( itemSize >= 2 ) bufferAttribute.setY( index, sparseValues[ i * itemSize + 1 ] );\n\t\t\t\t\tif ( itemSize >= 3 ) bufferAttribute.setZ( index, sparseValues[ i * itemSize + 2 ] );\n\t\t\t\t\tif ( itemSize >= 4 ) bufferAttribute.setW( index, sparseValues[ i * itemSize + 3 ] );\n\t\t\t\t\tif ( itemSize >= 5 ) throw new Error( 'THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn bufferAttribute;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures\n\t * @param {number} textureIndex\n\t * @return {Promise<THREE.Texture>}\n\t */\n\tloadTexture( textureIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst options = this.options;\n\t\tconst textureDef = json.textures[ textureIndex ];\n\t\tconst source = json.images[ textureDef.source ];\n\n\t\tlet loader = this.textureLoader;\n\n\t\tif ( source.uri ) {\n\n\t\t\tconst handler = options.manager.getHandler( source.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn this.loadTextureImage( textureIndex, source, loader );\n\n\t}\n\n\tloadTextureImage( textureIndex, source, loader ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst options = this.options;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tconst cacheKey = ( source.uri || source.bufferView ) + ':' + textureDef.sampler;\n\n\t\tif ( this.textureCache[ cacheKey ] ) {\n\n\t\t\t// See https://github.com/mrdoob/three.js/issues/21559.\n\t\t\treturn this.textureCache[ cacheKey ];\n\n\t\t}\n\n\t\tconst URL = self.URL || self.webkitURL;\n\n\t\tlet sourceURI = source.uri || '';\n\t\tlet isObjectURL = false;\n\t\tlet hasAlpha = true;\n\n\t\tconst isJPEG = sourceURI.search( /\\.jpe?g($|\\?)/i ) > 0 || sourceURI.search( /^data\\:image\\/jpeg/ ) === 0;\n\n\t\tif ( source.mimeType === 'image/jpeg' || isJPEG ) hasAlpha = false;\n\n\t\tif ( source.bufferView !== undefined ) {\n\n\t\t\t// Load binary image data from bufferView, if provided.\n\n\t\t\tsourceURI = parser.getDependency( 'bufferView', source.bufferView ).then( function ( bufferView ) {\n\n\t\t\t\tif ( source.mimeType === 'image/png' ) {\n\n\t\t\t\t\t// Inspect the PNG 'IHDR' chunk to determine whether the image could have an\n\t\t\t\t\t// alpha channel. This check is conservative — the image could have an alpha\n\t\t\t\t\t// channel with all values == 1, and the indexed type (colorType == 3) only\n\t\t\t\t\t// sometimes contains alpha.\n\t\t\t\t\t//\n\t\t\t\t\t// https://en.wikipedia.org/wiki/Portable_Network_Graphics#File_header\n\t\t\t\t\tconst colorType = new DataView( bufferView, 25, 1 ).getUint8( 0, false );\n\t\t\t\t\thasAlpha = colorType === 6 || colorType === 4 || colorType === 3;\n\n\t\t\t\t}\n\n\t\t\t\tisObjectURL = true;\n\t\t\t\tconst blob = new Blob( [ bufferView ], { type: source.mimeType } );\n\t\t\t\tsourceURI = URL.createObjectURL( blob );\n\t\t\t\treturn sourceURI;\n\n\t\t\t} );\n\n\t\t} else if ( source.uri === undefined ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Image ' + textureIndex + ' is missing URI and bufferView' );\n\n\t\t}\n\n\t\tconst promise = Promise.resolve( sourceURI ).then( function ( sourceURI ) {\n\n\t\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\t\tlet onLoad = resolve;\n\n\t\t\t\tif ( loader.isImageBitmapLoader === true ) {\n\n\t\t\t\t\tonLoad = function ( imageBitmap ) {\n\n\t\t\t\t\t\tresolve( new CanvasTexture( imageBitmap ) );\n\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t\tloader.load( resolveURL( sourceURI, options.path ), onLoad, undefined, reject );\n\n\t\t\t} );\n\n\t\t} ).then( function ( texture ) {\n\n\t\t\t// Clean up resources and configure Texture.\n\n\t\t\tif ( isObjectURL === true ) {\n\n\t\t\t\tURL.revokeObjectURL( sourceURI );\n\n\t\t\t}\n\n\t\t\ttexture.flipY = false;\n\n\t\t\tif ( textureDef.name ) texture.name = textureDef.name;\n\n\t\t\t// When there is definitely no alpha channel in the texture, set RGBFormat to save space.\n\t\t\tif ( ! hasAlpha ) texture.format = RGBFormat;\n\n\t\t\tconst samplers = json.samplers || {};\n\t\t\tconst sampler = samplers[ textureDef.sampler ] || {};\n\n\t\t\ttexture.magFilter = WEBGL_FILTERS[ sampler.magFilter ] || LinearFilter;\n\t\t\ttexture.minFilter = WEBGL_FILTERS[ sampler.minFilter ] || LinearMipmapLinearFilter;\n\t\t\ttexture.wrapS = WEBGL_WRAPPINGS[ sampler.wrapS ] || RepeatWrapping;\n\t\t\ttexture.wrapT = WEBGL_WRAPPINGS[ sampler.wrapT ] || RepeatWrapping;\n\n\t\t\tparser.associations.set( texture, {\n\t\t\t\ttype: 'textures',\n\t\t\t\tindex: textureIndex\n\t\t\t} );\n\n\t\t\treturn texture;\n\n\t\t} );\n\n\t\tthis.textureCache[ cacheKey ] = promise;\n\n\t\treturn promise;\n\n\t}\n\n\t/**\n\t * Asynchronously assigns a texture to the given material parameters.\n\t * @param {Object} materialParams\n\t * @param {string} mapName\n\t * @param {Object} mapDef\n\t * @return {Promise}\n\t */\n\tassignTexture( materialParams, mapName, mapDef ) {\n\n\t\tconst parser = this;\n\n\t\treturn this.getDependency( 'texture', mapDef.index ).then( function ( texture ) {\n\n\t\t\t// Materials sample aoMap from UV set 1 and other maps from UV set 0 - this can't be configured\n\t\t\t// However, we will copy UV set 0 to UV set 1 on demand for aoMap\n\t\t\tif ( mapDef.texCoord !== undefined && mapDef.texCoord != 0 && ! ( mapName === 'aoMap' && mapDef.texCoord == 1 ) ) {\n\n\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Custom UV set ' + mapDef.texCoord + ' for texture ' + mapName + ' not yet supported.' );\n\n\t\t\t}\n\n\t\t\tif ( parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] ) {\n\n\t\t\t\tconst transform = mapDef.extensions !== undefined ? mapDef.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] : undefined;\n\n\t\t\t\tif ( transform ) {\n\n\t\t\t\t\tconst gltfReference = parser.associations.get( texture );\n\t\t\t\t\ttexture = parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ].extendTexture( texture, transform );\n\t\t\t\t\tparser.associations.set( texture, gltfReference );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tmaterialParams[ mapName ] = texture;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Assigns final material to a Mesh, Line, or Points instance. The instance\n\t * already has a material (generated from the glTF material options alone)\n\t * but reuse of the same glTF material may require multiple threejs materials\n\t * to accommodate different primitive types, defines, etc. New materials will\n\t * be created if necessary, and reused from a cache.\n\t * @param  {Object3D} mesh Mesh, Line, or Points instance.\n\t */\n\tassignFinalMaterial( mesh ) {\n\n\t\tconst geometry = mesh.geometry;\n\t\tlet material = mesh.material;\n\n\t\tconst useVertexTangents = geometry.attributes.tangent !== undefined;\n\t\tconst useVertexColors = geometry.attributes.color !== undefined;\n\t\tconst useFlatShading = geometry.attributes.normal === undefined;\n\t\tconst useMorphTargets = Object.keys( geometry.morphAttributes ).length > 0;\n\t\tconst useMorphNormals = useMorphTargets && geometry.morphAttributes.normal !== undefined;\n\n\t\tif ( mesh.isPoints ) {\n\n\t\t\tconst cacheKey = 'PointsMaterial:' + material.uuid;\n\n\t\t\tlet pointsMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! pointsMaterial ) {\n\n\t\t\t\tpointsMaterial = new PointsMaterial();\n\t\t\t\tMaterial.prototype.copy.call( pointsMaterial, material );\n\t\t\t\tpointsMaterial.color.copy( material.color );\n\t\t\t\tpointsMaterial.map = material.map;\n\t\t\t\tpointsMaterial.sizeAttenuation = false; // glTF spec says points should be 1px\n\n\t\t\t\tthis.cache.add( cacheKey, pointsMaterial );\n\n\t\t\t}\n\n\t\t\tmaterial = pointsMaterial;\n\n\t\t} else if ( mesh.isLine ) {\n\n\t\t\tconst cacheKey = 'LineBasicMaterial:' + material.uuid;\n\n\t\t\tlet lineMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! lineMaterial ) {\n\n\t\t\t\tlineMaterial = new LineBasicMaterial();\n\t\t\t\tMaterial.prototype.copy.call( lineMaterial, material );\n\t\t\t\tlineMaterial.color.copy( material.color );\n\n\t\t\t\tthis.cache.add( cacheKey, lineMaterial );\n\n\t\t\t}\n\n\t\t\tmaterial = lineMaterial;\n\n\t\t}\n\n\t\t// Clone the material if it will be modified\n\t\tif ( useVertexTangents || useVertexColors || useFlatShading || useMorphTargets ) {\n\n\t\t\tlet cacheKey = 'ClonedMaterial:' + material.uuid + ':';\n\n\t\t\tif ( material.isGLTFSpecularGlossinessMaterial ) cacheKey += 'specular-glossiness:';\n\t\t\tif ( useVertexTangents ) cacheKey += 'vertex-tangents:';\n\t\t\tif ( useVertexColors ) cacheKey += 'vertex-colors:';\n\t\t\tif ( useFlatShading ) cacheKey += 'flat-shading:';\n\t\t\tif ( useMorphTargets ) cacheKey += 'morph-targets:';\n\t\t\tif ( useMorphNormals ) cacheKey += 'morph-normals:';\n\n\t\t\tlet cachedMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! cachedMaterial ) {\n\n\t\t\t\tcachedMaterial = material.clone();\n\n\t\t\t\tif ( useVertexColors ) cachedMaterial.vertexColors = true;\n\t\t\t\tif ( useFlatShading ) cachedMaterial.flatShading = true;\n\t\t\t\tif ( useMorphTargets ) cachedMaterial.morphTargets = true;\n\t\t\t\tif ( useMorphNormals ) cachedMaterial.morphNormals = true;\n\n\t\t\t\tif ( useVertexTangents ) {\n\n\t\t\t\t\tcachedMaterial.vertexTangents = true;\n\n\t\t\t\t\t// https://github.com/mrdoob/three.js/issues/11438#issuecomment-507003995\n\t\t\t\t\tif ( cachedMaterial.normalScale ) cachedMaterial.normalScale.y *= - 1;\n\t\t\t\t\tif ( cachedMaterial.clearcoatNormalScale ) cachedMaterial.clearcoatNormalScale.y *= - 1;\n\n\t\t\t\t}\n\n\t\t\t\tthis.cache.add( cacheKey, cachedMaterial );\n\n\t\t\t\tthis.associations.set( cachedMaterial, this.associations.get( material ) );\n\n\t\t\t}\n\n\t\t\tmaterial = cachedMaterial;\n\n\t\t}\n\n\t\t// workarounds for mesh and geometry\n\n\t\tif ( material.aoMap && geometry.attributes.uv2 === undefined && geometry.attributes.uv !== undefined ) {\n\n\t\t\tgeometry.setAttribute( 'uv2', geometry.attributes.uv );\n\n\t\t}\n\n\t\tmesh.material = material;\n\n\t}\n\n\tgetMaterialType( /* materialIndex */ ) {\n\n\t\treturn MeshStandardMaterial;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials\n\t * @param {number} materialIndex\n\t * @return {Promise<Material>}\n\t */\n\tloadMaterial( materialIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\t\tconst materialDef = json.materials[ materialIndex ];\n\n\t\tlet materialType;\n\t\tconst materialParams = {};\n\t\tconst materialExtensions = materialDef.extensions || {};\n\n\t\tconst pending = [];\n\n\t\tif ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ] ) {\n\n\t\t\tconst sgExtension = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ];\n\t\t\tmaterialType = sgExtension.getMaterialType();\n\t\t\tpending.push( sgExtension.extendParams( materialParams, materialDef, parser ) );\n\n\t\t} else if ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ] ) {\n\n\t\t\tconst kmuExtension = extensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ];\n\t\t\tmaterialType = kmuExtension.getMaterialType();\n\t\t\tpending.push( kmuExtension.extendParams( materialParams, materialDef, parser ) );\n\n\t\t} else {\n\n\t\t\t// Specification:\n\t\t\t// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material\n\n\t\t\tconst metallicRoughness = materialDef.pbrMetallicRoughness || {};\n\n\t\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\n\t\t\tmaterialParams.opacity = 1.0;\n\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\n\n\t\t\t\tconst array = metallicRoughness.baseColorFactor;\n\n\t\t\t\tmaterialParams.color.fromArray( array );\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\n\n\t\t\t}\n\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture ) );\n\n\t\t\t}\n\n\t\t\tmaterialParams.metalness = metallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;\n\t\t\tmaterialParams.roughness = metallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;\n\n\t\t\tif ( metallicRoughness.metallicRoughnessTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'metalnessMap', metallicRoughness.metallicRoughnessTexture ) );\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'roughnessMap', metallicRoughness.metallicRoughnessTexture ) );\n\n\t\t\t}\n\n\t\t\tmaterialType = this._invokeOne( function ( ext ) {\n\n\t\t\t\treturn ext.getMaterialType && ext.getMaterialType( materialIndex );\n\n\t\t\t} );\n\n\t\t\tpending.push( Promise.all( this._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.extendMaterialParams && ext.extendMaterialParams( materialIndex, materialParams );\n\n\t\t\t} ) ) );\n\n\t\t}\n\n\t\tif ( materialDef.doubleSided === true ) {\n\n\t\t\tmaterialParams.side = DoubleSide;\n\n\t\t}\n\n\t\tconst alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;\n\n\t\tif ( alphaMode === ALPHA_MODES.BLEND ) {\n\n\t\t\tmaterialParams.transparent = true;\n\n\t\t\t// See: https://github.com/mrdoob/three.js/issues/17706\n\t\t\tmaterialParams.depthWrite = false;\n\n\t\t} else {\n\n\t\t\tmaterialParams.transparent = false;\n\n\t\t\tif ( alphaMode === ALPHA_MODES.MASK ) {\n\n\t\t\t\tmaterialParams.alphaTest = materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.normalTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'normalMap', materialDef.normalTexture ) );\n\n\t\t\t// https://github.com/mrdoob/three.js/issues/11438#issuecomment-507003995\n\t\t\tmaterialParams.normalScale = new Vector2( 1, - 1 );\n\n\t\t\tif ( materialDef.normalTexture.scale !== undefined ) {\n\n\t\t\t\tmaterialParams.normalScale.set( materialDef.normalTexture.scale, - materialDef.normalTexture.scale );\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.occlusionTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'aoMap', materialDef.occlusionTexture ) );\n\n\t\t\tif ( materialDef.occlusionTexture.strength !== undefined ) {\n\n\t\t\t\tmaterialParams.aoMapIntensity = materialDef.occlusionTexture.strength;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.emissiveFactor !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tmaterialParams.emissive = new Color().fromArray( materialDef.emissiveFactor );\n\n\t\t}\n\n\t\tif ( materialDef.emissiveTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'emissiveMap', materialDef.emissiveTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function () {\n\n\t\t\tlet material;\n\n\t\t\tif ( materialType === GLTFMeshStandardSGMaterial ) {\n\n\t\t\t\tmaterial = extensions[ EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS ].createMaterial( materialParams );\n\n\t\t\t} else {\n\n\t\t\t\tmaterial = new materialType( materialParams );\n\n\t\t\t}\n\n\t\t\tif ( materialDef.name ) material.name = materialDef.name;\n\n\t\t\t// baseColorTexture, emissiveTexture, and specularGlossinessTexture use sRGB encoding.\n\t\t\tif ( material.map ) material.map.encoding = sRGBEncoding;\n\t\t\tif ( material.emissiveMap ) material.emissiveMap.encoding = sRGBEncoding;\n\n\t\t\tassignExtrasToUserData( material, materialDef );\n\n\t\t\tparser.associations.set( material, { type: 'materials', index: materialIndex } );\n\n\t\t\tif ( materialDef.extensions ) addUnknownExtensionsToUserData( extensions, material, materialDef );\n\n\t\t\treturn material;\n\n\t\t} );\n\n\t}\n\n\t/** When Object3D instances are targeted by animation, they need unique names. */\n\tcreateUniqueName( originalName ) {\n\n\t\tconst sanitizedName = PropertyBinding.sanitizeNodeName( originalName || '' );\n\n\t\tlet name = sanitizedName;\n\n\t\tfor ( let i = 1; this.nodeNamesUsed[ name ]; ++ i ) {\n\n\t\t\tname = sanitizedName + '_' + i;\n\n\t\t}\n\n\t\tthis.nodeNamesUsed[ name ] = true;\n\n\t\treturn name;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry\n\t *\n\t * Creates BufferGeometries from primitives.\n\t *\n\t * @param {Array<GLTF.Primitive>} primitives\n\t * @return {Promise<Array<BufferGeometry>>}\n\t */\n\tloadGeometries( primitives ) {\n\n\t\tconst parser = this;\n\t\tconst extensions = this.extensions;\n\t\tconst cache = this.primitiveCache;\n\n\t\tfunction createDracoPrimitive( primitive ) {\n\n\t\t\treturn extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ]\n\t\t\t\t.decodePrimitive( primitive, parser )\n\t\t\t\t.then( function ( geometry ) {\n\n\t\t\t\t\treturn addPrimitiveAttributes( geometry, primitive, parser );\n\n\t\t\t\t} );\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = primitives.length; i < il; i ++ ) {\n\n\t\t\tconst primitive = primitives[ i ];\n\t\t\tconst cacheKey = createPrimitiveKey( primitive );\n\n\t\t\t// See if we've already created this geometry\n\t\t\tconst cached = cache[ cacheKey ];\n\n\t\t\tif ( cached ) {\n\n\t\t\t\t// Use the cached geometry if it exists\n\t\t\t\tpending.push( cached.promise );\n\n\t\t\t} else {\n\n\t\t\t\tlet geometryPromise;\n\n\t\t\t\tif ( primitive.extensions && primitive.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ] ) {\n\n\t\t\t\t\t// Use DRACO geometry if available\n\t\t\t\t\tgeometryPromise = createDracoPrimitive( primitive );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Otherwise create a new geometry\n\t\t\t\t\tgeometryPromise = addPrimitiveAttributes( new BufferGeometry(), primitive, parser );\n\n\t\t\t\t}\n\n\t\t\t\t// Cache this geometry\n\t\t\t\tcache[ cacheKey ] = { primitive: primitive, promise: geometryPromise };\n\n\t\t\t\tpending.push( geometryPromise );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes\n\t * @param {number} meshIndex\n\t * @return {Promise<Group|Mesh|SkinnedMesh>}\n\t */\n\tloadMesh( meshIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\n\t\tconst meshDef = json.meshes[ meshIndex ];\n\t\tconst primitives = meshDef.primitives;\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = primitives.length; i < il; i ++ ) {\n\n\t\t\tconst material = primitives[ i ].material === undefined\n\t\t\t\t? createDefaultMaterial( this.cache )\n\t\t\t\t: this.getDependency( 'material', primitives[ i ].material );\n\n\t\t\tpending.push( material );\n\n\t\t}\n\n\t\tpending.push( parser.loadGeometries( primitives ) );\n\n\t\treturn Promise.all( pending ).then( function ( results ) {\n\n\t\t\tconst materials = results.slice( 0, results.length - 1 );\n\t\t\tconst geometries = results[ results.length - 1 ];\n\n\t\t\tconst meshes = [];\n\n\t\t\tfor ( let i = 0, il = geometries.length; i < il; i ++ ) {\n\n\t\t\t\tconst geometry = geometries[ i ];\n\t\t\t\tconst primitive = primitives[ i ];\n\n\t\t\t\t// 1. create Mesh\n\n\t\t\t\tlet mesh;\n\n\t\t\t\tconst material = materials[ i ];\n\n\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLES ||\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||\n\t\t\t\t\t\tprimitive.mode === undefined ) {\n\n\t\t\t\t\t// .isSkinnedMesh isn't in glTF spec. See ._markDefs()\n\t\t\t\t\tmesh = meshDef.isSkinnedMesh === true\n\t\t\t\t\t\t? new SkinnedMesh( geometry, material )\n\t\t\t\t\t\t: new Mesh( geometry, material );\n\n\t\t\t\t\tif ( mesh.isSkinnedMesh === true && ! mesh.geometry.attributes.skinWeight.normalized ) {\n\n\t\t\t\t\t\t// we normalize floating point skin weight array to fix malformed assets (see #15319)\n\t\t\t\t\t\t// it's important to skip this for non-float32 data since normalizeSkinWeights assumes non-normalized inputs\n\t\t\t\t\t\tmesh.normalizeSkinWeights();\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ) {\n\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleStripDrawMode );\n\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ) {\n\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleFanDrawMode );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINES ) {\n\n\t\t\t\t\tmesh = new LineSegments( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_STRIP ) {\n\n\t\t\t\t\tmesh = new Line( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_LOOP ) {\n\n\t\t\t\t\tmesh = new LineLoop( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.POINTS ) {\n\n\t\t\t\t\tmesh = new Points( geometry, material );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode );\n\n\t\t\t\t}\n\n\t\t\t\tif ( Object.keys( mesh.geometry.morphAttributes ).length > 0 ) {\n\n\t\t\t\t\tupdateMorphTargets( mesh, meshDef );\n\n\t\t\t\t}\n\n\t\t\t\tmesh.name = parser.createUniqueName( meshDef.name || ( 'mesh_' + meshIndex ) );\n\n\t\t\t\tassignExtrasToUserData( mesh, meshDef );\n\n\t\t\t\tif ( primitive.extensions ) addUnknownExtensionsToUserData( extensions, mesh, primitive );\n\n\t\t\t\tparser.assignFinalMaterial( mesh );\n\n\t\t\t\tmeshes.push( mesh );\n\n\t\t\t}\n\n\t\t\tif ( meshes.length === 1 ) {\n\n\t\t\t\treturn meshes[ 0 ];\n\n\t\t\t}\n\n\t\t\tconst group = new Group();\n\n\t\t\tfor ( let i = 0, il = meshes.length; i < il; i ++ ) {\n\n\t\t\t\tgroup.add( meshes[ i ] );\n\n\t\t\t}\n\n\t\t\treturn group;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras\n\t * @param {number} cameraIndex\n\t * @return {Promise<THREE.Camera>}\n\t */\n\tloadCamera( cameraIndex ) {\n\n\t\tlet camera;\n\t\tconst cameraDef = this.json.cameras[ cameraIndex ];\n\t\tconst params = cameraDef[ cameraDef.type ];\n\n\t\tif ( ! params ) {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing camera parameters.' );\n\t\t\treturn;\n\n\t\t}\n\n\t\tif ( cameraDef.type === 'perspective' ) {\n\n\t\t\tcamera = new PerspectiveCamera( MathUtils.radToDeg( params.yfov ), params.aspectRatio || 1, params.znear || 1, params.zfar || 2e6 );\n\n\t\t} else if ( cameraDef.type === 'orthographic' ) {\n\n\t\t\tcamera = new OrthographicCamera( - params.xmag, params.xmag, params.ymag, - params.ymag, params.znear, params.zfar );\n\n\t\t}\n\n\t\tif ( cameraDef.name ) camera.name = this.createUniqueName( cameraDef.name );\n\n\t\tassignExtrasToUserData( camera, cameraDef );\n\n\t\treturn Promise.resolve( camera );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins\n\t * @param {number} skinIndex\n\t * @return {Promise<Object>}\n\t */\n\tloadSkin( skinIndex ) {\n\n\t\tconst skinDef = this.json.skins[ skinIndex ];\n\n\t\tconst skinEntry = { joints: skinDef.joints };\n\n\t\tif ( skinDef.inverseBindMatrices === undefined ) {\n\n\t\t\treturn Promise.resolve( skinEntry );\n\n\t\t}\n\n\t\treturn this.getDependency( 'accessor', skinDef.inverseBindMatrices ).then( function ( accessor ) {\n\n\t\t\tskinEntry.inverseBindMatrices = accessor;\n\n\t\t\treturn skinEntry;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations\n\t * @param {number} animationIndex\n\t * @return {Promise<AnimationClip>}\n\t */\n\tloadAnimation( animationIndex ) {\n\n\t\tconst json = this.json;\n\n\t\tconst animationDef = json.animations[ animationIndex ];\n\n\t\tconst pendingNodes = [];\n\t\tconst pendingInputAccessors = [];\n\t\tconst pendingOutputAccessors = [];\n\t\tconst pendingSamplers = [];\n\t\tconst pendingTargets = [];\n\n\t\tfor ( let i = 0, il = animationDef.channels.length; i < il; i ++ ) {\n\n\t\t\tconst channel = animationDef.channels[ i ];\n\t\t\tconst sampler = animationDef.samplers[ channel.sampler ];\n\t\t\tconst target = channel.target;\n\t\t\tconst name = target.node !== undefined ? target.node : target.id; // NOTE: target.id is deprecated.\n\t\t\tconst input = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.input ] : sampler.input;\n\t\t\tconst output = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.output ] : sampler.output;\n\n\t\t\tpendingNodes.push( this.getDependency( 'node', name ) );\n\t\t\tpendingInputAccessors.push( this.getDependency( 'accessor', input ) );\n\t\t\tpendingOutputAccessors.push( this.getDependency( 'accessor', output ) );\n\t\t\tpendingSamplers.push( sampler );\n\t\t\tpendingTargets.push( target );\n\n\t\t}\n\n\t\treturn Promise.all( [\n\n\t\t\tPromise.all( pendingNodes ),\n\t\t\tPromise.all( pendingInputAccessors ),\n\t\t\tPromise.all( pendingOutputAccessors ),\n\t\t\tPromise.all( pendingSamplers ),\n\t\t\tPromise.all( pendingTargets )\n\n\t\t] ).then( function ( dependencies ) {\n\n\t\t\tconst nodes = dependencies[ 0 ];\n\t\t\tconst inputAccessors = dependencies[ 1 ];\n\t\t\tconst outputAccessors = dependencies[ 2 ];\n\t\t\tconst samplers = dependencies[ 3 ];\n\t\t\tconst targets = dependencies[ 4 ];\n\n\t\t\tconst tracks = [];\n\n\t\t\tfor ( let i = 0, il = nodes.length; i < il; i ++ ) {\n\n\t\t\t\tconst node = nodes[ i ];\n\t\t\t\tconst inputAccessor = inputAccessors[ i ];\n\t\t\t\tconst outputAccessor = outputAccessors[ i ];\n\t\t\t\tconst sampler = samplers[ i ];\n\t\t\t\tconst target = targets[ i ];\n\n\t\t\t\tif ( node === undefined ) continue;\n\n\t\t\t\tnode.updateMatrix();\n\t\t\t\tnode.matrixAutoUpdate = true;\n\n\t\t\t\tlet TypedKeyframeTrack;\n\n\t\t\t\tswitch ( PATH_PROPERTIES[ target.path ] ) {\n\n\t\t\t\t\tcase PATH_PROPERTIES.weights:\n\n\t\t\t\t\t\tTypedKeyframeTrack = NumberKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase PATH_PROPERTIES.rotation:\n\n\t\t\t\t\t\tTypedKeyframeTrack = QuaternionKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase PATH_PROPERTIES.position:\n\t\t\t\t\tcase PATH_PROPERTIES.scale:\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tTypedKeyframeTrack = VectorKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t\tconst targetName = node.name ? node.name : node.uuid;\n\n\t\t\t\tconst interpolation = sampler.interpolation !== undefined ? INTERPOLATION[ sampler.interpolation ] : InterpolateLinear;\n\n\t\t\t\tconst targetNames = [];\n\n\t\t\t\tif ( PATH_PROPERTIES[ target.path ] === PATH_PROPERTIES.weights ) {\n\n\t\t\t\t\t// Node may be a Group (glTF mesh with several primitives) or a Mesh.\n\t\t\t\t\tnode.traverse( function ( object ) {\n\n\t\t\t\t\t\tif ( object.isMesh === true && object.morphTargetInfluences ) {\n\n\t\t\t\t\t\t\ttargetNames.push( object.name ? object.name : object.uuid );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} );\n\n\t\t\t\t} else {\n\n\t\t\t\t\ttargetNames.push( targetName );\n\n\t\t\t\t}\n\n\t\t\t\tlet outputArray = outputAccessor.array;\n\n\t\t\t\tif ( outputAccessor.normalized ) {\n\n\t\t\t\t\tconst scale = getNormalizedComponentScale( outputArray.constructor );\n\t\t\t\t\tconst scaled = new Float32Array( outputArray.length );\n\n\t\t\t\t\tfor ( let j = 0, jl = outputArray.length; j < jl; j ++ ) {\n\n\t\t\t\t\t\tscaled[ j ] = outputArray[ j ] * scale;\n\n\t\t\t\t\t}\n\n\t\t\t\t\toutputArray = scaled;\n\n\t\t\t\t}\n\n\t\t\t\tfor ( let j = 0, jl = targetNames.length; j < jl; j ++ ) {\n\n\t\t\t\t\tconst track = new TypedKeyframeTrack(\n\t\t\t\t\t\ttargetNames[ j ] + '.' + PATH_PROPERTIES[ target.path ],\n\t\t\t\t\t\tinputAccessor.array,\n\t\t\t\t\t\toutputArray,\n\t\t\t\t\t\tinterpolation\n\t\t\t\t\t);\n\n\t\t\t\t\t// Override interpolation with custom factory method.\n\t\t\t\t\tif ( sampler.interpolation === 'CUBICSPLINE' ) {\n\n\t\t\t\t\t\ttrack.createInterpolant = function InterpolantFactoryMethodGLTFCubicSpline( result ) {\n\n\t\t\t\t\t\t\t// A CUBICSPLINE keyframe in glTF has three output values for each input value,\n\t\t\t\t\t\t\t// representing inTangent, splineVertex, and outTangent. As a result, track.getValueSize()\n\t\t\t\t\t\t\t// must be divided by three to get the interpolant's sampleSize argument.\n\n\t\t\t\t\t\t\treturn new GLTFCubicSplineInterpolant( this.times, this.values, this.getValueSize() / 3, result );\n\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// Mark as CUBICSPLINE. `track.getInterpolation()` doesn't support custom interpolants.\n\t\t\t\t\t\ttrack.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline = true;\n\n\t\t\t\t\t}\n\n\t\t\t\t\ttracks.push( track );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tconst name = animationDef.name ? animationDef.name : 'animation_' + animationIndex;\n\n\t\t\treturn new AnimationClip( name, undefined, tracks );\n\n\t\t} );\n\n\t}\n\n\tcreateNodeMesh( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst parser = this;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\tif ( nodeDef.mesh === undefined ) return null;\n\n\t\treturn parser.getDependency( 'mesh', nodeDef.mesh ).then( function ( mesh ) {\n\n\t\t\tconst node = parser._getNodeRef( parser.meshCache, nodeDef.mesh, mesh );\n\n\t\t\t// if weights are provided on the node, override weights on the mesh.\n\t\t\tif ( nodeDef.weights !== undefined ) {\n\n\t\t\t\tnode.traverse( function ( o ) {\n\n\t\t\t\t\tif ( ! o.isMesh ) return;\n\n\t\t\t\t\tfor ( let i = 0, il = nodeDef.weights.length; i < il; i ++ ) {\n\n\t\t\t\t\t\to.morphTargetInfluences[ i ] = nodeDef.weights[ i ];\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy\n\t * @param {number} nodeIndex\n\t * @return {Promise<Object3D>}\n\t */\n\tloadNode( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\t\tconst parser = this;\n\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\t// reserve node's name before its dependencies, so the root has the intended name.\n\t\tconst nodeName = nodeDef.name ? parser.createUniqueName( nodeDef.name ) : '';\n\n\t\treturn ( function () {\n\n\t\t\tconst pending = [];\n\n\t\t\tconst meshPromise = parser._invokeOne( function ( ext ) {\n\n\t\t\t\treturn ext.createNodeMesh && ext.createNodeMesh( nodeIndex );\n\n\t\t\t} );\n\n\t\t\tif ( meshPromise ) {\n\n\t\t\t\tpending.push( meshPromise );\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.camera !== undefined ) {\n\n\t\t\t\tpending.push( parser.getDependency( 'camera', nodeDef.camera ).then( function ( camera ) {\n\n\t\t\t\t\treturn parser._getNodeRef( parser.cameraCache, nodeDef.camera, camera );\n\n\t\t\t\t} ) );\n\n\t\t\t}\n\n\t\t\tparser._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.createNodeAttachment && ext.createNodeAttachment( nodeIndex );\n\n\t\t\t} ).forEach( function ( promise ) {\n\n\t\t\t\tpending.push( promise );\n\n\t\t\t} );\n\n\t\t\treturn Promise.all( pending );\n\n\t\t}() ).then( function ( objects ) {\n\n\t\t\tlet node;\n\n\t\t\t// .isBone isn't in glTF spec. See ._markDefs\n\t\t\tif ( nodeDef.isBone === true ) {\n\n\t\t\t\tnode = new Bone();\n\n\t\t\t} else if ( objects.length > 1 ) {\n\n\t\t\t\tnode = new Group();\n\n\t\t\t} else if ( objects.length === 1 ) {\n\n\t\t\t\tnode = objects[ 0 ];\n\n\t\t\t} else {\n\n\t\t\t\tnode = new Object3D();\n\n\t\t\t}\n\n\t\t\tif ( node !== objects[ 0 ] ) {\n\n\t\t\t\tfor ( let i = 0, il = objects.length; i < il; i ++ ) {\n\n\t\t\t\t\tnode.add( objects[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.name ) {\n\n\t\t\t\tnode.userData.name = nodeDef.name;\n\t\t\t\tnode.name = nodeName;\n\n\t\t\t}\n\n\t\t\tassignExtrasToUserData( node, nodeDef );\n\n\t\t\tif ( nodeDef.extensions ) addUnknownExtensionsToUserData( extensions, node, nodeDef );\n\n\t\t\tif ( nodeDef.matrix !== undefined ) {\n\n\t\t\t\tconst matrix = new Matrix4();\n\t\t\t\tmatrix.fromArray( nodeDef.matrix );\n\t\t\t\tnode.applyMatrix4( matrix );\n\n\t\t\t} else {\n\n\t\t\t\tif ( nodeDef.translation !== undefined ) {\n\n\t\t\t\t\tnode.position.fromArray( nodeDef.translation );\n\n\t\t\t\t}\n\n\t\t\t\tif ( nodeDef.rotation !== undefined ) {\n\n\t\t\t\t\tnode.quaternion.fromArray( nodeDef.rotation );\n\n\t\t\t\t}\n\n\t\t\t\tif ( nodeDef.scale !== undefined ) {\n\n\t\t\t\t\tnode.scale.fromArray( nodeDef.scale );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tparser.associations.set( node, { type: 'nodes', index: nodeIndex } );\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes\n\t * @param {number} sceneIndex\n\t * @return {Promise<Group>}\n\t */\n\tloadScene( sceneIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\t\tconst sceneDef = this.json.scenes[ sceneIndex ];\n\t\tconst parser = this;\n\n\t\t// Loader returns Group, not Scene.\n\t\t// See: https://github.com/mrdoob/three.js/issues/18342#issuecomment-578981172\n\t\tconst scene = new Group();\n\t\tif ( sceneDef.name ) scene.name = parser.createUniqueName( sceneDef.name );\n\n\t\tassignExtrasToUserData( scene, sceneDef );\n\n\t\tif ( sceneDef.extensions ) addUnknownExtensionsToUserData( extensions, scene, sceneDef );\n\n\t\tconst nodeIds = sceneDef.nodes || [];\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = nodeIds.length; i < il; i ++ ) {\n\n\t\t\tpending.push( buildNodeHierachy( nodeIds[ i ], scene, json, parser ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function () {\n\n\t\t\treturn scene;\n\n\t\t} );\n\n\t}\n\n}\n\nfunction buildNodeHierachy( nodeId, parentObject, json, parser ) {\n\n\tconst nodeDef = json.nodes[ nodeId ];\n\n\treturn parser.getDependency( 'node', nodeId ).then( function ( node ) {\n\n\t\tif ( nodeDef.skin === undefined ) return node;\n\n\t\t// build skeleton here as well\n\n\t\tlet skinEntry;\n\n\t\treturn parser.getDependency( 'skin', nodeDef.skin ).then( function ( skin ) {\n\n\t\t\tskinEntry = skin;\n\n\t\t\tconst pendingJoints = [];\n\n\t\t\tfor ( let i = 0, il = skinEntry.joints.length; i < il; i ++ ) {\n\n\t\t\t\tpendingJoints.push( parser.getDependency( 'node', skinEntry.joints[ i ] ) );\n\n\t\t\t}\n\n\t\t\treturn Promise.all( pendingJoints );\n\n\t\t} ).then( function ( jointNodes ) {\n\n\t\t\tnode.traverse( function ( mesh ) {\n\n\t\t\t\tif ( ! mesh.isMesh ) return;\n\n\t\t\t\tconst bones = [];\n\t\t\t\tconst boneInverses = [];\n\n\t\t\t\tfor ( let j = 0, jl = jointNodes.length; j < jl; j ++ ) {\n\n\t\t\t\t\tconst jointNode = jointNodes[ j ];\n\n\t\t\t\t\tif ( jointNode ) {\n\n\t\t\t\t\t\tbones.push( jointNode );\n\n\t\t\t\t\t\tconst mat = new Matrix4();\n\n\t\t\t\t\t\tif ( skinEntry.inverseBindMatrices !== undefined ) {\n\n\t\t\t\t\t\t\tmat.fromArray( skinEntry.inverseBindMatrices.array, j * 16 );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tboneInverses.push( mat );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Joint \"%s\" could not be found.', skinEntry.joints[ j ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tmesh.bind( new Skeleton( bones, boneInverses ), mesh.matrixWorld );\n\n\t\t\t} );\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t} ).then( function ( node ) {\n\n\t\t// build node hierachy\n\n\t\tparentObject.add( node );\n\n\t\tconst pending = [];\n\n\t\tif ( nodeDef.children ) {\n\n\t\t\tconst children = nodeDef.children;\n\n\t\t\tfor ( let i = 0, il = children.length; i < il; i ++ ) {\n\n\t\t\t\tconst child = children[ i ];\n\t\t\t\tpending.push( buildNodeHierachy( child, node, json, parser ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t} );\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {GLTF.Primitive} primitiveDef\n * @param {GLTFParser} parser\n */\nfunction computeBounds( geometry, primitiveDef, parser ) {\n\n\tconst attributes = primitiveDef.attributes;\n\n\tconst box = new Box3();\n\n\tif ( attributes.POSITION !== undefined ) {\n\n\t\tconst accessor = parser.json.accessors[ attributes.POSITION ];\n\n\t\tconst min = accessor.min;\n\t\tconst max = accessor.max;\n\n\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\n\n\t\tif ( min !== undefined && max !== undefined ) {\n\n\t\t\tbox.set(\n\t\t\t\tnew Vector3( min[ 0 ], min[ 1 ], min[ 2 ] ),\n\t\t\t\tnew Vector3( max[ 0 ], max[ 1 ], max[ 2 ] )\n\t\t\t);\n\n\t\t\tif ( accessor.normalized ) {\n\n\t\t\t\tconst boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );\n\t\t\t\tbox.min.multiplyScalar( boxScale );\n\t\t\t\tbox.max.multiplyScalar( boxScale );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\n\n\t\t\treturn;\n\n\t\t}\n\n\t} else {\n\n\t\treturn;\n\n\t}\n\n\tconst targets = primitiveDef.targets;\n\n\tif ( targets !== undefined ) {\n\n\t\tconst maxDisplacement = new Vector3();\n\t\tconst vector = new Vector3();\n\n\t\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\t\tconst target = targets[ i ];\n\n\t\t\tif ( target.POSITION !== undefined ) {\n\n\t\t\t\tconst accessor = parser.json.accessors[ target.POSITION ];\n\t\t\t\tconst min = accessor.min;\n\t\t\t\tconst max = accessor.max;\n\n\t\t\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\n\n\t\t\t\tif ( min !== undefined && max !== undefined ) {\n\n\t\t\t\t\t// we need to get max of absolute components because target weight is [-1,1]\n\t\t\t\t\tvector.setX( Math.max( Math.abs( min[ 0 ] ), Math.abs( max[ 0 ] ) ) );\n\t\t\t\t\tvector.setY( Math.max( Math.abs( min[ 1 ] ), Math.abs( max[ 1 ] ) ) );\n\t\t\t\t\tvector.setZ( Math.max( Math.abs( min[ 2 ] ), Math.abs( max[ 2 ] ) ) );\n\n\n\t\t\t\t\tif ( accessor.normalized ) {\n\n\t\t\t\t\t\tconst boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );\n\t\t\t\t\t\tvector.multiplyScalar( boxScale );\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// Note: this assumes that the sum of all weights is at most 1. This isn't quite correct - it's more conservative\n\t\t\t\t\t// to assume that each target can have a max weight of 1. However, for some use cases - notably, when morph targets\n\t\t\t\t\t// are used to implement key-frame animations and as such only two are active at a time - this results in very large\n\t\t\t\t\t// boxes. So for now we make a box that's sometimes a touch too small but is hopefully mostly of reasonable size.\n\t\t\t\t\tmaxDisplacement.max( vector );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// As per comment above this box isn't conservative, but has a reasonable size for a very large number of morph targets.\n\t\tbox.expandByVector( maxDisplacement );\n\n\t}\n\n\tgeometry.boundingBox = box;\n\n\tconst sphere = new Sphere();\n\n\tbox.getCenter( sphere.center );\n\tsphere.radius = box.min.distanceTo( box.max ) / 2;\n\n\tgeometry.boundingSphere = sphere;\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {GLTF.Primitive} primitiveDef\n * @param {GLTFParser} parser\n * @return {Promise<BufferGeometry>}\n */\nfunction addPrimitiveAttributes( geometry, primitiveDef, parser ) {\n\n\tconst attributes = primitiveDef.attributes;\n\n\tconst pending = [];\n\n\tfunction assignAttributeAccessor( accessorIndex, attributeName ) {\n\n\t\treturn parser.getDependency( 'accessor', accessorIndex )\n\t\t\t.then( function ( accessor ) {\n\n\t\t\t\tgeometry.setAttribute( attributeName, accessor );\n\n\t\t\t} );\n\n\t}\n\n\tfor ( const gltfAttributeName in attributes ) {\n\n\t\tconst threeAttributeName = ATTRIBUTES[ gltfAttributeName ] || gltfAttributeName.toLowerCase();\n\n\t\t// Skip attributes already provided by e.g. Draco extension.\n\t\tif ( threeAttributeName in geometry.attributes ) continue;\n\n\t\tpending.push( assignAttributeAccessor( attributes[ gltfAttributeName ], threeAttributeName ) );\n\n\t}\n\n\tif ( primitiveDef.indices !== undefined && ! geometry.index ) {\n\n\t\tconst accessor = parser.getDependency( 'accessor', primitiveDef.indices ).then( function ( accessor ) {\n\n\t\t\tgeometry.setIndex( accessor );\n\n\t\t} );\n\n\t\tpending.push( accessor );\n\n\t}\n\n\tassignExtrasToUserData( geometry, primitiveDef );\n\n\tcomputeBounds( geometry, primitiveDef, parser );\n\n\treturn Promise.all( pending ).then( function () {\n\n\t\treturn primitiveDef.targets !== undefined\n\t\t\t? addMorphTargets( geometry, primitiveDef.targets, parser )\n\t\t\t: geometry;\n\n\t} );\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {Number} drawMode\n * @return {BufferGeometry}\n */\nfunction toTrianglesDrawMode( geometry, drawMode ) {\n\n\tlet index = geometry.getIndex();\n\n\t// generate index if not present\n\n\tif ( index === null ) {\n\n\t\tconst indices = [];\n\n\t\tconst position = geometry.getAttribute( 'position' );\n\n\t\tif ( position !== undefined ) {\n\n\t\t\tfor ( let i = 0; i < position.count; i ++ ) {\n\n\t\t\t\tindices.push( i );\n\n\t\t\t}\n\n\t\t\tgeometry.setIndex( indices );\n\t\t\tindex = geometry.getIndex();\n\n\t\t} else {\n\n\t\t\tconsole.error( 'THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible.' );\n\t\t\treturn geometry;\n\n\t\t}\n\n\t}\n\n\t//\n\n\tconst numberOfTriangles = index.count - 2;\n\tconst newIndices = [];\n\n\tif ( drawMode === TriangleFanDrawMode ) {\n\n\t\t// gl.TRIANGLE_FAN\n\n\t\tfor ( let i = 1; i <= numberOfTriangles; i ++ ) {\n\n\t\t\tnewIndices.push( index.getX( 0 ) );\n\t\t\tnewIndices.push( index.getX( i ) );\n\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\n\t\t}\n\n\t} else {\n\n\t\t// gl.TRIANGLE_STRIP\n\n\t\tfor ( let i = 0; i < numberOfTriangles; i ++ ) {\n\n\t\t\tif ( i % 2 === 0 ) {\n\n\t\t\t\tnewIndices.push( index.getX( i ) );\n\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\n\n\n\t\t\t} else {\n\n\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\n\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\t\t\t\tnewIndices.push( index.getX( i ) );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tif ( ( newIndices.length / 3 ) !== numberOfTriangles ) {\n\n\t\tconsole.error( 'THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.' );\n\n\t}\n\n\t// build final geometry\n\n\tconst newGeometry = geometry.clone();\n\tnewGeometry.setIndex( newIndices );\n\n\treturn newGeometry;\n\n}\n\nexport { GLTFLoader };\n","/**\n * @webxr-input-profiles/motion-controllers 1.0.0 https://github.com/immersive-web/webxr-input-profiles\n */\n\nconst Constants = {\n  Handedness: Object.freeze({\n    NONE: 'none',\n    LEFT: 'left',\n    RIGHT: 'right'\n  }),\n\n  ComponentState: Object.freeze({\n    DEFAULT: 'default',\n    TOUCHED: 'touched',\n    PRESSED: 'pressed'\n  }),\n\n  ComponentProperty: Object.freeze({\n    BUTTON: 'button',\n    X_AXIS: 'xAxis',\n    Y_AXIS: 'yAxis',\n    STATE: 'state'\n  }),\n\n  ComponentType: Object.freeze({\n    TRIGGER: 'trigger',\n    SQUEEZE: 'squeeze',\n    TOUCHPAD: 'touchpad',\n    THUMBSTICK: 'thumbstick',\n    BUTTON: 'button'\n  }),\n\n  ButtonTouchThreshold: 0.05,\n\n  AxisTouchThreshold: 0.1,\n\n  VisualResponseProperty: Object.freeze({\n    TRANSFORM: 'transform',\n    VISIBILITY: 'visibility'\n  })\n};\n\n/**\n * @description Static helper function to fetch a JSON file and turn it into a JS object\n * @param {string} path - Path to JSON file to be fetched\n */\nasync function fetchJsonFile(path) {\n  const response = await fetch(path);\n  if (!response.ok) {\n    throw new Error(response.statusText);\n  } else {\n    return response.json();\n  }\n}\n\nasync function fetchProfilesList(basePath) {\n  if (!basePath) {\n    throw new Error('No basePath supplied');\n  }\n\n  const profileListFileName = 'profilesList.json';\n  const profilesList = await fetchJsonFile(`${basePath}/${profileListFileName}`);\n  return profilesList;\n}\n\nasync function fetchProfile(xrInputSource, basePath, defaultProfile = null, getAssetPath = true) {\n  if (!xrInputSource) {\n    throw new Error('No xrInputSource supplied');\n  }\n\n  if (!basePath) {\n    throw new Error('No basePath supplied');\n  }\n\n  // Get the list of profiles\n  const supportedProfilesList = await fetchProfilesList(basePath);\n\n  // Find the relative path to the first requested profile that is recognized\n  let match;\n  xrInputSource.profiles.some((profileId) => {\n    const supportedProfile = supportedProfilesList[profileId];\n    if (supportedProfile) {\n      match = {\n        profileId,\n        profilePath: `${basePath}/${supportedProfile.path}`,\n        deprecated: !!supportedProfile.deprecated\n      };\n    }\n    return !!match;\n  });\n\n  if (!match) {\n    if (!defaultProfile) {\n      throw new Error('No matching profile name found');\n    }\n\n    const supportedProfile = supportedProfilesList[defaultProfile];\n    if (!supportedProfile) {\n      throw new Error(`No matching profile name found and default profile \"${defaultProfile}\" missing.`);\n    }\n\n    match = {\n      profileId: defaultProfile,\n      profilePath: `${basePath}/${supportedProfile.path}`,\n      deprecated: !!supportedProfile.deprecated\n    };\n  }\n\n  const profile = await fetchJsonFile(match.profilePath);\n\n  let assetPath;\n  if (getAssetPath) {\n    let layout;\n    if (xrInputSource.handedness === 'any') {\n      layout = profile.layouts[Object.keys(profile.layouts)[0]];\n    } else {\n      layout = profile.layouts[xrInputSource.handedness];\n    }\n    if (!layout) {\n      throw new Error(\n        `No matching handedness, ${xrInputSource.handedness}, in profile ${match.profileId}`\n      );\n    }\n\n    if (layout.assetPath) {\n      assetPath = match.profilePath.replace('profile.json', layout.assetPath);\n    }\n  }\n\n  return { profile, assetPath };\n}\n\n/** @constant {Object} */\nconst defaultComponentValues = {\n  xAxis: 0,\n  yAxis: 0,\n  button: 0,\n  state: Constants.ComponentState.DEFAULT\n};\n\n/**\n * @description Converts an X, Y coordinate from the range -1 to 1 (as reported by the Gamepad\n * API) to the range 0 to 1 (for interpolation). Also caps the X, Y values to be bounded within\n * a circle. This ensures that thumbsticks are not animated outside the bounds of their physical\n * range of motion and touchpads do not report touch locations off their physical bounds.\n * @param {number} x The original x coordinate in the range -1 to 1\n * @param {number} y The original y coordinate in the range -1 to 1\n */\nfunction normalizeAxes(x = 0, y = 0) {\n  let xAxis = x;\n  let yAxis = y;\n\n  // Determine if the point is outside the bounds of the circle\n  // and, if so, place it on the edge of the circle\n  const hypotenuse = Math.sqrt((x * x) + (y * y));\n  if (hypotenuse > 1) {\n    const theta = Math.atan2(y, x);\n    xAxis = Math.cos(theta);\n    yAxis = Math.sin(theta);\n  }\n\n  // Scale and move the circle so values are in the interpolation range.  The circle's origin moves\n  // from (0, 0) to (0.5, 0.5). The circle's radius scales from 1 to be 0.5.\n  const result = {\n    normalizedXAxis: (xAxis * 0.5) + 0.5,\n    normalizedYAxis: (yAxis * 0.5) + 0.5\n  };\n  return result;\n}\n\n/**\n * Contains the description of how the 3D model should visually respond to a specific user input.\n * This is accomplished by initializing the object with the name of a node in the 3D model and\n * property that need to be modified in response to user input, the name of the nodes representing\n * the allowable range of motion, and the name of the input which triggers the change. In response\n * to the named input changing, this object computes the appropriate weighting to use for\n * interpolating between the range of motion nodes.\n */\nclass VisualResponse {\n  constructor(visualResponseDescription) {\n    this.componentProperty = visualResponseDescription.componentProperty;\n    this.states = visualResponseDescription.states;\n    this.valueNodeName = visualResponseDescription.valueNodeName;\n    this.valueNodeProperty = visualResponseDescription.valueNodeProperty;\n\n    if (this.valueNodeProperty === Constants.VisualResponseProperty.TRANSFORM) {\n      this.minNodeName = visualResponseDescription.minNodeName;\n      this.maxNodeName = visualResponseDescription.maxNodeName;\n    }\n\n    // Initializes the response's current value based on default data\n    this.value = 0;\n    this.updateFromComponent(defaultComponentValues);\n  }\n\n  /**\n   * Computes the visual response's interpolation weight based on component state\n   * @param {Object} componentValues - The component from which to update\n   * @param {number} xAxis - The reported X axis value of the component\n   * @param {number} yAxis - The reported Y axis value of the component\n   * @param {number} button - The reported value of the component's button\n   * @param {string} state - The component's active state\n   */\n  updateFromComponent({\n    xAxis, yAxis, button, state\n  }) {\n    const { normalizedXAxis, normalizedYAxis } = normalizeAxes(xAxis, yAxis);\n    switch (this.componentProperty) {\n      case Constants.ComponentProperty.X_AXIS:\n        this.value = (this.states.includes(state)) ? normalizedXAxis : 0.5;\n        break;\n      case Constants.ComponentProperty.Y_AXIS:\n        this.value = (this.states.includes(state)) ? normalizedYAxis : 0.5;\n        break;\n      case Constants.ComponentProperty.BUTTON:\n        this.value = (this.states.includes(state)) ? button : 0;\n        break;\n      case Constants.ComponentProperty.STATE:\n        if (this.valueNodeProperty === Constants.VisualResponseProperty.VISIBILITY) {\n          this.value = (this.states.includes(state));\n        } else {\n          this.value = this.states.includes(state) ? 1.0 : 0.0;\n        }\n        break;\n      default:\n        throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`);\n    }\n  }\n}\n\nclass Component {\n  /**\n   * @param {Object} componentId - Id of the component\n   * @param {Object} componentDescription - Description of the component to be created\n   */\n  constructor(componentId, componentDescription) {\n    if (!componentId\n     || !componentDescription\n     || !componentDescription.visualResponses\n     || !componentDescription.gamepadIndices\n     || Object.keys(componentDescription.gamepadIndices).length === 0) {\n      throw new Error('Invalid arguments supplied');\n    }\n\n    this.id = componentId;\n    this.type = componentDescription.type;\n    this.rootNodeName = componentDescription.rootNodeName;\n    this.touchPointNodeName = componentDescription.touchPointNodeName;\n\n    // Build all the visual responses for this component\n    this.visualResponses = {};\n    Object.keys(componentDescription.visualResponses).forEach((responseName) => {\n      const visualResponse = new VisualResponse(componentDescription.visualResponses[responseName]);\n      this.visualResponses[responseName] = visualResponse;\n    });\n\n    // Set default values\n    this.gamepadIndices = Object.assign({}, componentDescription.gamepadIndices);\n\n    this.values = {\n      state: Constants.ComponentState.DEFAULT,\n      button: (this.gamepadIndices.button !== undefined) ? 0 : undefined,\n      xAxis: (this.gamepadIndices.xAxis !== undefined) ? 0 : undefined,\n      yAxis: (this.gamepadIndices.yAxis !== undefined) ? 0 : undefined\n    };\n  }\n\n  get data() {\n    const data = { id: this.id, ...this.values };\n    return data;\n  }\n\n  /**\n   * @description Poll for updated data based on current gamepad state\n   * @param {Object} gamepad - The gamepad object from which the component data should be polled\n   */\n  updateFromGamepad(gamepad) {\n    // Set the state to default before processing other data sources\n    this.values.state = Constants.ComponentState.DEFAULT;\n\n    // Get and normalize button\n    if (this.gamepadIndices.button !== undefined\n        && gamepad.buttons.length > this.gamepadIndices.button) {\n      const gamepadButton = gamepad.buttons[this.gamepadIndices.button];\n      this.values.button = gamepadButton.value;\n      this.values.button = (this.values.button < 0) ? 0 : this.values.button;\n      this.values.button = (this.values.button > 1) ? 1 : this.values.button;\n\n      // Set the state based on the button\n      if (gamepadButton.pressed || this.values.button === 1) {\n        this.values.state = Constants.ComponentState.PRESSED;\n      } else if (gamepadButton.touched || this.values.button > Constants.ButtonTouchThreshold) {\n        this.values.state = Constants.ComponentState.TOUCHED;\n      }\n    }\n\n    // Get and normalize x axis value\n    if (this.gamepadIndices.xAxis !== undefined\n        && gamepad.axes.length > this.gamepadIndices.xAxis) {\n      this.values.xAxis = gamepad.axes[this.gamepadIndices.xAxis];\n      this.values.xAxis = (this.values.xAxis < -1) ? -1 : this.values.xAxis;\n      this.values.xAxis = (this.values.xAxis > 1) ? 1 : this.values.xAxis;\n\n      // If the state is still default, check if the xAxis makes it touched\n      if (this.values.state === Constants.ComponentState.DEFAULT\n        && Math.abs(this.values.xAxis) > Constants.AxisTouchThreshold) {\n        this.values.state = Constants.ComponentState.TOUCHED;\n      }\n    }\n\n    // Get and normalize Y axis value\n    if (this.gamepadIndices.yAxis !== undefined\n        && gamepad.axes.length > this.gamepadIndices.yAxis) {\n      this.values.yAxis = gamepad.axes[this.gamepadIndices.yAxis];\n      this.values.yAxis = (this.values.yAxis < -1) ? -1 : this.values.yAxis;\n      this.values.yAxis = (this.values.yAxis > 1) ? 1 : this.values.yAxis;\n\n      // If the state is still default, check if the yAxis makes it touched\n      if (this.values.state === Constants.ComponentState.DEFAULT\n        && Math.abs(this.values.yAxis) > Constants.AxisTouchThreshold) {\n        this.values.state = Constants.ComponentState.TOUCHED;\n      }\n    }\n\n    // Update the visual response weights based on the current component data\n    Object.values(this.visualResponses).forEach((visualResponse) => {\n      visualResponse.updateFromComponent(this.values);\n    });\n  }\n}\n\n/**\n  * @description Builds a motion controller with components and visual responses based on the\n  * supplied profile description. Data is polled from the xrInputSource's gamepad.\n  * @author Nell Waliczek / https://github.com/NellWaliczek\n*/\nclass MotionController {\n  /**\n   * @param {Object} xrInputSource - The XRInputSource to build the MotionController around\n   * @param {Object} profile - The best matched profile description for the supplied xrInputSource\n   * @param {Object} assetUrl\n   */\n  constructor(xrInputSource, profile, assetUrl) {\n    if (!xrInputSource) {\n      throw new Error('No xrInputSource supplied');\n    }\n\n    if (!profile) {\n      throw new Error('No profile supplied');\n    }\n\n    this.xrInputSource = xrInputSource;\n    this.assetUrl = assetUrl;\n    this.id = profile.profileId;\n\n    // Build child components as described in the profile description\n    this.layoutDescription = profile.layouts[xrInputSource.handedness];\n    this.components = {};\n    Object.keys(this.layoutDescription.components).forEach((componentId) => {\n      const componentDescription = this.layoutDescription.components[componentId];\n      this.components[componentId] = new Component(componentId, componentDescription);\n    });\n\n    // Initialize components based on current gamepad state\n    this.updateFromGamepad();\n  }\n\n  get gripSpace() {\n    return this.xrInputSource.gripSpace;\n  }\n\n  get targetRaySpace() {\n    return this.xrInputSource.targetRaySpace;\n  }\n\n  /**\n   * @description Returns a subset of component data for simplified debugging\n   */\n  get data() {\n    const data = [];\n    Object.values(this.components).forEach((component) => {\n      data.push(component.data);\n    });\n    return data;\n  }\n\n  /**\n   * @description Poll for updated data based on current gamepad state\n   */\n  updateFromGamepad() {\n    Object.values(this.components).forEach((component) => {\n      component.updateFromGamepad(this.xrInputSource.gamepad);\n    });\n  }\n}\n\nexport { Constants, MotionController, fetchProfile, fetchProfilesList };\n","import {\n\tMesh,\n\tMeshBasicMaterial,\n\tObject3D,\n\tSphereGeometry,\n} from 'three';\n\nimport { GLTFLoader } from '../loaders/GLTFLoader.js';\n\nimport {\n\tConstants as MotionControllerConstants,\n\tfetchProfile,\n\tMotionController\n} from '../libs/motion-controllers.module.js';\n\nconst DEFAULT_PROFILES_PATH = 'https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles';\nconst DEFAULT_PROFILE = 'generic-trigger';\n\nclass XRControllerModel extends Object3D {\n\n\tconstructor() {\n\n\t\tsuper();\n\n\t\tthis.motionController = null;\n\t\tthis.envMap = null;\n\n\t}\n\n\tsetEnvironmentMap( envMap ) {\n\n\t\tif ( this.envMap == envMap ) {\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\tthis.envMap = envMap;\n\t\tthis.traverse( ( child ) => {\n\n\t\t\tif ( child.isMesh ) {\n\n\t\t\t\tchild.material.envMap = this.envMap;\n\t\t\t\tchild.material.needsUpdate = true;\n\n\t\t\t}\n\n\t\t} );\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t * Polls data from the XRInputSource and updates the model's components to match\n\t * the real world data\n\t */\n\tupdateMatrixWorld( force ) {\n\n\t\tsuper.updateMatrixWorld( force );\n\n\t\tif ( ! this.motionController ) return;\n\n\t\t// Cause the MotionController to poll the Gamepad for data\n\t\tthis.motionController.updateFromGamepad();\n\n\t\t// Update the 3D model to reflect the button, thumbstick, and touchpad state\n\t\tObject.values( this.motionController.components ).forEach( ( component ) => {\n\n\t\t\t// Update node data based on the visual responses' current states\n\t\t\tObject.values( component.visualResponses ).forEach( ( visualResponse ) => {\n\n\t\t\t\tconst { valueNode, minNode, maxNode, value, valueNodeProperty } = visualResponse;\n\n\t\t\t\t// Skip if the visual response node is not found. No error is needed,\n\t\t\t\t// because it will have been reported at load time.\n\t\t\t\tif ( ! valueNode ) return;\n\n\t\t\t\t// Calculate the new properties based on the weight supplied\n\t\t\t\tif ( valueNodeProperty === MotionControllerConstants.VisualResponseProperty.VISIBILITY ) {\n\n\t\t\t\t\tvalueNode.visible = value;\n\n\t\t\t\t} else if ( valueNodeProperty === MotionControllerConstants.VisualResponseProperty.TRANSFORM ) {\n\n\t\t\t\t\tvalueNode.quaternion.slerpQuaternions(\n\t\t\t\t\t\tminNode.quaternion,\n\t\t\t\t\t\tmaxNode.quaternion,\n\t\t\t\t\t\tvalue\n\t\t\t\t\t);\n\n\t\t\t\t\tvalueNode.position.lerpVectors(\n\t\t\t\t\t\tminNode.position,\n\t\t\t\t\t\tmaxNode.position,\n\t\t\t\t\t\tvalue\n\t\t\t\t\t);\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * Walks the model's tree to find the nodes needed to animate the components and\n * saves them to the motionContoller components for use in the frame loop. When\n * touchpads are found, attaches a touch dot to them.\n */\nfunction findNodes( motionController, scene ) {\n\n\t// Loop through the components and find the nodes needed for each components' visual responses\n\tObject.values( motionController.components ).forEach( ( component ) => {\n\n\t\tconst { type, touchPointNodeName, visualResponses } = component;\n\n\t\tif ( type === MotionControllerConstants.ComponentType.TOUCHPAD ) {\n\n\t\t\tcomponent.touchPointNode = scene.getObjectByName( touchPointNodeName );\n\t\t\tif ( component.touchPointNode ) {\n\n\t\t\t\t// Attach a touch dot to the touchpad.\n\t\t\t\tconst sphereGeometry = new SphereGeometry( 0.001 );\n\t\t\t\tconst material = new MeshBasicMaterial( { color: 0x0000FF } );\n\t\t\t\tconst sphere = new Mesh( sphereGeometry, material );\n\t\t\t\tcomponent.touchPointNode.add( sphere );\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( `Could not find touch dot, ${component.touchPointNodeName}, in touchpad component ${component.id}` );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Loop through all the visual responses to be applied to this component\n\t\tObject.values( visualResponses ).forEach( ( visualResponse ) => {\n\n\t\t\tconst { valueNodeName, minNodeName, maxNodeName, valueNodeProperty } = visualResponse;\n\n\t\t\t// If animating a transform, find the two nodes to be interpolated between.\n\t\t\tif ( valueNodeProperty === MotionControllerConstants.VisualResponseProperty.TRANSFORM ) {\n\n\t\t\t\tvisualResponse.minNode = scene.getObjectByName( minNodeName );\n\t\t\t\tvisualResponse.maxNode = scene.getObjectByName( maxNodeName );\n\n\t\t\t\t// If the extents cannot be found, skip this animation\n\t\t\t\tif ( ! visualResponse.minNode ) {\n\n\t\t\t\t\tconsole.warn( `Could not find ${minNodeName} in the model` );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t\tif ( ! visualResponse.maxNode ) {\n\n\t\t\t\t\tconsole.warn( `Could not find ${maxNodeName} in the model` );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// If the target node cannot be found, skip this animation\n\t\t\tvisualResponse.valueNode = scene.getObjectByName( valueNodeName );\n\t\t\tif ( ! visualResponse.valueNode ) {\n\n\t\t\t\tconsole.warn( `Could not find ${valueNodeName} in the model` );\n\n\t\t\t}\n\n\t\t} );\n\n\t} );\n\n}\n\nfunction addAssetSceneToControllerModel( controllerModel, scene ) {\n\n\t// Find the nodes needed for animation and cache them on the motionController.\n\tfindNodes( controllerModel.motionController, scene );\n\n\t// Apply any environment map that the mesh already has set.\n\tif ( controllerModel.envMap ) {\n\n\t\tscene.traverse( ( child ) => {\n\n\t\t\tif ( child.isMesh ) {\n\n\t\t\t\tchild.material.envMap = controllerModel.envMap;\n\t\t\t\tchild.material.needsUpdate = true;\n\n\t\t\t}\n\n\t\t} );\n\n\t}\n\n\t// Add the glTF scene to the controllerModel.\n\tcontrollerModel.add( scene );\n\n}\n\nclass XRControllerModelFactory {\n\n\tconstructor( gltfLoader = null ) {\n\n\t\tthis.gltfLoader = gltfLoader;\n\t\tthis.path = DEFAULT_PROFILES_PATH;\n\t\tthis._assetCache = {};\n\n\t\t// If a GLTFLoader wasn't supplied to the constructor create a new one.\n\t\tif ( ! this.gltfLoader ) {\n\n\t\t\tthis.gltfLoader = new GLTFLoader();\n\n\t\t}\n\n\t}\n\n\tcreateControllerModel( controller ) {\n\n\t\tconst controllerModel = new XRControllerModel();\n\t\tlet scene = null;\n\n\t\tcontroller.addEventListener( 'connected', ( event ) => {\n\n\t\t\tconst xrInputSource = event.data;\n\n\t\t\tif ( xrInputSource.targetRayMode !== 'tracked-pointer' || ! xrInputSource.gamepad ) return;\n\n\t\t\tfetchProfile( xrInputSource, this.path, DEFAULT_PROFILE ).then( ( { profile, assetPath } ) => {\n\n\t\t\t\tcontrollerModel.motionController = new MotionController(\n\t\t\t\t\txrInputSource,\n\t\t\t\t\tprofile,\n\t\t\t\t\tassetPath\n\t\t\t\t);\n\n\t\t\t\tconst cachedAsset = this._assetCache[ controllerModel.motionController.assetUrl ];\n\t\t\t\tif ( cachedAsset ) {\n\n\t\t\t\t\tscene = cachedAsset.scene.clone();\n\n\t\t\t\t\taddAssetSceneToControllerModel( controllerModel, scene );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tif ( ! this.gltfLoader ) {\n\n\t\t\t\t\t\tthrow new Error( 'GLTFLoader not set.' );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.gltfLoader.setPath( '' );\n\t\t\t\t\tthis.gltfLoader.load( controllerModel.motionController.assetUrl, ( asset ) => {\n\n\t\t\t\t\t\tthis._assetCache[ controllerModel.motionController.assetUrl ] = asset;\n\n\t\t\t\t\t\tscene = asset.scene.clone();\n\n\t\t\t\t\t\taddAssetSceneToControllerModel( controllerModel, scene );\n\n\t\t\t\t\t},\n\t\t\t\t\tnull,\n\t\t\t\t\t() => {\n\n\t\t\t\t\t\tthrow new Error( `Asset ${controllerModel.motionController.assetUrl} missing or malformed.` );\n\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t} ).catch( ( err ) => {\n\n\t\t\t\tconsole.warn( err );\n\n\t\t\t} );\n\n\t\t} );\n\n\t\tcontroller.addEventListener( 'disconnected', () => {\n\n\t\t\tcontrollerModel.motionController = null;\n\t\t\tcontrollerModel.remove( scene );\n\t\t\tscene = null;\n\n\t\t} );\n\n\t\treturn controllerModel;\n\n\t}\n\n}\n\nexport { XRControllerModelFactory };\n","import {\n\tDynamicDrawUsage,\n\tSphereGeometry,\n\tBoxGeometry,\n\tMeshStandardMaterial,\n\tInstancedMesh,\n\tMatrix4,\n\tVector3\n} from 'three';\n\nconst _matrix = new Matrix4();\nconst _vector = new Vector3();\n\nclass XRHandPrimitiveModel {\n\n\tconstructor( handModel, controller, path, handedness, options ) {\n\n\t\tthis.controller = controller;\n\t\tthis.handModel = handModel;\n\t\tthis.envMap = null;\n\n\t\tlet geometry;\n\n\t\tif ( ! options || ! options.primitive || options.primitive === 'sphere' ) {\n\n\t\t\tgeometry = new SphereGeometry( 1, 10, 10 );\n\n\t\t} else if ( options.primitive === 'box' ) {\n\n\t\t\tgeometry = new BoxGeometry( 1, 1, 1 );\n\n\t\t}\n\n\t\tconst material = new MeshStandardMaterial();\n\n\t\tthis.handMesh = new InstancedMesh( geometry, material, 30 );\n\t\tthis.handMesh.instanceMatrix.setUsage( DynamicDrawUsage ); // will be updated every frame\n\t\tthis.handMesh.castShadow = true;\n\t\tthis.handMesh.receiveShadow = true;\n\t\tthis.handModel.add( this.handMesh );\n\n\t\tthis.joints = [\n\t\t\t'wrist',\n\t\t\t'thumb-metacarpal',\n\t\t\t'thumb-phalanx-proximal',\n\t\t\t'thumb-phalanx-distal',\n\t\t\t'thumb-tip',\n\t\t\t'index-finger-metacarpal',\n\t\t\t'index-finger-phalanx-proximal',\n\t\t\t'index-finger-phalanx-intermediate',\n\t\t\t'index-finger-phalanx-distal',\n\t\t\t'index-finger-tip',\n\t\t\t'middle-finger-metacarpal',\n\t\t\t'middle-finger-phalanx-proximal',\n\t\t\t'middle-finger-phalanx-intermediate',\n\t\t\t'middle-finger-phalanx-distal',\n\t\t\t'middle-finger-tip',\n\t\t\t'ring-finger-metacarpal',\n\t\t\t'ring-finger-phalanx-proximal',\n\t\t\t'ring-finger-phalanx-intermediate',\n\t\t\t'ring-finger-phalanx-distal',\n\t\t\t'ring-finger-tip',\n\t\t\t'pinky-finger-metacarpal',\n\t\t\t'pinky-finger-phalanx-proximal',\n\t\t\t'pinky-finger-phalanx-intermediate',\n\t\t\t'pinky-finger-phalanx-distal',\n\t\t\t'pinky-finger-tip'\n\t\t];\n\n\t}\n\n\tupdateMesh() {\n\n\t\tconst defaultRadius = 0.008;\n\t\tconst joints = this.controller.joints;\n\n\t\tlet count = 0;\n\n\t\tfor ( let i = 0; i < this.joints.length; i ++ ) {\n\n\t\t\tconst joint = joints[ this.joints[ i ] ];\n\n\t\t\tif ( joint.visible ) {\n\n\t\t\t\t_vector.setScalar( joint.jointRadius || defaultRadius );\n\t\t\t\t_matrix.compose( joint.position, joint.quaternion, _vector );\n\t\t\t\tthis.handMesh.setMatrixAt( i, _matrix );\n\n\t\t\t\tcount ++;\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.handMesh.count = count;\n\t\tthis.handMesh.instanceMatrix.needsUpdate = true;\n\n\t}\n\n}\n\nexport { XRHandPrimitiveModel };\n","import { GLTFLoader } from '../loaders/GLTFLoader.js';\n\nconst DEFAULT_HAND_PROFILE_PATH = 'https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/';\n\nclass XRHandMeshModel {\n\n\tconstructor( handModel, controller, path, handedness ) {\n\n\t\tthis.controller = controller;\n\t\tthis.handModel = handModel;\n\n\t\tthis.bones = [];\n\n\t\tconst loader = new GLTFLoader();\n\t\tloader.setPath( path || DEFAULT_HAND_PROFILE_PATH );\n\t\tloader.load( `${handedness}.glb`, gltf => {\n\n\t\t\tconst object = gltf.scene.children[ 0 ];\n\t\t\tthis.handModel.add( object );\n\n\t\t\tconst mesh = object.getObjectByProperty( 'type', 'SkinnedMesh' );\n\t\t\tmesh.frustumCulled = false;\n\t\t\tmesh.castShadow = true;\n\t\t\tmesh.receiveShadow = true;\n\n\t\t\tconst joints = [\n\t\t\t\t'wrist',\n\t\t\t\t'thumb-metacarpal',\n\t\t\t\t'thumb-phalanx-proximal',\n\t\t\t\t'thumb-phalanx-distal',\n\t\t\t\t'thumb-tip',\n\t\t\t\t'index-finger-metacarpal',\n\t\t\t\t'index-finger-phalanx-proximal',\n\t\t\t\t'index-finger-phalanx-intermediate',\n\t\t\t\t'index-finger-phalanx-distal',\n\t\t\t\t'index-finger-tip',\n\t\t\t\t'middle-finger-metacarpal',\n\t\t\t\t'middle-finger-phalanx-proximal',\n\t\t\t\t'middle-finger-phalanx-intermediate',\n\t\t\t\t'middle-finger-phalanx-distal',\n\t\t\t\t'middle-finger-tip',\n\t\t\t\t'ring-finger-metacarpal',\n\t\t\t\t'ring-finger-phalanx-proximal',\n\t\t\t\t'ring-finger-phalanx-intermediate',\n\t\t\t\t'ring-finger-phalanx-distal',\n\t\t\t\t'ring-finger-tip',\n\t\t\t\t'pinky-finger-metacarpal',\n\t\t\t\t'pinky-finger-phalanx-proximal',\n\t\t\t\t'pinky-finger-phalanx-intermediate',\n\t\t\t\t'pinky-finger-phalanx-distal',\n\t\t\t\t'pinky-finger-tip',\n\t\t\t];\n\n\t\t\tjoints.forEach( jointName => {\n\n\t\t\t\tconst bone = object.getObjectByName( jointName );\n\n\t\t\t\tif ( bone !== undefined ) {\n\n\t\t\t\t\tbone.jointName = jointName;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( `Couldn't find ${jointName} in ${handedness} hand mesh` );\n\n\t\t\t\t}\n\n\t\t\t\tthis.bones.push( bone );\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n\tupdateMesh() {\n\n\t\t// XR Joints\n\t\tconst XRJoints = this.controller.joints;\n\n\t\tfor ( let i = 0; i < this.bones.length; i ++ ) {\n\n\t\t\tconst bone = this.bones[ i ];\n\n\t\t\tif ( bone ) {\n\n\t\t\t\tconst XRJoint = XRJoints[ bone.jointName ];\n\n\t\t\t\tif ( XRJoint.visible ) {\n\n\t\t\t\t\tconst position = XRJoint.position;\n\n\t\t\t\t\tif ( bone ) {\n\n\t\t\t\t\t\tbone.position.copy( position );\n\t\t\t\t\t\tbone.quaternion.copy( XRJoint.quaternion );\n\t\t\t\t\t\t// bone.scale.setScalar( XRJoint.jointRadius || defaultRadius );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n}\n\nexport { XRHandMeshModel };\n","import {\n\tObject3D\n} from 'three';\n\nimport {\n\tXRHandPrimitiveModel\n} from './XRHandPrimitiveModel.js';\n\nimport {\n\tXRHandMeshModel\n} from './XRHandMeshModel.js';\n\nclass XRHandModel extends Object3D {\n\n\tconstructor( controller ) {\n\n\t\tsuper();\n\n\t\tthis.controller = controller;\n\t\tthis.motionController = null;\n\t\tthis.envMap = null;\n\n\t\tthis.mesh = null;\n\n\t}\n\n\tupdateMatrixWorld( force ) {\n\n\t\tsuper.updateMatrixWorld( force );\n\n\t\tif ( this.motionController ) {\n\n\t\t\tthis.motionController.updateMesh();\n\n\t\t}\n\n\t}\n\n}\n\nclass XRHandModelFactory {\n\n\tconstructor() {\n\n\t\tthis.path = null;\n\n\t}\n\n\tsetPath( path ) {\n\n\t\tthis.path = path;\n\n\t\treturn this;\n\n\t}\n\n\tcreateHandModel( controller, profile ) {\n\n\t\tconst handModel = new XRHandModel( controller );\n\n\t\tcontroller.addEventListener( 'connected', ( event ) => {\n\n\t\t\tconst xrInputSource = event.data;\n\n\t\t\tif ( xrInputSource.hand && ! handModel.motionController ) {\n\n\t\t\t\thandModel.xrInputSource = xrInputSource;\n\n\t\t\t\t// @todo Detect profile if not provided\n\t\t\t\tif ( profile === undefined || profile === 'spheres' ) {\n\n\t\t\t\t\thandModel.motionController = new XRHandPrimitiveModel( handModel, controller, this.path, xrInputSource.handedness, { primitive: 'sphere' } );\n\n\t\t\t\t} else if ( profile === 'boxes' ) {\n\n\t\t\t\t\thandModel.motionController = new XRHandPrimitiveModel( handModel, controller, this.path, xrInputSource.handedness, { primitive: 'box' } );\n\n\t\t\t\t} else if ( profile === 'mesh' ) {\n\n\t\t\t\t\thandModel.motionController = new XRHandMeshModel( handModel, controller, this.path, xrInputSource.handedness );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} );\n\n\t\tcontroller.addEventListener( 'disconnected', () => {\n\n\t\t\t// handModel.motionController = null;\n\t\t\t// handModel.remove( scene );\n\t\t\t// scene = null;\n\n\t\t} );\n\n\t\treturn handModel;\n\n\t}\n\n}\n\nexport { XRHandModelFactory };\n","import {\n    renderer, rafCallbacks\n} from '../scene.js';\n\nconst prevGamePads = new Map();\nconst gamepad = new EventTarget();\n\nfunction dispatchEvent(type, detail) {\n    const specificEvent = new CustomEvent(type, {detail});\n\n    const generalDetail = {type};\n    Object.assign(generalDetail, detail);\n    const generalEvent = new CustomEvent('gamepadInteraction', {detail: generalDetail});\n\n    gamepad.dispatchEvent(specificEvent);\n    gamepad.dispatchEvent(generalEvent);\n}\n\nrafCallbacks.add(() => {\n    const session = renderer.xr.getSession();\n    let i = 0;\n    if (session) for (const source of session.inputSources) {\n        if (!source.gamepad) continue;\n        const controller = renderer.xr.getController(i++);\n        const old = prevGamePads.get(source);\n        const data = {\n            buttons: source.gamepad.buttons.map(b => b.value),\n            axes: source.gamepad.axes.slice(0)\n        };\n        if (old) {\n            data.buttons.forEach((value,i)=>{\n                if (value !== old.buttons[i]) {\n                    if (value === 1) {\n                        dispatchEvent(`button${i}Down`, {value, source, controller,data});\n                    } else {\n                        dispatchEvent(`button${i}Up`, {value, source, controller,data});\n                    }\n                }\n            });\n            data.axes.forEach((value,i)=>{\n                if (value !== old.axes[i]) {\n                    dispatchEvent(`axes${i}Move`, {value, source, controller,data});\n                    if (old.axes[i] === 0) {\n                        dispatchEvent(`axes${i}MoveStart`, {value, source, controller,data});\n                    }\n                    if (Math.abs(old.axes[i]) < 0.5 && Math.abs(value) > 0.5) {\n                        dispatchEvent(`axes${i}MoveMiddle`, {value, source, controller,data});\n                    }\n                    if (value === 0) {\n                        dispatchEvent(`axes${i}MoveEnd`, {value, source, controller,data});\n                    }\n                }\n            });\n        }\n        prevGamePads.set(source, data);\n    }\n});\n\nexport {\n    gamepad\n}","import {\n    cameraGroup, camera\n} from '../../scene.js';\nimport {\n    Mesh,\n    MeshBasicMaterial,\n    SphereBufferGeometry,\n    BackSide\n} from 'three';\n\nimport TWEEN from '@tweenjs/tween.js/dist/tween.esm.js';\n\nfunction locomotion(offset) {\n\n    blinkerSphere.visible = true;\n    blinkerSphere.material.opacity = 0;\n    new TWEEN.Tween(blinkerSphere.material)\n        .to({opacity: 1}, 200)\n        .easing(TWEEN.Easing.Quadratic.Out)\n        .onComplete(function () {\n\n            // Do the teleport\n            cameraGroup.position.add(offset);\n\n            // Fade back\n            new TWEEN.Tween(blinkerSphere.material)\n            .to({opacity: 0}, 200)\n            .onComplete(() => blinkerSphere.visible = false)\n            .start();\n        })\n        .start();\n}\n\nconst blinkerSphereGeometry = new SphereBufferGeometry(0.3, 16, 16);\nblinkerSphereGeometry.translate(0,0.3,0);\nconst blinkerSphereMaterial = new MeshBasicMaterial({\n    side: BackSide,\n    color: 0x000000,\n    transparent: true\n});\nconst blinkerSphere = new Mesh( blinkerSphereGeometry, blinkerSphereMaterial );\nblinkerSphere.rotation.set(Math.PI/2, 0, 0);\nblinkerSphere.position.set(0, 0, -0.3);\nblinkerSphere.visible = false;\ncamera.add(blinkerSphere);\nblinkerSphereMaterial.renderOrder = -101;\n\nexport {\n    locomotion\n}","import {\n    scene, renderer, rafCallbacks, cameraGroup, camera\n} from '../scene.js';\nimport { XRControllerModelFactory } from 'three/examples/jsm/webxr/XRControllerModelFactory.js'; \nimport { XRHandModelFactory } from 'three/examples/jsm/webxr/XRHandModelFactory.js'; \nimport {\n    Mesh,\n    MeshBasicMaterial,\n    Vector3,\n    PointLight,\n    PlaneGeometry,\n    TextureLoader,\n    BufferGeometry,\n    BufferAttribute,\n    LineBasicMaterial,\n    AdditiveBlending,\n    Line\n} from  'three';\nimport {\n    gamepad\n} from './gamepad.js';\n\nimport {\n    locomotion\n} from './locomotion/fade.js';\n\nfunction positionAtT(inVec,t,p,v,g) {\n    inVec.copy(p);\n    inVec.addScaledVector(v,t);\n    inVec.addScaledVector(g,0.5*t**2);\n    return inVec;\n}\n\n// Utility Vectors\nconst g = new Vector3(0,-9.8,0);\nconst tempVec = new Vector3();\nconst tempVec1 = new Vector3();\nconst tempVecP = new Vector3();\nconst tempVecV = new Vector3();\n\n// The guideline\nconst lineSegments=10;\nconst lineGeometry = new BufferGeometry();\nconst lineGeometryVertices = new Float32Array((lineSegments +1) * 3);\nlineGeometryVertices.fill(0);\nconst lineGeometryColors = new Float32Array((lineSegments +1) * 3);\nlineGeometryColors.fill(0.5);\nlineGeometry.setAttribute('position', new BufferAttribute(lineGeometryVertices, 3));\nlineGeometry.setAttribute('color', new BufferAttribute(lineGeometryColors, 3));\nconst lineMaterial = new LineBasicMaterial({ vertexColors: true, blending: AdditiveBlending });\nconst guideline = new Line( lineGeometry, lineMaterial );\n\n// The light at the end of the line\nconst guideLight = new PointLight(0xffeeaa, 0, 2);\n\n// The target on the ground\nconst guideSpriteTexture = new TextureLoader().load('./assets/target.png');\nconst guideSprite = new Mesh(\n    new PlaneGeometry(0.3, 0.3, 1, 1),\n    new MeshBasicMaterial({\n        map: guideSpriteTexture,\n        blending: AdditiveBlending,\n        color: 0x555555,\n        transparent: true\n    })\n);\nguideSprite.rotation.x = -Math.PI/2;\n\nlet guidingController = null;\nfunction onSelectStart() {\n    guidingController = this;\n    guideLight.intensity = 1;\n    this.add(guideline);\n    scene.add(guideSprite);\n}\n\nfunction onSelectEnd() {\n    if (guidingController === this) {\n\n        // first work out vector from feet to cursor\n\n        // feet position\n        const feetPos = renderer.xr.getCamera(camera).getWorldPosition(tempVec);\n        feetPos.y = 0;\n\n        // cursor position\n        const p = guidingController.getWorldPosition(tempVecP);\n        const v = guidingController.getWorldDirection(tempVecV);\n        v.multiplyScalar(6);\n        const t = (-v.y  + Math.sqrt(v.y**2 - 2*p.y*g.y))/g.y;\n        const cursorPos = positionAtT(tempVec1,t,p,v,g);\n\n        // Offset\n        const offset = cursorPos.addScaledVector(feetPos ,-1);\n\n        // Do the locomotion\n        locomotion(offset);\n\n        // clean up\n        guidingController = null;\n        guideLight.intensity = 0;\n        this.remove(guideline);\n        scene.remove(guideSprite);\n    }\n}\n\nconst controller1 = renderer.xr.getController(0);\ncontroller1.addEventListener('selectstart', onSelectStart);\ncontroller1.addEventListener('selectend', onSelectEnd);\ncameraGroup.add(controller1);\n\nconst controller2 = renderer.xr.getController(1);\ncontroller2.addEventListener('selectstart', onSelectStart);\ncontroller2.addEventListener('selectend', onSelectEnd);\ncameraGroup.add(controller2);\n\nconst controllerModelFactory = new XRControllerModelFactory();\nconst handModelFactory = new XRHandModelFactory();\n\nconst controllerGrip1 = renderer.xr.getControllerGrip(0);\nconst model1 = controllerModelFactory.createControllerModel( controllerGrip1 );\ncontrollerGrip1.add( model1 );\ncameraGroup.add( controllerGrip1 );\n\nconst controllerGrip2 = renderer.xr.getControllerGrip( 1 );\nconst model2 = controllerModelFactory.createControllerModel( controllerGrip2 );\ncontrollerGrip2.add( model2 );\ncameraGroup.add( controllerGrip2 );\n\nconst hand1 = renderer.xr.getHand( 0 );\nscene.add( hand1 );\nhand1.add( handModelFactory.createHandModel( hand1, \"mesh\" ) );\n\nconst hand2 = renderer.xr.getHand( 1 );\nscene.add( hand2 );\nhand2.add( handModelFactory.createHandModel( hand2, \"mesh\" ) );\n\nrafCallbacks.add(() => {\n    if (guidingController) {\n        // Controller start position\n        const p = guidingController.getWorldPosition(tempVecP);\n\n        // Set Vector V to the direction of the controller, at 1m/s\n        const v = guidingController.getWorldDirection(tempVecV);\n\n        // Scale the initial velocity to 6m/s\n        v.multiplyScalar(6);\n\n        // Time for tele ball to hit ground\n        const t = (-v.y  + Math.sqrt(v.y**2 - 2*p.y*g.y))/g.y;\n\n        const vertex = tempVec.set(0,0,0);\n        for (let i=1; i<=lineSegments; i++) {\n\n            // set vertex to current position of the virtual ball at time t\n            positionAtT(vertex,i*t/lineSegments,p,v,g);\n            guidingController.worldToLocal(vertex);\n            vertex.toArray(lineGeometryVertices,i*3);\n        }\n        guideline.geometry.attributes.position.needsUpdate = true;\n        \n        // Place the light and sprite near the end of the line\n        positionAtT(guideLight.position,t*0.98,p,v,g);\n        positionAtT(guideSprite.position,t*0.98,p,v,g);\n    }\n});\n\nfunction handleMove({detail}) {\n    // Turn left\n    if (detail.value > 0) {\n        cameraGroup.rotation.y -= Math.PI/4;\n    }\n    // Turn right\n    if (detail.value < 0) {\n        cameraGroup.rotation.y += Math.PI/4;\n    }\n}\ngamepad.addEventListener('axes0MoveMiddle', handleMove, true);\ngamepad.addEventListener('axes2MoveMiddle', handleMove, true);\n\nfunction handleUp({detail}) {\n    if (detail.value < 0) {\n        onSelectStart.bind(detail.controller)();\n    }\n}\nfunction handleUpEnd({detail}) {\n    onSelectEnd.bind(detail.controller)();\n}\ngamepad.addEventListener('axes1MoveMiddle', handleUp, true);\ngamepad.addEventListener('axes3MoveMiddle', handleUp, true);\ngamepad.addEventListener('axes1MoveEnd', handleUpEnd, true);\ngamepad.addEventListener('axes3MoveEnd', handleUpEnd, true);\n\nexport {\n    controller1,\n    controller2,\n    controllerGrip1,\n    controllerGrip2\n};","import {\n    renderer,\n    scene,\n    camera\n} from './lib/scene.js';\n\nimport {\n    controller1\n} from './lib/controllers/controllers.js';\n\nimport {\n    gamepad\n} from './lib/controllers/gamepad.js';\n\nimport {\n    Mesh,\n    MeshBasicMaterial,\n    PlaneGeometry,\n    TextureLoader,\n    AdditiveBlending,\n    CanvasTexture,\n    DoubleSide\n} from  'three';\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\n\nconst loader = new GLTFLoader();\n\n// Red target on the floor\nconst targetTexture = new TextureLoader().load('./assets/target.png');\nconst target = new Mesh(\n    new PlaneGeometry(0.5, 0.5, 1, 1),\n    new MeshBasicMaterial({\n        map: targetTexture,\n        blending: AdditiveBlending,\n        color: 0x660000,\n        transparent: true\n    })\n);\ntarget.position.z = -5;\ntarget.position.y = 0.01;\ntarget.rotation.x = -Math.PI/2;\nscene.add(target);\n\n// Debugging \n\nconst canvas = document.createElement('canvas');\nconst canvasTexture = new CanvasTexture(canvas);\ncanvas.width = 1024;\ncanvas.height = 256;\nconst ctx = canvas.getContext('2d');\nfunction writeText(text) {\n    if (typeof text !== 'string') {\n        text = JSON.stringify(text,null,2);\n    }\n    ctx.font = \"120px fantasy\";\n    ctx.fillStyle = 'black';\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n    ctx.fillStyle = 'white';\n    text.split('\\n').forEach((str, i) => ctx.fillText(str, 0, (i+1)*120));\n    canvasTexture.needsUpdate = true;\n}\n\nconst geometry = new PlaneGeometry( 0.3 * canvas.width/1024, 0.3 * canvas.height/1024 );\nconst material = new MeshBasicMaterial( {map: canvasTexture, blending: AdditiveBlending, transparent: true} );\nconst consolePlane = new Mesh( geometry, material );\nconsolePlane.renderOrder = 1;\nconsolePlane.position.set(0, 0.5 * 0.3 * canvas.height/1024, -0.1);\nconsolePlane.rotation.set(-Math.PI/4,0,0);\ncontroller1.add( consolePlane );\nwriteText('hi');\n\ngamepad.addEventListener('gamepadInteraction', function (event) {\n    writeText(`${event.detail.type} ${event.detail.value}`);\n});\n\n(async function () {\n\n    // Forest from Google Poly, https://poly.google.com/view/2_fv3tn3NG_\n    const {scene: gltfScene} = await new Promise(resolve => loader.load('./assets/forest.glb', resolve));\n    const trees = gltfScene.children[0];\n    trees.position.z = -5;\n    trees.position.y = 2.5;\n    trees.scale.multiplyScalar(10);\n    trees.traverse(o => {\n        if (o.material) {\n            o.material.side = DoubleSide;\n            o.material.depthWrite = true;\n        }\n    });\n    scene.add(trees);\n}());\n\nwindow.renderer = renderer;\nwindow.camera = camera;"],"names":["_changeEvent","type","_startEvent","_endEvent","a","Easing","Linear","None","amount","Quadratic","In","Out","InOut","Cubic","Quartic","Quintic","Sinusoidal","Math","cos","PI","sin","Exponential","pow","Circular","sqrt","Elastic","Back","s","Bounce","now$1","self","process","hrtime","time","undefined","performance","now","bind","Date","getTime","Group","this","_tweens","_tweensAddedDuringUpdate","prototype","getAll","_this","Object","keys","map","tweenId","removeAll","add","tween","getId","remove","update","preserve","tweenIds","length","i","autoStart","Interpolation","v","k","m","f","floor","fn","Utils","Bezier","b","n","pw","bn","Bernstein","CatmullRom","p0","p1","t","fc","Factorial","p2","p3","v0","v1","t2","Sequence","nextId","_nextId","mainGroup","Tween","_object","_group","_isPaused","_pauseStart","_valuesStart","_valuesEnd","_valuesStartRepeat","_duration","_initialRepeat","_repeat","_yoyo","_isPlaying","_reversed","_delayTime","_startTime","_easingFunction","_interpolationFunction","_chainedTweens","_onStartCallbackFired","_id","_isChainStopped","_goToEnd","isPlaying","isPaused","to","properties","duration","create","d","start","property","_swapEndStartRepeatValues","parseFloat","_setupProperties","startValue","startValueIsArray","Array","isArray","propType","isInterpolationList","endValues","_handleRelativeValue","concat","slice","reverse","prop","stop","stopChainedTweens","_onStopCallback","end","Infinity","pause","resume","numChainedTweens","group","delay","repeat","times","repeatDelay","_repeatDelayTime","yoyo","easing","easingFunction","interpolation","interpolationFunction","chain","tweens","_i","arguments","onStart","callback","_onStartCallback","onUpdate","_onUpdateCallback","onRepeat","_onRepeatCallback","onComplete","_onCompleteCallback","onStop","elapsed","endTime","value","_updateProperties","isFinite","startIsArray","endIsArray","charAt","tmp","endValue","TWEEN","exports","VERSION","cameraGroup","renderer","WebGLRenderer","canvas","document","querySelector","antialias","xr","enabled","logarithmicDepthBuffer","setPixelRatio","window","devicePixelRatio","scene","Scene","name","camera","PerspectiveCamera","far","controls","EventDispatcher","[object Object]","object","domElement","super","console","warn","error","target","Vector3","minDistance","maxDistance","minZoom","maxZoom","minPolarAngle","maxPolarAngle","minAzimuthAngle","maxAzimuthAngle","enableDamping","dampingFactor","enableZoom","zoomSpeed","enableRotate","rotateSpeed","enablePan","panSpeed","screenSpacePanning","keyPanSpeed","autoRotate","autoRotateSpeed","LEFT","UP","RIGHT","BOTTOM","mouseButtons","MOUSE","ROTATE","MIDDLE","DOLLY","PAN","touches","ONE","TOUCH","TWO","DOLLY_PAN","target0","clone","position0","position","zoom0","zoom","_domElementKeyEvents","getPolarAngle","spherical","phi","getAzimuthalAngle","theta","listenToKeyEvents","addEventListener","onKeyDown","saveState","scope","copy","reset","updateProjectionMatrix","dispatchEvent","state","STATE","NONE","offset","quat","Quaternion","setFromUnitVectors","up","quatInverse","invert","lastPosition","lastQuaternion","twoPI","sub","applyQuaternion","setFromVector3","rotateLeft","sphericalDelta","min","max","makeSafe","radius","scale","addScaledVector","panOffset","setFromSpherical","lookAt","multiplyScalar","set","zoomChanged","distanceToSquared","EPS","dot","quaternion","dispose","removeEventListener","onContextMenu","onPointerDown","onMouseWheel","onTouchStart","onTouchEnd","onTouchMove","ownerDocument","onPointerMove","onPointerUp","TOUCH_ROTATE","TOUCH_PAN","TOUCH_DOLLY_PAN","TOUCH_DOLLY_ROTATE","Spherical","rotateStart","Vector2","rotateEnd","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","getZoomScale","angle","rotateUp","panLeft","distance","objectMatrix","setFromMatrixColumn","panUp","crossVectors","pan","deltaX","deltaY","element","isPerspectiveCamera","targetDistance","tan","fov","clientHeight","matrix","isOrthographicCamera","right","left","clientWidth","top","bottom","dollyOut","dollyScale","dollyIn","handleMouseDownRotate","event","clientX","clientY","handleMouseDownPan","handleTouchStartRotate","pageX","pageY","x","y","handleTouchStartPan","handleTouchStartDolly","dx","dy","handleTouchMoveRotate","subVectors","handleTouchMovePan","handleTouchMoveDolly","pointerType","mouseAction","preventDefault","focus","button","handleMouseDownDolly","ctrlKey","metaKey","shiftKey","onMouseDown","handleMouseMoveRotate","handleMouseMoveDolly","handleMouseMovePan","onMouseMove","onMouseUp","handleMouseWheel","needsUpdate","code","handleKeyDown","handleTouchStartDollyPan","DOLLY_ROTATE","handleTouchStartDollyRotate","handleTouchMoveDollyPan","handleTouchMoveDollyRotate","passive","onWindowResize","w","innerWidth","h","innerHeight","aspect","setSize","light","DirectionalLight","intensity","Mesh","SphereGeometry","sceneRadius","MeshBasicMaterial","color","light2","AmbientLight","skyGeometry","skyMaterial","side","BackSide","depthWrite","onBeforeCompile","shader","vertexShader","replace","fragmentShader","skySphere","floorTexture","TextureLoader","load","wrapS","wrapT","RepeatWrapping","PlaneGeometry","MeshLambertMaterial","rotation","body","appendChild","options","createElement","showWebXRNotFound","style","display","cursor","width","onmouseenter","onmouseleave","onclick","textContent","stylizeElement","padding","border","borderRadius","background","font","textAlign","opacity","outline","zIndex","navigator","id","isSessionSupported","then","supported","currentSession","async","onSessionStarted","session","onSessionEnded","setSession","sessionInit","optionalFeatures","requestSession","showEnterVR","message","isSecureContext","href","location","innerHTML","textDecoration","createButton","rafCallbacks","Set","setAnimationLoop","forEach","cb","render","GLTFLoader","Loader","manager","dracoLoader","ktx2Loader","meshoptDecoder","pluginCallbacks","register","parser","GLTFMaterialsClearcoatExtension","GLTFTextureBasisUExtension","GLTFTextureWebPExtension","GLTFMaterialsTransmissionExtension","GLTFLightsExtension","GLTFMeshoptCompression","url","onLoad","onProgress","onError","resourcePath","path","LoaderUtils","extractUrlBase","itemStart","_onError","e","itemError","itemEnd","loader","FileLoader","setPath","setResponseType","setRequestHeader","requestHeader","setWithCredentials","withCredentials","data","parse","gltf","Error","indexOf","push","splice","content","extensions","plugins","decodeText","Uint8Array","BINARY_EXTENSION_HEADER_MAGIC","EXTENSIONS","KHR_BINARY_GLTF","GLTFBinaryExtension","json","JSON","asset","version","GLTFParser","crossOrigin","fileLoader","plugin","extensionsUsed","extensionName","extensionsRequired","KHR_MATERIALS_UNLIT","GLTFMaterialsUnlitExtension","KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS","GLTFMaterialsPbrSpecularGlossinessExtension","KHR_DRACO_MESH_COMPRESSION","GLTFDracoMeshCompressionExtension","KHR_TEXTURE_TRANSFORM","GLTFTextureTransformExtension","KHR_MESH_QUANTIZATION","GLTFMeshQuantizationExtension","setExtensions","setPlugins","GLTFRegistry","objects","get","key","KHR_LIGHTS_PUNCTUAL","KHR_MATERIALS_CLEARCOAT","KHR_MATERIALS_TRANSMISSION","KHR_TEXTURE_BASISU","EXT_TEXTURE_WEBP","EXT_MESHOPT_COMPRESSION","cache","refs","uses","nodeDefs","nodes","nodeIndex","nodeLength","nodeDef","_addNodeRef","lightIndex","cacheKey","dependency","lightDef","lights","lightNode","Color","fromArray","range","PointLight","SpotLight","spot","innerConeAngle","outerConeAngle","penumbra","decay","createUniqueName","Promise","resolve","_loadLight","_getNodeRef","materialParams","materialDef","pending","metallicRoughness","pbrMetallicRoughness","baseColorFactor","array","baseColorTexture","assignTexture","all","materialIndex","materials","MeshPhysicalMaterial","extension","clearcoatFactor","clearcoat","clearcoatTexture","clearcoatRoughnessFactor","clearcoatRoughness","clearcoatRoughnessTexture","clearcoatNormalTexture","clearcoatNormalScale","transmissionFactor","transmission","transmissionTexture","textureIndex","textureDef","textures","source","images","loadTextureImage","isSupported","textureLoader","uri","handler","getHandler","detectSupport","loadTexture","image","Image","src","onload","onerror","height","index","bufferView","bufferViews","extensionDef","buffer","getDependency","decoder","ready","res","byteOffset","byteLength","count","stride","byteStride","result","ArrayBuffer","decodeGltfBuffer","mode","filter","BINARY_EXTENSION_CHUNK_TYPES","headerView","DataView","header","magic","getUint32","chunkContentsLength","chunkView","chunkIndex","chunkLength","chunkType","contentArray","preload","primitive","bufferViewIndex","gltfAttributeMap","attributes","threeAttributeMap","attributeNormalizedMap","attributeTypeMap","attributeName","threeAttributeName","ATTRIBUTES","toLowerCase","accessorDef","accessors","componentType","WEBGL_COMPONENT_TYPES","normalized","decodeDracoFile","geometry","attribute","texture","transform","texCoord","GLTFMeshStandardSGMaterial","MeshStandardMaterial","params","isGLTFSpecularGlossinessMaterial","specularMapParsFragmentChunk","join","glossinessMapParsFragmentChunk","specularMapFragmentChunk","glossinessMapFragmentChunk","lightPhysicalFragmentChunk","uniforms","specular","setHex","glossiness","specularMap","glossinessMap","_extraUniforms","uniformName","defineProperties","defines","USE_SPECULARMAP","USE_GLOSSINESSMAP","USE_UV","metalness","roughness","metalnessMap","roughnessMap","setValues","specularGlossinessParams","pbrSpecularGlossiness","diffuseFactor","diffuseTexture","emissive","glossinessFactor","specularFactor","specularGlossinessTexture","specGlossMapDef","material","fog","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","TangentSpaceNormalMap","normalScale","displacementMap","displacementScale","displacementBias","alphaMap","envMap","envMapIntensity","refractionRatio","GLTFCubicSplineInterpolant","Interpolant","parameterPositions","sampleValues","sampleSize","resultBuffer","values","valueSize","beforeStart_","copySampleValue_","afterEnd_","interpolate_","i1","t0","t1","stride2","stride3","td","p","pp","ppp","offset1","offset0","s2","s3","s0","s1","m0","m1","WEBGL_CONSTANTS","5120","Int8Array","5121","5122","Int16Array","5123","Uint16Array","5125","Uint32Array","5126","Float32Array","WEBGL_FILTERS","9728","NearestFilter","9729","LinearFilter","9984","NearestMipmapNearestFilter","9985","LinearMipmapNearestFilter","9986","NearestMipmapLinearFilter","9987","LinearMipmapLinearFilter","WEBGL_WRAPPINGS","33071","ClampToEdgeWrapping","33648","MirroredRepeatWrapping","10497","WEBGL_TYPE_SIZES","SCALAR","VEC2","VEC3","VEC4","MAT2","MAT3","MAT4","POSITION","NORMAL","TANGENT","TEXCOORD_0","TEXCOORD_1","COLOR_0","WEIGHTS_0","JOINTS_0","PATH_PROPERTIES","translation","weights","INTERPOLATION","CUBICSPLINE","LINEAR","InterpolateLinear","STEP","InterpolateDiscrete","ALPHA_MODES","resolveURL","test","addUnknownExtensionsToUserData","knownExtensions","objectDef","userData","gltfExtensions","assignExtrasToUserData","gltfDef","extras","assign","updateMorphTargets","mesh","meshDef","il","morphTargetInfluences","targetNames","morphTargetDictionary","createPrimitiveKey","primitiveDef","dracoExtension","geometryKey","indices","createAttributesKey","attributesKey","sort","getNormalizedComponentScale","constructor","associations","Map","primitiveCache","meshCache","cameraCache","lightCache","textureCache","nodeNamesUsed","createImageBitmap","userAgent","ImageBitmapLoader","setCrossOrigin","_invokeAll","ext","_markDefs","beforeRoot","getDependencies","dependencies","scenes","animations","cameras","afterRoot","catch","skinDefs","skins","meshDefs","meshes","skinIndex","skinLength","joints","isBone","skin","isSkinnedMesh","ref","func","unshift","loadScene","loadNode","_invokeOne","loadMesh","loadAccessor","loadBufferView","loadBuffer","loadMaterial","loadSkin","loadAnimation","loadCamera","defs","def","bufferIndex","bufferDef","buffers","reject","bufferViewDef","accessorIndex","sparse","pendingBufferViews","itemSize","TypedArray","elementBytes","BYTES_PER_ELEMENT","itemBytes","bufferAttribute","ibSlice","ibCacheKey","ib","InterleavedBuffer","InterleavedBufferAttribute","BufferAttribute","itemSizeIndices","TypedArrayIndices","byteOffsetIndices","byteOffsetValues","sparseIndices","sparseValues","setX","setY","setZ","setW","sampler","URL","webkitURL","sourceURI","isObjectURL","hasAlpha","isJPEG","search","mimeType","colorType","getUint8","blob","Blob","createObjectURL","promise","isImageBitmapLoader","imageBitmap","CanvasTexture","revokeObjectURL","flipY","format","RGBFormat","samplers","magFilter","minFilter","mapName","mapDef","gltfReference","extendTexture","useVertexTangents","tangent","useVertexColors","useFlatShading","normal","useMorphTargets","morphAttributes","useMorphNormals","isPoints","uuid","pointsMaterial","PointsMaterial","Material","call","sizeAttenuation","isLine","lineMaterial","LineBasicMaterial","cachedMaterial","vertexColors","flatShading","morphTargets","morphNormals","vertexTangents","uv2","uv","setAttribute","materialType","materialExtensions","sgExtension","getMaterialType","extendParams","kmuExtension","metallicFactor","roughnessFactor","metallicRoughnessTexture","extendMaterialParams","doubleSided","DoubleSide","alphaMode","transparent","alphaTest","alphaCutoff","normalTexture","occlusionTexture","strength","emissiveFactor","emissiveTexture","createMaterial","encoding","sRGBEncoding","originalName","sanitizedName","PropertyBinding","sanitizeNodeName","primitives","createDracoPrimitive","decodePrimitive","addPrimitiveAttributes","cached","geometryPromise","BufferGeometry","meshIndex","depthTest","FrontSide","loadGeometries","results","geometries","SkinnedMesh","skinWeight","normalizeSkinWeights","toTrianglesDrawMode","TriangleStripDrawMode","TriangleFanDrawMode","LineSegments","Line","LineLoop","Points","assignFinalMaterial","cameraIndex","cameraDef","MathUtils.radToDeg","yfov","aspectRatio","znear","zfar","OrthographicCamera","xmag","ymag","skinDef","skinEntry","inverseBindMatrices","accessor","animationIndex","animationDef","pendingNodes","pendingInputAccessors","pendingOutputAccessors","pendingSamplers","pendingTargets","channels","channel","node","input","parameters","output","inputAccessors","outputAccessors","targets","tracks","inputAccessor","outputAccessor","TypedKeyframeTrack","updateMatrix","matrixAutoUpdate","NumberKeyframeTrack","QuaternionKeyframeTrack","VectorKeyframeTrack","targetName","traverse","isMesh","outputArray","scaled","j","jl","track","createInterpolant","getValueSize","isInterpolantFactoryMethodGLTFCubicSpline","AnimationClip","o","nodeName","meshPromise","createNodeMesh","createNodeAttachment","Bone","Object3D","Matrix4","applyMatrix4","sceneIndex","sceneDef","nodeIds","buildNodeHierachy","nodeId","parentObject","pendingJoints","jointNodes","bones","boneInverses","jointNode","mat","Skeleton","matrixWorld","children","child","assignAttributeAccessor","gltfAttributeName","setIndex","box","Box3","boxScale","maxDisplacement","vector","abs","expandByVector","boundingBox","sphere","Sphere","getCenter","center","distanceTo","boundingSphere","computeBounds","hasMorphPosition","hasMorphNormal","pendingPositionAccessors","pendingNormalAccessors","pendingAccessor","morphPositions","morphTargetsRelative","addMorphTargets","drawMode","getIndex","getAttribute","numberOfTriangles","newIndices","getX","newGeometry","Constants","Handedness","freeze","ComponentState","DEFAULT","TOUCHED","PRESSED","ComponentProperty","BUTTON","X_AXIS","Y_AXIS","ComponentType","TRIGGER","SQUEEZE","TOUCHPAD","THUMBSTICK","ButtonTouchThreshold","AxisTouchThreshold","VisualResponseProperty","TRANSFORM","VISIBILITY","fetchJsonFile","response","fetch","ok","statusText","fetchProfile","xrInputSource","basePath","defaultProfile","getAssetPath","supportedProfilesList","fetchProfilesList","match","profiles","some","profileId","supportedProfile","profilePath","deprecated","profile","assetPath","layout","handedness","layouts","defaultComponentValues","xAxis","yAxis","VisualResponse","visualResponseDescription","componentProperty","states","valueNodeName","valueNodeProperty","minNodeName","maxNodeName","updateFromComponent","normalizedXAxis","normalizedYAxis","atan2","normalizeAxes","includes","Component","componentId","componentDescription","visualResponses","gamepadIndices","rootNodeName","touchPointNodeName","responseName","visualResponse","gamepad","buttons","gamepadButton","pressed","touched","axes","MotionController","assetUrl","layoutDescription","components","updateFromGamepad","gripSpace","targetRaySpace","component","XRControllerModel","motionController","force","updateMatrixWorld","valueNode","minNode","maxNode","MotionControllerConstants","visible","slerpQuaternions","lerpVectors","addAssetSceneToControllerModel","controllerModel","touchPointNode","getObjectByName","sphereGeometry","findNodes","_matrix","_vector","XRHandPrimitiveModel","handModel","controller","BoxGeometry","handMesh","InstancedMesh","instanceMatrix","setUsage","DynamicDrawUsage","castShadow","receiveShadow","joint","setScalar","jointRadius","compose","setMatrixAt","XRHandMeshModel","getObjectByProperty","frustumCulled","jointName","bone","XRJoints","XRJoint","XRHandModel","updateMesh","prevGamePads","EventTarget","detail","specificEvent","CustomEvent","generalDetail","generalEvent","getSession","inputSources","getController","old","blinkerSphereGeometry","SphereBufferGeometry","translate","blinkerSphereMaterial","blinkerSphere","positionAtT","inVec","g","renderOrder","tempVec","tempVec1","tempVecP","tempVecV","lineGeometry","lineGeometryVertices","fill","lineGeometryColors","blending","AdditiveBlending","guideline","guideLight","guideSpriteTexture","guideSprite","guidingController","onSelectStart","onSelectEnd","feetPos","getCamera","getWorldPosition","getWorldDirection","locomotion","controller1","controller2","controllerModelFactory","gltfLoader","_assetCache","targetRayMode","cachedAsset","err","handModelFactory","hand","controllerGrip1","getControllerGrip","model1","createControllerModel","controllerGrip2","model2","hand1","getHand","createHandModel","hand2","handleMove","handleUp","handleUpEnd","vertex","worldToLocal","toArray","targetTexture","z","canvasTexture","ctx","getContext","writeText","text","stringify","fillStyle","fillRect","split","str","fillText","consolePlane","gltfScene","trees"],"mappings":"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"}