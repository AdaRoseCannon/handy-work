{"version":3,"file":"handpose-3f8d42f7.js","sources":["../src/lib/controllers/hand-poses/handpose.js","../src/lib/controllers/hand-poses/handpose.js?comlink"],"sourcesContent":["// this runs as a web worker\nimport {transfer} from 'comlink';\nimport normalize from './normalize.js';\n\nconsole.log('Worker started');\n\nconst poses = new Map();\n\nclass HandPose {\n\t#matches\n\tconstructor () {\n\t\tthis.#matches = [];\n\t}\n\tstatic async loadPose(name, path) {\n\t\tconst url = new URL(path, import.meta.url);\n\t\tconst buffer = await fetch(url).then(response => response.arrayBuffer());\n\t\tconst pose = new Float32Array(buffer);\n\t\tposes.set(name, pose);\n\t}\n\tupdate (headPose, handPose, handedness) {\n\n\t\tnormalize(handPose);\n\n\t\tconst distances = [];\n\t\tfor (const [name, poseData] of poses) {\n\t\t\tconst isRight = Number(handedness === \"right\");\n\t\t\tconst poseHandDataSize = poseData[0];\n\t\t\tconst poseHandData = new Float32Array(poseData.buffer, (\n\t\t\t\t1 + // poseHandDataSize offset\n\t\t\t\t(poseHandDataSize * 16) * isRight // offset for right hand\n\t\t\t)*4 , poseHandDataSize * 16);\n\t\t\tconst poseWeightData = new Float32Array(poseData.buffer, (\n\t\t\t\t1 + // poseHandDataSize offset\n\t\t\t\t(poseHandDataSize * 16) * 2 + // offset for after hand data\n\t\t\t\t(poseHandDataSize * isRight)      // offset for right hand\n\t\t\t)*4 , poseHandDataSize);\n\n\t\t\tconst range = Math.min(poseHandDataSize, handPose.length/16);\n\t\t\tlet dist = 0;\n\t\t\tfor (let i=0; i<range; i++) {\n\t\t\t\tconst o = i*16;\n\t\t\t\tdist += Math.pow(\n\t\t\t\t\t(poseHandData[o + 12] - handPose[o + 12]) ** 2 +\n\t\t\t\t\t(poseHandData[o + 13] - handPose[o + 13]) ** 2 +\n\t\t\t\t\t(poseHandData[o + 14] - handPose[o + 14]) ** 2\n\t\t\t\t, 0.5);\n\t\t\t}\n\n\t\t\tdistances.push([name, dist]);\n\t\t}\n\n\t\treturn transfer({\n\t\t\tusedHandArrayBuffer: handPose,\n\t\t\tdistances: distances.sort((a,b)=>a[1]-b[1])\n\t\t}, [handPose.buffer]);\n\t}\n\tgetMatchedPoses () {\n\t\treturn this.#matches;\n\t}\n}\n\nexport default HandPose;","\n\t\timport * as m from \"/home/ada/gitWorkingDir/handy-items/src/lib/controllers/hand-poses/handpose.js\";\n\t\timport {expose} from \"comlink\";\n\n\t\texpose(m);\n\t"],"names":[],"mappings":"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"}