import{w as e,n as t,t as s}from"./shared-0bba664c.js";export{n as normalize}from"./shared-0bba664c.js";const a=e(new Worker(new URL("handpose-fffa2717.js",import.meta.url),{type:"module"})).default;function o(e,n){return a.loadPose(e,n)}let i=!1;window.addEventListener("enter-vr",c),window.addEventListener("exit-vr",c);const r=new EventTarget;class d{#ready;constructor({session:e,source:n,handPose:t}){this.handPose=t,this.size=n.hand.size,this.jointKeys=Array.from(n.hand.keys()),this.hand=n.hand,this.jointMatrixArray=new Float32Array(16*n.hand.size),this.handedness=n.handedness,i||(e.onvisibilitychange=c,i=!0),this.#ready=!0}async update(e,n,t){if(!this.#ready)return[];this.#ready=!1,t.fillPoses(this.hand.values(),n,this.jointMatrixArray);const a=await this.handPose.update(e.transform.matrix,s(this.jointMatrixArray,[this.jointMatrixArray.buffer]),this.handedness);return this.jointMatrixArray=a.usedHandArrayBuffer,this.#ready=!0,a.distances}}const h=new Map;function c(){h.clear()}function f(){window.__dumpHands=!0}window.__dumpHands=!1;let l={};function u(e,n,s){for(const n of e)n.hand&&(l[n.handedness]=n.hand);if(l.left&&l.right){window.__dumpHands=!1;const e=l.left.size,a=new Float32Array(1+16*e+16*e+e+e);a[0]=e;const o=new Float32Array(a.buffer,4,16*e),i=new Float32Array(a.buffer,4+16*e*4,16*e);new Float32Array(a.buffer,4+16*e*4*2,2*e).fill(1),s.fillPoses(l.left.values(),n,o),s.fillPoses(l.right.values(),n,i),t(o),t(i),console.log(a);const r=window.document.createElement("a");r.href=window.URL.createObjectURL(new Blob([new Uint8Array(a.buffer)],{type:"application/octet-stream"})),r.download="untitled.handpose",document.body.appendChild(r),r.click(),document.body.removeChild(r),l={}}}function w(e,n,t){const s={handedness:n.handedness,distances:e},a=new CustomEvent("pose",{detail:s});r.dispatchEvent(a),t&&t(s)}function y(e,n,t,s){if(e&&t){const o=t.getViewerPose(n);__dumpHands&&u(e,n,t);for(const i of e){const e=i.handedness;if(i.hand)if(h.has(e)){const a=h.get(e);if(a instanceof Promise)continue;a.update(o,n,t).then((e=>{e.length&&w(e,a,s)})).catch((function(e){console.log(e)}))}else{const n=new a;h.set(e,n),n.then((n=>{const s=t.session,a=new d({session:s,source:i,handPose:n});h.set(e,a)}))}}}}export{f as dumpHands,u as handDataToFile,r as handPoses,o as loadPose,c as resetHands,y as update};
//# sourceMappingURL=handy-work.js.map
