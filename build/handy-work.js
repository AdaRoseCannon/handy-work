import{w as e,n as t,t as s}from"./shared-7a089489.js";export{n as normalize}from"./shared-7a089489.js";const a=e(new Worker(new URL("handpose-72ef0323.js",import.meta.url),{type:"module"})).default;function o(e,t){return a.loadPose(e,t)}const r=new EventTarget;class i{#ready;constructor({source:e,handPose:t}){this.handPose=t,this.size=e.hand.size,this.jointKeys=Array.from(e.hand.keys()),this.hand=e.hand,this.jointMatrixArray=new Float32Array(16*e.hand.size),this.handedness=e.handedness,this.#ready=!0}async update(e,t,n){if(!this.#ready)return[];this.#ready=!1,n.fillPoses(this.hand.values(),t,this.jointMatrixArray);const a=await this.handPose.update(e.transform.matrix,s(this.jointMatrixArray,[this.jointMatrixArray.buffer]),this.handedness);return this.jointMatrixArray=a.usedHandArrayBuffer,this.#ready=!0,a.distances}}const d=new Map;let h=!1;function c(){h=!0}function f(e,n,s){const a={};for(const t of e)t.hand&&(a[t.handedness]=t.hand);if(a.left&&a.right){window.__dumpHands=!1;const e=a.left.size,o=new Float32Array(1+16*e+16*e+e+e);o[0]=e;const r=new Float32Array(o.buffer,4,16*e),i=new Float32Array(o.buffer,4+16*e*4,16*e);new Float32Array(o.buffer,4+16*e*4*2,2*e).fill(1),s.fillPoses(a.left.values(),n,r),s.fillPoses(a.right.values(),n,i),t(r),t(i),console.log(o);const d=window.document.createElement("a");d.href=window.URL.createObjectURL(new Blob([new Uint8Array(o.buffer)],{type:"application/octet-stream"})),d.download="untitled.handpose",document.body.appendChild(d),d.click(),document.body.removeChild(d)}}function l(e,t,n){const s={handedness:t.handedness,distances:e},a=new CustomEvent("pose",{detail:s});r.dispatchEvent(a),n&&n(s)}function u(e,t,n,s){if(e&&n){const o=n.getViewerPose(t);h&&f(e,t,n);for(const r of e)if(r.hand)if(d.has(0)){const e=d.get(0);if(e instanceof Promise)continue;e.update(o,t,n).then((t=>{t.length&&l(t,e,s)})).catch((function(e){console.log(e)}))}else{const e=new a;d.set(0,e),e.then((e=>{const t=new i({source:r,handPose:e});d.set(0,t)}))}}}export{c as dumpHands,f as handDataToFile,r as handPoses,o as loadPose,u as update};
//# sourceMappingURL=handy-work.js.map
