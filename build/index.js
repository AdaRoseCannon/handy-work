import{w as e,n,t}from"./shared-7a089489.js";const s=e(new Worker(new URL("handpose-72ef0323.js",import.meta.url),{type:"module"})).default;function o(e,n){return s.loadPose(e,n)}const a=new EventTarget;class i{#ready;constructor({source:e,handPose:n}){this.handPose=n,this.size=e.hand.size,this.jointKeys=Array.from(e.hand.keys()),this.hand=e.hand,this.jointMatrixArray=new Float32Array(16*e.hand.size),this.handedness=e.handedness,this.#ready=!0}async update(e,n,s){if(!this.#ready)return console.warn("Pose detection taking too long"),[];this.#ready=!1,s.fillPoses(this.hand.values(),n,this.jointMatrixArray);const o=await this.handPose.update(e.transform.matrix,t(this.jointMatrixArray,[this.jointMatrixArray.buffer]),this.handedness);return this.jointMatrixArray=o.usedHandArrayBuffer,this.#ready=!0,o.distances}}const r=new Map;function d(){window.__dumpHands=!0}function c(e,t,o){if(e&&o){const d=o.getViewerPose(t);if(window.__dumpHands){const s={};for(const n of e.inputSources)n.hand&&(s[n.handedness]=n.hand);if(s.left&&s.right){window.__dumpHands=!1;const e=s.left.size,a=new Float32Array(1+16*e+16*e+e+e);a[0]=e;const i=new Float32Array(a.buffer,4,16*e),r=new Float32Array(a.buffer,4+16*e*4,16*e);new Float32Array(a.buffer,4+16*e*4*2,2*e).fill(1),o.fillPoses(s.left.values(),t,i),o.fillPoses(s.right.values(),t,r),n(i),n(r),console.log(a);const d=window.document.createElement("a");d.href=window.URL.createObjectURL(new Blob([new Uint8Array(a.buffer)],{type:"application/octet-stream"})),d.download="untitled.handpose",document.body.appendChild(d),d.click(),document.body.removeChild(d)}}for(const n of e.inputSources)if(n.hand)if(r.has(0)){const e=r.get(0);if(e instanceof Promise)continue;e.update(d,t,o).then((function(n){const t=new CustomEvent("pose",{detail:{handedness:e.handedness,distances:n}});a.dispatchEvent(t)})).catch((function(e){console.log(e)}))}else{const e=new s;r.set(0,e),e.then((e=>{const t=new i({source:n,handPose:e});r.set(0,t)}))}}}window.dumpHands=d;export{d as dumpHands,a as handPoses,o as loadPose,c as update};
//# sourceMappingURL=index.js.map
